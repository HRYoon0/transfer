<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026í•™ë…„ë„ ê´€ë‚´ì „ë³´ ë‚´ì‹ ì ì¡°ì‚¬ì„œ ì‘ì„±</title>
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Malgun Gothic', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .content { padding: 30px; }
        .section { margin-bottom: 40px; }
        .section-title { font-size: 20px; color: #667eea; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #667eea; display: flex; align-items: center; }
        .section-title::before { content: 'â—'; margin-right: 10px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-size: 14px; font-weight: bold; color: #333; margin-bottom: 8px; }
        .form-group label .required { color: #e74c3c; }
        .form-group input, .form-group select, .form-group textarea { padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: all 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .item-box { background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #e0e0e0; position: relative; }
        .item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .item-number { font-weight: bold; color: #667eea; font-size: 16px; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; transition: all 0.3s; font-weight: bold; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3); }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover { background: #c0392b; }
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover { background: #229954; }
        .btn-add { width: 100%; margin-top: 10px; padding: 15px; background: white; border: 2px dashed #667eea; color: #667eea; }
        .btn-add:hover { background: #f8f9ff; }
        .action-buttons { display: flex; gap: 15px; justify-content: center; margin-top: 40px; flex-wrap: wrap; }
        .score-display { background: #f0f7ff; padding: 20px; border-radius: 12px; border: 2px solid #667eea; }
        .score-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0; }
        .score-item:last-child { border-bottom: none; font-weight: bold; font-size: 18px; color: #667eea; }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .alert-warning { background: #fff3cd; border: 1px solid #ffc107; color: #856404; }
        .alert-info { background: #d1ecf1; border: 1px solid #17a2b8; color: #0c5460; }
        .help-text { font-size: 12px; color: #6c757d; margin-top: 5px; }
        .hidden { display: none; }
        /* ê²€ìƒ‰ ê°€ëŠ¥í•œ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .searchable-select { position: relative; }
        .searchable-select input { width: 100%; }
        .searchable-dropdown { position: absolute; top: 100%; left: 0; right: 0; max-height: 300px; overflow-y: auto; background: white; border: 2px solid #667eea; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 1000; margin-top: 5px; }
        .searchable-dropdown-item { padding: 10px 12px; cursor: pointer; transition: all 0.2s; }
        .searchable-dropdown-item:hover { background: #f0f4ff; }
        .searchable-dropdown-item.selected { background: #667eea; color: white; }
        /* ê²½ë ¥ ì‚¬í•­ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .career-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; background: white; }
        .career-table th { background: #667eea; color: white; padding: 12px 8px; text-align: center; font-size: 14px; border: 1px solid #5568d3; }
        .career-table td { padding: 8px; border: 1px solid #e0e0e0; text-align: center; }
        .career-table td input, .career-table td select { width: 100%; padding: 8px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 13px; text-align: center; }
        .career-table td input:focus, .career-table td select:focus { outline: none; border-color: #667eea; }
        .career-table td input[readonly] { background: #f0f0f0; cursor: not-allowed; }
        .career-table .delete-btn { padding: 6px 12px; font-size: 12px; }
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; overflow-y: auto; }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; border-radius: 16px; max-width: 900px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3); margin: 20px; }
        .modal-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 30px; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { margin: 0; font-size: 20px; }
        .modal-close { background: none; border: none; color: white; font-size: 28px; cursor: pointer; line-height: 1; padding: 0; width: 30px; height: 30px; }
        .modal-close:hover { opacity: 0.7; }
        .modal-body { padding: 30px; }
        .modal-footer { padding: 20px 30px; border-top: 1px solid #e0e0e0; display: flex; gap: 10px; justify-content: flex-end; }
        .temp-career-item { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #e0e0e0; position: relative; }
        .temp-career-item .remove-temp-btn { position: absolute; top: 10px; right: 10px; padding: 4px 10px; font-size: 12px; }
        @media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } .action-buttons { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 style="margin: 0 0 10px 0; font-size: 28px;">2026í•™ë…„ë„ ê´€ë‚´ì „ë³´ ë‚´ì‹ ì ì¡°ì‚¬ì„œ</h1>
            <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
                <p style="margin: 0; font-size: 14px; opacity: 0.9;">ì–‘ì‚°êµìœ¡ì§€ì›ì²­ êµìœ¡ê³µë¬´ì› ì¸ì‚¬ê´€ë¦¬ê¸°ì¤€</p>
                <a href="https://works.do/GbfcAqT" target="_blank" style="color: white; text-decoration: none; background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 6px; font-size: 13px; font-weight: bold; transition: all 0.3s; border: 1px solid rgba(255,255,255,0.3); white-space: nowrap;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">ğŸ“¥ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</a>
            </div>
            <div style="text-align: right; font-size: 12px; opacity: 0.9; margin-top: 15px;">
                <p style="margin: 0 0 3px 0;">ì‘ì„±ì: í™©ì‚°ì´ˆë“±í•™êµ ìœ¤í¬ë¥˜</p>
                <p style="margin: 0;">ì˜¤ë¥˜ ë° ê°œì„ ì‚¬í•­ ë¬¸ì˜: tmdsh2000@naver.com í˜¹ì€ ë‚´ë¶€ë©”ì¼</p>
            </div>
        </div>

        <div class="content">
            <!-- 1. ê¸°ë³¸ ì •ë³´ -->
            <div class="section">
                <h2 class="section-title">1. ê¸°ë³¸ ì •ë³´</h2>

                <!-- ì „ë³´ ì •ë³´ -->
                <div class="form-grid">
                    <div class="form-group">
                        <label>ì „ë³´êµ¬ë¶„ <span class="required">*</span></label>
                        <select id="transferType" onchange="handleTransferTypeChange()">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="í¬ë§">í¬ë§</option>
                            <option value="ë§Œê¸°">ë§Œê¸°</option>
                            <option value="ìš°ì„ ">ìš°ì„ </option>
                            <option value="ì´ˆë¹™">ì´ˆë¹™</option>
                            <option value="ë¹„ì •ê¸°">ë¹„ì •ê¸°</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>1í¬ë§ <span class="required">*</span></label>
                        <div class="searchable-select">
                            <input type="text" id="firstChoice" placeholder="ê²€ìƒ‰ ë˜ëŠ” ì„ íƒ..." autocomplete="off">
                            <div id="firstChoiceDropdown" class="searchable-dropdown hidden"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>2í¬ë§</label>
                        <div class="searchable-select">
                            <input type="text" id="secondChoice" placeholder="ê²€ìƒ‰ ë˜ëŠ” ì„ íƒ..." autocomplete="off">
                            <div id="secondChoiceDropdown" class="searchable-dropdown hidden"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>3í¬ë§</label>
                        <div class="searchable-select">
                            <input type="text" id="thirdChoice" placeholder="ê²€ìƒ‰ ë˜ëŠ” ì„ íƒ..." autocomplete="off">
                            <div id="thirdChoiceDropdown" class="searchable-dropdown hidden"></div>
                        </div>
                    </div>
                </div>

                <!-- í†µí•© í¬ë§ ì„¹ì…˜ (1í¬ë§ì— í†µí•© ì„ íƒ ì‹œì—ë§Œ í‘œì‹œ) -->
                <div id="integratedSection" class="hidden" style="margin-top: 20px; margin-bottom: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">í†µí•© í¬ë§ ìƒì„¸</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>í†µí•© 1í¬ë§</label>
                            <select id="integrated1" onchange="updateIntegratedOptions()">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ì´ì²œ">ì´ì²œ</option>
                                <option value="ì›ë™">ì›ë™</option>
                                <option value="ì¢Œì‚¼">ì¢Œì‚¼</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>í†µí•© 2í¬ë§</label>
                            <select id="integrated2" onchange="updateIntegratedOptions()">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ì´ì²œ">ì´ì²œ</option>
                                <option value="ì›ë™">ì›ë™</option>
                                <option value="ì¢Œì‚¼">ì¢Œì‚¼</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>í†µí•© 3í¬ë§</label>
                            <select id="integrated3">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ì´ì²œ">ì´ì²œ</option>
                                <option value="ì›ë™">ì›ë™</option>
                                <option value="ì¢Œì‚¼">ì¢Œì‚¼</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ê¸°ë³¸ ì •ë³´ -->
                <h3 style="color: #667eea; margin: 30px 0 15px 0;">ê°œì¸ ì •ë³´</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ì„±ëª… <span class="required">*</span></label>
                        <input type="text" id="name" placeholder="í™ê¸¸ë™">
                    </div>
                    <div class="form-group">
                        <label>ì„±ë³„ <span class="required">*</span></label>
                        <select id="gender">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ë‚¨">ë‚¨</option>
                            <option value="ì—¬">ì—¬</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ìƒë…„ì›”ì¼ <span class="required">*</span></label>
                        <input type="text" id="birthdate" placeholder="19880311" oninput="formatDate(this); updateWoo4Birthdate();">
                        <div class="help-text">ìˆ«ì 8ìë¦¬ ì…ë ¥ (ì˜ˆ: 19880311 â†’ 1988.03.11)</div>
                    </div>
                    <div class="form-group">
                        <label>í˜„ì„êµ <span class="required">*</span></label>
                        <div class="searchable-select">
                            <input type="text" id="currentSchool" placeholder="ê²€ìƒ‰ ë˜ëŠ” ì„ íƒ..." autocomplete="off">
                            <div id="currentSchoolDropdown" class="searchable-dropdown hidden"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>í˜„ì„êµê·¼ë¬´ì—°ìˆ˜ <span class="required">*</span></label>
                        <input type="text" id="currentSchoolYears" readonly style="background-color: #f5f5f5; cursor: not-allowed;">
                        <div class="help-text">âœ¨ ê²½ë ¥ ì‚¬í•­ì—ì„œ í˜„ì„êµì™€ ì¼ì¹˜í•˜ëŠ” ê²½ë ¥ì´ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤ (30ì¼ ë¯¸ë§Œ ë²„ë¦¼, í˜•ì‹: 4.06)</div>
                    </div>
                    <div class="form-group">
                        <label>ìƒí™œê·¼ê±°ì§€ <span class="required">*</span></label>
                        <input type="text" id="residence" placeholder="ì–‘ì‚°ì¤‘ì•™">
                        <div class="help-text">ì˜ˆ: ì–‘ì‚°ì¤‘ì•™, ë¶€ì‚°í™”ëª…, ì–‘ì‚°ë™ë©´, ìš¸ì‚°ì–¸ì–‘</div>
                    </div>
                    <div class="form-group">
                        <label>ì†Œì§€ìê²© <span class="required">*</span></label>
                        <select id="qualification">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì´ˆ1ì •">ì´ˆ1ì •</option>
                            <option value="ì´ˆ2ì •">ì´ˆ2ì •</option>
                            <option value="ì´ˆë“±íŠ¹ìˆ˜1ì •">ì´ˆë“±íŠ¹ìˆ˜1ì •</option>
                            <option value="ì´ˆë“±íŠ¹ìˆ˜2ì •">ì´ˆë“±íŠ¹ìˆ˜2ì •</option>
                            <option value="ë³´ê±´1ê¸‰">ë³´ê±´1ê¸‰</option>
                            <option value="ë³´ê±´2ê¸‰">ë³´ê±´2ê¸‰</option>
                            <option value="ì‚¬ì„œ1ê¸‰">ì‚¬ì„œ1ê¸‰</option>
                            <option value="ì‚¬ì„œ2ê¸‰">ì‚¬ì„œ2ê¸‰</option>
                            <option value="ìƒë‹´1ê¸‰">ìƒë‹´1ê¸‰</option>
                            <option value="ìƒë‹´2ê¸‰">ìƒë‹´2ê¸‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>íƒ€ì‹œêµ°ë‚´ì‹ </label>
                        <input type="text" id="otherCity" placeholder="ì°½ì›, ì§„ì£¼ ë“±">
                        <div class="help-text">íƒ€ì‹œêµ°ë‚´ì‹  ë‚¸ ê²½ìš°ë§Œ ì§€ì—­ëª… 2ì ì…ë ¥</div>
                    </div>
                    <div class="form-group">
                        <label>íƒ€ì‹œë„ë‚´ì‹ </label>
                        <input type="text" id="otherProvince" placeholder="ì„œìš¸, ê²½ê¸° ë“±">
                        <div class="help-text">íƒ€ì‹œë„ë‚´ì‹  ë‚¸ ê²½ìš°ë§Œ ì§€ì—­ëª… 2ì ì…ë ¥</div>
                    </div>
                    <div class="form-group">
                        <label>ìŠ¹ì§„í›„ë³´ì <span class="required">*</span></label>
                        <select id="promotionCandidate">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì˜ˆ">ì˜ˆ</option>
                            <option value="ì•„ë‹ˆì˜¤">ì•„ë‹ˆì˜¤</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ë¹„ê³ </label>
                        <textarea id="remarks" rows="2" placeholder="ê³¼ì›1, ë³„ë„ì •ì›, ì „ë³´ìœ ì˜ˆ, ëª…ì˜ˆí‡´ì§ ë“±"></textarea>
                    </div>
                </div>
            </div>

            <!-- 2. ê²½ë ¥ ì‚¬í•­ -->
            <div class="section">
                <h2 class="section-title">2. ê²½ë ¥ ì‚¬í•­ (ìµœê·¼ 4ë…„)</h2>
                <div class="alert alert-warning">
                    <strong>ì£¼ì˜:</strong> ìµœê·¼ ê·¼ë¬´ê¸°ê°„ë¶€í„° 4ë…„ê°„ ê¸°ì¬. íœ´ì§ê¸°ê°„ì´ ìˆìœ¼ë©´ ì „í›„ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•˜ê³  íœ´ì§ê¸°ê°„ë§Œí¼ ì†Œê¸‰í•˜ì—¬ ì´ì „ ê·¼ë¬´ê²½ë ¥ í¬í•¨.
                    <br><strong>TIP:</strong> ê²½ë ¥ ì¶”ê°€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì—¬ëŸ¬ ê²½ë ¥ì„ ì…ë ¥í•œ í›„ ì €ì¥í•˜ë©´, ì „ì²´ ê·¼ë¬´ê¸°ê°„ì´ 4ë…„ì„ ì´ˆê³¼í•  ê²½ìš° ìë™ìœ¼ë¡œ ì¡°ì •ë©ë‹ˆë‹¤.
                    <br><strong>ê²½ë ¥ì  ê³„ì‚°:</strong> í•™ë…„ë„ ê¸°ì¤€ìœ¼ë¡œ í•˜ë˜, 1ë…„ ë¯¸ë§Œì€ ì›”ë‹¨ìœ„ë¡œ ê³„ì‚°í•˜ê³  15ì¼ ì´ìƒì€ 1ì›”ë¡œ í•œë‹¤.
                </div>

                <!-- ê²½ë ¥ ì…ë ¥ ì˜ì—­ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
                <div id="careerInputArea" class="hidden" style="background: #f8f9ff; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #667eea;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; color: #667eea; font-size: 18px;">ê²½ë ¥ ì…ë ¥</h3>
                        <button class="btn btn-danger" onclick="cancelCareerInput()" style="padding: 6px 12px; font-size: 13px;">ë‹«ê¸°</button>
                    </div>
                    <div class="alert alert-info" style="margin-bottom: 15px; padding: 10px;">
                        <strong>ì•ˆë‚´:</strong> ì—¬ëŸ¬ ê²½ë ¥ì„ ì¶”ê°€í•œ í›„ ì €ì¥ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì „ì²´ ê²½ë ¥ì´ í™•ì •ë©ë‹ˆë‹¤. ì „ì²´ ê·¼ë¬´ê¸°ê°„ì´ 4ë…„ì„ ì´ˆê³¼í•˜ë©´ ìë™ìœ¼ë¡œ ì¡°ì •ë©ë‹ˆë‹¤.
                    </div>
                    <div id="tempCareerList"></div>
                    <button class="btn btn-add" onclick="addTempCareer()" style="margin-bottom: 15px;">+ ê²½ë ¥ í•­ëª© ì¶”ê°€</button>
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button class="btn btn-danger" onclick="cancelCareerInput()">ì·¨ì†Œ</button>
                        <button class="btn btn-success" onclick="saveAllCareers()">ì €ì¥</button>
                    </div>
                </div>

                <table class="career-table">
                    <thead>
                        <tr>
                            <th rowspan="2">í•™êµëª…</th>
                            <th rowspan="2">ê·¼ë¬´ê¸°ê°„</th>
                            <th rowspan="2">ê¸‰ì§€(ì ìˆ˜)</th>
                            <th rowspan="2">ê·¼ë¬´ì—°ìˆ˜</th>
                            <th rowspan="2">ì ìˆ˜</th>
                            <th rowspan="2">ì‚­ì œ</th>
                        </tr>
                    </thead>
                    <tbody id="careerList">
                        <tr>
                            <td colspan="6" style="padding: 20px; text-align: center; color: #999;">ê²½ë ¥ ì¶”ê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê²½ë ¥ì„ ì…ë ¥í•˜ì„¸ìš”.</td>
                        </tr>
                    </tbody>
                </table>
                <button class="btn btn-add" onclick="showCareerInput()">+ ê²½ë ¥ ì¶”ê°€</button>
            </div>

            <!-- 3. ê°€ì‚°ì  -->
            <div class="section">
                <h2 class="section-title">3. ê°€ì‚°ì  (ìµœê·¼ 4ë…„ ì´ë‚´ í˜„ì„êµ ì‹¤ì )</h2>
                <div class="alert alert-info">
                    <strong>ìˆœì„œ:</strong> í‘œì°½ â†’ ê·¼ë¬´ì‹¤ì  â†’ ì—°êµ¬ì‹¤ì  â†’ ìš°ìš°ì¡°ê±´ ìˆœìœ¼ë¡œ ì…ë ¥. ê°™ì€ ì¢…ë³„ ë‚´ì—ì„œëŠ” ë²ˆí˜¸ ìˆœì„œëŒ€ë¡œ ì…ë ¥.
                </div>
                <div id="bonusList"></div>
                <button class="btn btn-add" onclick="addBonus()">+ ê°€ì‚°ì  ì¶”ê°€</button>
            </div>

            <!-- 4. êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ ê°€ì‚°ì  -->
            <div class="section">
                <h2 class="section-title">4. êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ ê°€ì‚°ì </h2>
                <div class="alert alert-warning">
                    <strong>ì¤‘ìš”:</strong> ì œ11ì¡° ê°€ì‚°ì  ì‹¤ì ê³¼ ì¤‘ë³µë  ê²½ìš°, ì œ19ì¡°ë¥¼ ìš°ì„ í•˜ë˜ ì¤‘ë³µ ì‚¬ìš© ë¶ˆê°€. ë§Œê¸°ìê°€ ì¼ë°˜ í•™êµë¡œ ì „ë³´ ì‹œì—ëŠ” ì œ11ì¡° ì¡°í•­ì— ë”°ë¦„.
                </div>

                <!-- 1~3. ìˆ˜ì—… ì‹¤ì  (ìµœëŒ€ 3ê°œ) -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="font-weight: bold; margin-bottom: 10px; display: block;">1~3. ìˆ˜ì—… ì‹¤ì  (ìµœëŒ€ 3ê°œ, ê° 2.00ì )</label>
                    <div id="practiceClassList"></div>
                    <button class="btn btn-add" onclick="addPracticeClass()" id="addPracticeClassBtn">+ ìˆ˜ì—… ì‹¤ì  ì¶”ê°€</button>
                    <div style="margin-top: 10px;">
                        <label>ì ìˆ˜: </label>
                        <input type="text" id="practiceClassScore" readonly style="width: 80px; background: #f0f0f0;">
                    </div>
                </div>

                <!-- 4. ì—°êµ¬ ì‹¤ì  -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="font-weight: bold;">4. ì—°êµ¬ ì‹¤ì  (2.00ì )</label>
                    <input type="text" id="practiceResearchContent" placeholder="ë‚´ìš© ì…ë ¥">
                    <input type="text" id="practiceResearchDate" placeholder="ë‚ ì§œ (ì˜ˆ: 20071105)" oninput="formatDate(this); calculatePracticeScore();">
                    <div style="margin-top: 10px;">
                        <label>ì ìˆ˜: </label>
                        <input type="text" id="practiceResearchScore" readonly style="width: 80px; background: #f0f0f0;">
                    </div>
                </div>

                <!-- 5. ë¯¸ë˜êµìœ¡ ì‹¤ì  -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="font-weight: bold;">5. ë¯¸ë˜êµìœ¡ ì‹¤ì  (2.00ì )</label>
                    <input type="text" id="practiceFutureContent" placeholder="ë‚´ìš© ì…ë ¥">
                    <input type="text" id="practiceFuturePeriod" placeholder="ê¸°ê°„ (ì˜ˆ: 2022030120230228)" oninput="formatPeriod(this); calculatePracticeScore();">
                    <div style="margin-top: 10px;">
                        <label>ì ìˆ˜: </label>
                        <input type="text" id="practiceFutureScore" readonly style="width: 80px; background: #f0f0f0;">
                    </div>
                </div>

                <!-- 6. êµìœ¡ë ¥ ì œê³  ì‹¤ì  -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="font-weight: bold;">6. êµìœ¡ë ¥ ì œê³  ì‹¤ì  (2.00ì )</label>
                    <input type="text" id="practiceImprovementContent" placeholder="ë‚´ìš© ì…ë ¥">
                    <input type="text" id="practiceImprovementPeriod" placeholder="ê¸°ê°„ (ì˜ˆ: 2019030120200229)" oninput="formatPeriod(this); calculatePracticeScore();">
                    <div style="margin-top: 10px;">
                        <label>ì ìˆ˜: </label>
                        <input type="text" id="practiceImprovementScore" readonly style="width: 80px; background: #f0f0f0;">
                    </div>
                </div>
            </div>

            <!-- 5. ì¶”ê°€ ì…ë ¥ í•­ëª© -->
            <div class="section">
                <h2 class="section-title">5. ì¶”ê°€ ì…ë ¥ í•­ëª©</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ê³¼ì› ì „ë³´ ë‚´ì‹ ì í¬ë§</label>
                        <select id="overStaffHope">
                            <option value="">í•´ë‹¹ ì—†ìŒ</option>
                            <option value="ê³¼ì›ì´ í•´ì†Œë  ê²½ìš°, í¬ë§í•™êµ ì „ë³´í¬ë§">ê³¼ì›ì´ í•´ì†Œë  ê²½ìš°, í¬ë§í•™êµ ì „ë³´í¬ë§</option>
                            <option value="ê³¼ì›ì´ í•´ì†Œë  ê²½ìš°, í˜„ì„êµ ê³„ì† ê·¼ë¬´ í¬ë§">ê³¼ì›ì´ í•´ì†Œë  ê²½ìš°, í˜„ì„êµ ê³„ì† ê·¼ë¬´ í¬ë§</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ì „ë³´ìš°ì„  ì‚¬ìœ </label>
                        <select id="transferPriorityReason">
                            <option value="">í•´ë‹¹ ì—†ìŒ</option>
                            <option value="êµìœ¡ì‹œì±… ì¶”ì§„ìƒ í•™êµì¥ì˜ ìš”ì²­">êµìœ¡ì‹œì±… ì¶”ì§„ìƒ í•™êµì¥ì˜ ìš”ì²­</option>
                            <option value="ì •ì› ë³€ê²½">ì •ì› ë³€ê²½</option>
                            <option value="íŠ¹ìˆ˜êµìœ¡ì§€ì›ì„¼í„°ì—ì„œ 3ë…„ ì´ìƒ ê·¼ë¬´">íŠ¹ìˆ˜êµìœ¡ì§€ì›ì„¼í„°ì—ì„œ 3ë…„ ì´ìƒ ê·¼ë¬´</option>
                            <option value="êµìœ¡ì§€ì›ì²­ Weeì„¼í„°ì—ì„œ 4ë…„ ì´ìƒ ê·¼ë¬´">êµìœ¡ì§€ì›ì²­ Weeì„¼í„°ì—ì„œ 4ë…„ ì´ìƒ ê·¼ë¬´</option>
                            <option value="ê³µëª¨êµì¥ ë§Œë£Œ">ê³µëª¨êµì¥ ë§Œë£Œ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ì „ë³´ìœ ì˜ˆ ì‚¬ìœ </label>
                        <select id="transferDeferReason">
                            <option value="">í•´ë‹¹ ì—†ìŒ</option>
                            <option value="ì—°êµ¬í•™êµ ì—°êµ¬ì£¼ë¬´ êµì‚¬">ì—°êµ¬í•™êµ ì—°êµ¬ì£¼ë¬´ êµì‚¬</option>
                            <option value="1ë…„ ì´ë‚´ ì •ë…„ í‡´ì„">1ë…„ ì´ë‚´ ì •ë…„ í‡´ì„</option>
                            <option value="íŠ¹ìˆ˜í•™ê¸‰ ë‹´ë‹¹êµì‚¬">íŠ¹ìˆ˜í•™ê¸‰ ë‹´ë‹¹êµì‚¬</option>
                            <option value="íŠ¹ìˆ˜ì˜ì—­ ìš°ìˆ˜êµì‚¬">íŠ¹ìˆ˜ì˜ì—­ ìš°ìˆ˜êµì‚¬</option>
                            <option value="ì „êµ­ì†Œë…„ì²´ìœ¡ëŒ€íšŒ ê¸ˆë©”ë‹¬ íšë“ ì§€ë„êµì‚¬">ì „êµ­ì†Œë…„ì²´ìœ¡ëŒ€íšŒ ê¸ˆë©”ë‹¬ íšë“ ì§€ë„êµì‚¬</option>
                            <option value="í–‰ë³µ(ë‚˜ëˆ”)í•™êµ í•µì‹¬êµì‚¬">í–‰ë³µ(ë‚˜ëˆ”)í•™êµ í•µì‹¬êµì‚¬</option>
                            <option value="ë‹¤ìë…€ êµì› ì¤‘ ë¯¸ì·¨í•™ ì•„ë™ì´ ìˆëŠ” êµì‚¬">ë‹¤ìë…€ êµì› ì¤‘ ë¯¸ì·¨í•™ ì•„ë™ì´ ìˆëŠ” êµì‚¬</option>
                            <option value="êµìœ¡ì „ë¬¸ì§ í•©ê²©í›„ ì„ìš©ë°œë ¹ ë°›ì§€ ì•Šì€ êµì‚¬">êµìœ¡ì „ë¬¸ì§ í•©ê²©í›„ ì„ìš©ë°œë ¹ ë°›ì§€ ì•Šì€ êµì‚¬</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ë¶€ë¶€ êµì§ì› ì„±ëª…</label>
                        <input type="text" id="spouseName">
                    </div>
                    <div class="form-group">
                        <label>ë¶€ë¶€ êµì§ì› ì†Œì†</label>
                        <input type="text" id="spouseSchool" placeholder="ì„ì‚°, ì‹ ì£¼ ë“±">
                    </div>
                    <div class="form-group">
                        <label>ì§ê³„ì¡´ë¹„ì† êµì§ì›1 ì„±ëª…</label>
                        <input type="text" id="relative1Name">
                    </div>
                    <div class="form-group">
                        <label>ì§ê³„ì¡´ë¹„ì† êµì§ì›1 ì†Œì†</label>
                        <input type="text" id="relative1School" placeholder="ì„ì‚°, ì‹ ì£¼ ë“±">
                    </div>
                    <div class="form-group">
                        <label>ì§ê³„ì¡´ë¹„ì† êµì§ì›2 ì„±ëª…</label>
                        <input type="text" id="relative2Name">
                    </div>
                    <div class="form-group">
                        <label>ì§ê³„ì¡´ë¹„ì† êµì§ì›2 ì†Œì†</label>
                        <input type="text" id="relative2School" placeholder="ì„ì‚°, ì‹ ì£¼ ë“±">
                    </div>
                </div>
            </div>

            <!-- 6. ì ìˆ˜ ê³„ì‚° ê²°ê³¼ -->
            <div class="section">
                <h2 class="section-title">6. ì ìˆ˜ ê³„ì‚°</h2>
                <div class="score-display">
                    <div class="score-item">
                        <span>í•™êµê²½ë ¥ì :</span>
                        <span id="careerScore">0.00ì </span>
                    </div>
                    <div class="score-item">
                        <span>ê°€ì‚°ì :</span>
                        <span id="bonusScore">0.000ì </span>
                    </div>
                    <div class="score-item">
                        <span>êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ ê°€ì‚°ì :</span>
                        <span id="practiceScore">0.000ì </span>
                    </div>
                    <div class="score-item">
                        <span>ì´ì :</span>
                        <span id="totalScore">0.000ì </span>
                    </div>
                    <div class="score-item">
                        <span>ì‹¤ìŠµêµ ë³´ì •ì´ì :</span>
                        <span id="practiceAdjustedScore">-</span>
                    </div>
                </div>
            </div>

            <!-- ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="saveData()">ğŸ’¾ ì„ì‹œ ì €ì¥</button>
                <button class="btn btn-success" onclick="downloadJSON()">ğŸ“¥ JSON ë‹¤ìš´ë¡œë“œ</button>
                <button class="btn btn-success" onclick="downloadExcel()">ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
                <button class="btn btn-primary" onclick="loadData()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        const gradeData = {
    "ê°€ë‚¨": {
        "2017": "ë‚˜",
        "2018": "ê°€",
        "2019": "ê°€",
        "2020": "ê°€",
        "2021": "ê°€",
        "2022": "ê°€",
        "2023": "ê°€",
        "2024": "ê°€",
        "2025": "ê°€"
    },
    "ê°€ì–‘": {
        "2018": "ë‚˜",
        "2019": "ê°€",
        "2020": "ê°€",
        "2021": "ê°€",
        "2022": "ê°€",
        "2023": "ê°€",
        "2024": "ê°€",
        "2025": "ê°€"
    },
    "ê°€ì´Œ": {
        "2020": "ë‚˜",
        "2021": "ê°€",
        "2022": "ê°€",
        "2023": "ê°€",
        "2024": "ê°€",
        "2025": "ê°€"
    },
    "ê¸ˆì†¡": {
        "2025": "ë‹¤"
    },
    "ê¸ˆì˜¤": {
        "2020": "ë‚˜",
        "2021": "ê°€",
        "2022": "ê°€",
        "2023": "ê°€",
        "2024": "ê°€",
        "2025": "ê°€"
    },
    "ëŒ€ìš´": {
        "2017": "ë‚˜",
        "2018": "ë‚˜",
        "2019": "ë‚˜",
        "2020": "ë‚˜",
        "2021": "ë‚˜",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ë•ê³„": {
        "2017": "ë‚˜",
        "2018": "ë‚˜",
        "2019": "ë‚˜",
        "2020": "ë‚˜",
        "2021": "ë‚˜",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ë™ë©´": {
        "2022": "ë‹¤",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ë™ì‚°": {
        "2017": "ë‚˜",
        "2018": "ë‚˜",
        "2019": "ë‚˜",
        "2020": "ë‚˜",
        "2021": "ë‚˜",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ë¬¼ê¸ˆ": {
        "2017": "ë‹¤",
        "2018": "ë‹¤",
        "2019": "ë‹¤",
        "2020": "ë‹¤",
        "2021": "ë‹¤",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ë°±ë™": {
        "2017": "ë‹¤",
        "2018": "ë‹¤",
        "2019": "ë‹¤",
        "2020": "ë‹¤",
        "2021": "ë‹¤",
        "2022": "ë¼",
        "2023": "ë¼",
        "2024": "ë¼",
        "2025": "ë¼"
    },
    "ë²”ì–´": {
        "2017": "ë‚˜",
        "2018": "ë‚˜",
        "2019": "ë‚˜",
        "2020": "ë‚˜",
        "2021": "ë‚˜",
        "2022": "ë‹¤",
        "2023": "ë‹¤",
        "2024": "ë‹¤",
        "2025": "ë‹¤"
    },
    "ë¶ì •": {
        "2017": "ë‚˜",
        "2018": "ë‚˜",
        "2019": "ë‚˜",
        "2020": "ë‚˜",
        "2021": "ë‚˜",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‹¤",
        "2025": "ë‹¤"
    },
    "ì‚¬ì†¡": {
        "2024": "ë‹¤",
        "2025": "ë‚˜"
    },
    "ì‚¼ì„±": {
        "2017": "ë‹¤",
        "2018": "ë‹¤",
        "2019": "ë‹¤",
        "2020": "ë‹¤",
        "2021": "ë‹¤",
        "2022": "ë‹¤",
        "2023": "ë‹¤",
        "2024": "ë‹¤",
        "2025": "ë‹¤"
    },
    "ì‚½ëŸ‰": {
        "2017": "ê°€",
        "2018": "ê°€",
        "2019": "ê°€",
        "2020": "ë‚˜",
        "2021": "ë‚˜",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ìƒë¶": {
        "2017": "ë‹¤",
        "2018": "ë‹¤",
        "2019": "ë‹¤",
        "2020": "ë‹¤",
        "2021": "ë‹¤",
        "2022": "ë‹¤",
        "2023": "ë‹¤",
        "2024": "ë‹¤",
        "2025": "ë‹¤"
    },
    "ì„œë‚¨": {
        "2017": "ë‚˜",
        "2018": "ë‚˜",
        "2019": "ë‚˜",
        "2020": "ë‚˜",
        "2021": "ë‚˜",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ì„œì°½": {
        "2017": "ë¼",
        "2018": "ë¼",
        "2019": "ë¼",
        "2020": "ë¼",
        "2021": "ë¼",
        "2022": "ë¼",
        "2023": "ë¼",
        "2024": "ë¼",
        "2025": "ë¼"
    },
    "ì„ì‚°": {
        "2017": "ê°€",
        "2018": "ê°€",
        "2019": "ê°€",
        "2020": "ê°€",
        "2021": "ê°€",
        "2022": "ê°€",
        "2023": "ê°€",
        "2024": "ê°€",
        "2025": "ê°€"
    },
    "ì„±ì‚°": {
        "2017": "ê°€",
        "2018": "ê°€",
        "2019": "ê°€",
        "2020": "ê°€",
        "2021": "ê°€",
        "2022": "ê°€",
        "2023": "ê°€",
        "2024": "ê°€",
        "2025": "ê°€"
    },
    "ì†Œí† ": {
        "2017": "ë‹¤",
        "2018": "ë‹¤",
        "2019": "ë‹¤",
        "2020": "ë‹¤",
        "2021": "ë‹¤",
        "2022": "ë‹¤",
        "2023": "ë‹¤",
        "2024": "ë‹¤",
        "2025": "ë‹¤"
    },
    "ì‹ ê¸°": {
        "2017": "ë‹¤",
        "2018": "ë‹¤",
        "2019": "ë‹¤",
        "2020": "ë‹¤",
        "2021": "ë‹¤",
        "2022": "ë‹¤",
        "2023": "ë‹¤",
        "2024": "ë‹¤",
        "2025": "ë‹¤"
    },
    "ì‹ ëª…": {
        "2017": "ë‹¤",
        "2018": "ë‹¤",
        "2019": "ë‹¤",
        "2020": "ë‹¤",
        "2021": "ë‹¤",
        "2022": "ë‹¤",
        "2023": "ë‹¤",
        "2024": "ë‹¤",
        "2025": "ë‹¤"
    },
    "ì‹ ì–‘": {
        "2017": "ê°€",
        "2018": "ê°€",
        "2019": "ê°€",
        "2020": "ê°€",
        "2021": "ê°€",
        "2022": "ê°€",
        "2023": "ê°€",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ì‹ ì£¼": {
        "2017": "ê°€",
        "2018": "ê°€",
        "2019": "ê°€",
        "2020": "ê°€",
        "2021": "ê°€",
        "2022": "ê°€",
        "2023": "ê°€",
        "2024": "ê°€",
        "2025": "ê°€"
    },
    "ì–‘ì‚°": {
        "2017": "ë‹¤",
        "2018": "ë‹¤",
        "2019": "ë‹¤",
        "2020": "ë‹¤",
        "2021": "ë‹¤",
        "2022": "ë‹¤",
        "2023": "ë‹¤",
        "2024": "ë‹¤",
        "2025": "ë‹¤"
    },
    "ì–‘ì£¼": {
        "2017": "ë‚˜",
        "2018": "ë‚˜",
        "2019": "ë‚˜",
        "2020": "ë‚˜",
        "2021": "ë‚˜",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ì–´ê³¡": {
        "2017": "ë¼",
        "2018": "ë¼",
        "2019": "ë¼",
        "2020": "ë¼",
        "2021": "ë¼",
        "2022": "ë¼",
        "2023": "ë¼",
        "2024": "ë¼",
        "2025": "ë¼"
    },
    "ì˜ì²œ": {
        "2017": "ë‚˜",
        "2018": "ë‚˜",
        "2019": "ë‚˜",
        "2020": "ë‚˜",
        "2021": "ë‚˜",
        "2022": "ë‹¤",
        "2023": "ë‹¤",
        "2024": "ë‹¤",
        "2025": "ë‹¤"
    },
    "ì˜¤ë´‰": {
        "2017": "ë‚˜",
        "2018": "ë‚˜",
        "2019": "ë‚˜",
        "2020": "ë‚˜",
        "2021": "ë‚˜",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‹¤"
    },
    "ìš©ì—°": {
        "2017": "ë¼",
        "2018": "ë¼",
        "2019": "ë¼",
        "2020": "ë¼",
        "2021": "ë¼",
        "2022": "ë¼",
        "2023": "ë¼",
        "2024": "ë¼",
        "2025": "ë¼"
    },
    "ì›…ìƒ": {
        "2017": "ë‹¤",
        "2018": "ë‹¤",
        "2019": "ë‹¤",
        "2020": "ë‹¤",
        "2021": "ë‹¤",
        "2022": "ë‹¤",
        "2023": "ë‹¤",
        "2024": "ë‹¤",
        "2025": "ë‹¤"
    },
    "ì›ë™": {
        "2017": "ë¼",
        "2018": "ë¼",
        "2019": "ë¼",
        "2020": "ë¼",
        "2021": "ë¼",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ì´ì²œ": {
        "2017": "ë¼",
        "2018": "ë¼",
        "2019": "ë¼",
        "2020": "ë¼",
        "2021": "ë¼",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ì¢Œì‚¼": {
        "2017": "ë¼",
        "2018": "ë¼",
        "2019": "ë¼",
        "2020": "ë¼",
        "2021": "ë¼",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ì¤‘ë¶€": {
        "2017": "ê°€",
        "2018": "ê°€",
        "2019": "ê°€",
        "2020": "ë‚˜",
        "2021": "ë‚˜",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "ì¦ì‚°": {
        "2017": "ê°€",
        "2018": "ê°€",
        "2019": "ê°€",
        "2020": "ê°€",
        "2021": "ê°€",
        "2022": "ê°€",
        "2023": "ê°€",
        "2024": "ê°€",
        "2025": "ê°€"
    },
    "ì²œì„±": {
        "2017": "ë‹¤",
        "2018": "ë‹¤",
        "2019": "ë‹¤",
        "2020": "ë‹¤",
        "2021": "ë‹¤",
        "2022": "ë‹¤",
        "2023": "ë‹¤",
        "2024": "ë‹¤",
        "2025": "ë‹¤"
    },
    "í‰ì‚°": {
        "2017": "ë‚˜",
        "2018": "ë‚˜",
        "2019": "ë‚˜",
        "2020": "ë‚˜",
        "2021": "ë‚˜",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    },
    "í•˜ë¶": {
        "2017": "ë‹¤",
        "2018": "ë‹¤",
        "2019": "ë‹¤",
        "2020": "ë‹¤",
        "2021": "ë‹¤",
        "2022": "ë‹¤",
        "2023": "ë‹¤",
        "2024": "ë¼",
        "2025": "ë¼"
    },
    "í™”ì œ": {
        "2017": "ë¼",
        "2018": "ë¼",
        "2019": "ë¼",
        "2020": "ë¼",
        "2021": "ë¼",
        "2022": "ë¼",
        "2023": "ë¼",
        "2024": "ë¼",
        "2025": "ë¼"
    },
    "í™©ì‚°": {
        "2017": "ê°€",
        "2018": "ê°€",
        "2019": "ê°€",
        "2020": "ê°€",
        "2021": "ê°€",
        "2022": "ê°€",
        "2023": "ê°€",
        "2024": "ê°€",
        "2025": "ê°€"
    },
    "íšŒì•¼": {
        "2021": "ë‹¤",
        "2022": "ë‚˜",
        "2023": "ë‚˜",
        "2024": "ë‚˜",
        "2025": "ë‚˜"
    }
};
        const schools = Object.keys(gradeData).sort();

        let careerCounter = 0;
        let bonusCounter = 0;
        let practiceClassCounter = 0;
        let tempCareerCounter = 0;  // ëª¨ë‹¬ ë‚´ ì„ì‹œ ê²½ë ¥ ì¹´ìš´í„°
        let tempCareers = [];  // ëª¨ë‹¬ ë‚´ ì„ì‹œ ê²½ë ¥ ëª©ë¡
        let savedCareers = [];  // ì €ì¥ëœ ê²½ë ¥ ëª©ë¡

        document.addEventListener('DOMContentLoaded', function() {
            initSchoolSelects();
            loadFromLocalStorage();
        });

        function initSchoolSelects() {
            // ì´ì²œ, ì›ë™, ì¢Œì‚¼ì€ í†µí•©ì—ì„œë§Œ ì„ íƒ ê°€ëŠ¥í•˜ë¯€ë¡œ 1~3í¬ë§ì—ì„œëŠ” ì œì™¸
            const schoolsWithoutIntegrated = schools.filter(school =>
                !['ì´ì²œ', 'ì›ë™', 'ì¢Œì‚¼'].includes(school)
            );
            const schoolsForChoice = [...schoolsWithoutIntegrated, 'í†µí•©', 'ì–‘ì‚°êµìœ¡ì§€ì›ì²­'];
            const schoolsWithEdu = [...schools, 'ì–‘ì‚°êµìœ¡ì§€ì›ì²­'];

            // í˜„ì„êµëŠ” ê²€ìƒ‰ ê°€ëŠ¥í•œ inputìœ¼ë¡œ ì„¤ì • (schools + ì–‘ì‚°êµìœ¡ì§€ì›ì²­)
            setupSearchableSelect('currentSchool', schoolsWithEdu, () => {
                calculateCurrentSchoolYears();
            });

            // 1~3í¬ë§ì€ ê²€ìƒ‰ ê°€ëŠ¥í•œ inputìœ¼ë¡œ ì„¤ì • (ì´ì²œ,ì›ë™,ì¢Œì‚¼ ì œì™¸ + í†µí•©, ì–‘ì‚°êµìœ¡ì§€ì›ì²­ í¬í•¨)
            setupSearchableSelect('firstChoice', schoolsForChoice, () => {
                toggleIntegratedSection();
                updateChoiceOptions();
            });
            setupSearchableSelect('secondChoice', schoolsForChoice, () => {
                updateChoiceOptions();
            });
            setupSearchableSelect('thirdChoice', schoolsForChoice, () => {});

            // ì´ˆê¸° ë¡œë“œ ì‹œ ì„ íƒëœ ê°’ì´ ìˆë‹¤ë©´ ì˜µì…˜ ì—…ë°ì´íŠ¸
            updateChoiceOptions();
        }

        function setupSearchableSelect(inputId, options, onChange, dropdownSuffix = 'Dropdown') {
            const input = document.getElementById(inputId);
            const dropdown = document.getElementById(inputId + dropdownSuffix);
            let selectedValue = '';

            if (!input || !dropdown) return; // ìš”ì†Œê°€ ì—†ìœ¼ë©´ ì¢…ë£Œ

            // input í¬ì»¤ìŠ¤ ì‹œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
            input.addEventListener('focus', function() {
                showDropdown(input, dropdown, options, inputId);
            });

            // input ì…ë ¥ ì‹œ í•„í„°ë§
            input.addEventListener('input', function() {
                const searchText = this.value.toLowerCase();
                showDropdown(input, dropdown, options, inputId, searchText);
            });

            // input ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€
            document.addEventListener('click', function(e) {
                if (!input.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });

            // ê°’ ë³€ê²½ ì½œë°± ì €ì¥
            if (onChange) input.onchange = onChange;
        }

        function showDropdown(input, dropdown, options, inputId, searchText = '') {
            dropdown.innerHTML = '';

            // ì œì™¸í•  í•­ëª© ê°€ì ¸ì˜¤ê¸°
            let excludedItems = [];
            if (inputId === 'secondChoice') {
                excludedItems = [document.getElementById('firstChoice').value];
            } else if (inputId === 'thirdChoice') {
                excludedItems = [
                    document.getElementById('firstChoice').value,
                    document.getElementById('secondChoice').value
                ];
            }

            // í•„í„°ë§
            const filtered = options.filter(school => {
                if (excludedItems.includes(school) || school === '') return false;
                if (searchText) {
                    return school.toLowerCase().includes(searchText);
                }
                return true;
            });

            // ë“œë¡­ë‹¤ìš´ ì•„ì´í…œ ìƒì„±
            filtered.forEach(school => {
                const item = document.createElement('div');
                item.className = 'searchable-dropdown-item';
                item.textContent = school;
                item.addEventListener('click', function() {
                    input.value = school;
                    dropdown.classList.add('hidden');

                    // input ì´ë²¤íŠ¸ë¥¼ ëª…ì‹œì ìœ¼ë¡œ íŠ¸ë¦¬ê±° (oninput í•¸ë“¤ëŸ¬ ì‹¤í–‰)
                    const event = new Event('input', { bubbles: true });
                    input.dispatchEvent(event);

                    // onchange ì½œë°± ì‹¤í–‰
                    if (input.onchange) input.onchange();
                });
                dropdown.appendChild(item);
            });

            dropdown.classList.remove('hidden');
        }

        function updateChoiceOptions() {
            // ê²€ìƒ‰ ê°€ëŠ¥í•œ ë“œë¡­ë‹¤ìš´ì—ì„œëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ í•„í„°ë§ë¨
            // ì´ í•¨ìˆ˜ëŠ” ê¸°ì¡´ í˜¸ì¶œ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€
        }

        function toggleIntegratedSection() {
            const firstChoice = document.getElementById('firstChoice').value;
            const section = document.getElementById('integratedSection');
            if (firstChoice === 'í†µí•©') {
                section.classList.remove('hidden');
                updateIntegratedOptions();
            } else {
                section.classList.add('hidden');
            }
        }

        function handleTransferTypeChange() {
            const transferType = document.getElementById('transferType').value;
            const secondChoice = document.getElementById('secondChoice');
            const thirdChoice = document.getElementById('thirdChoice');

            // í¬ë§, ìš°ì„ , ì´ˆë¹™, ë¹„ì •ê¸°ëŠ” 1í¬ë§ë§Œ ì„ íƒ ê°€ëŠ¥
            if (['í¬ë§', 'ìš°ì„ ', 'ì´ˆë¹™', 'ë¹„ì •ê¸°'].includes(transferType)) {
                // 2, 3í¬ë§ ë¹„í™œì„±í™” ë° ì´ˆê¸°í™”
                secondChoice.disabled = true;
                thirdChoice.disabled = true;
                secondChoice.value = '';
                thirdChoice.value = '';
                secondChoice.style.backgroundColor = '#f0f0f0';
                thirdChoice.style.backgroundColor = '#f0f0f0';
            } else {
                // ë§Œê¸° ë“± ë‹¤ë¥¸ ì „ë³´êµ¬ë¶„ ì„ íƒ ì‹œ 2, 3í¬ë§ í™œì„±í™”
                secondChoice.disabled = false;
                thirdChoice.disabled = false;
                secondChoice.style.backgroundColor = '';
                thirdChoice.style.backgroundColor = '';
                updateChoiceOptions();
            }
        }

        function updateIntegratedOptions() {
            const integrated1 = document.getElementById('integrated1').value;
            const integrated2 = document.getElementById('integrated2').value;
            const integrated2Select = document.getElementById('integrated2');
            const integrated3Select = document.getElementById('integrated3');

            const integratedSchools = ['ì´ì²œ', 'ì›ë™', 'ì¢Œì‚¼'];

            // í†µí•© 2í¬ë§ ì—…ë°ì´íŠ¸: í†µí•© 1í¬ë§ì—ì„œ ì„ íƒí•œ ê²ƒ ì œì™¸
            const currentIntegrated2Value = integrated2;
            integrated2Select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            integratedSchools.forEach(school => {
                if (school !== integrated1) {
                    const option = document.createElement('option');
                    option.value = school;
                    option.textContent = school;
                    if (school === currentIntegrated2Value) {
                        option.selected = true;
                    }
                    integrated2Select.appendChild(option);
                }
            });

            // í†µí•© 3í¬ë§ ì—…ë°ì´íŠ¸: í†µí•© 1í¬ë§, 2í¬ë§ì—ì„œ ì„ íƒí•œ ê²ƒ ì œì™¸
            const currentIntegrated3Value = integrated3Select.value;
            integrated3Select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            integratedSchools.forEach(school => {
                if (school !== integrated1 && school !== integrated2) {
                    const option = document.createElement('option');
                    option.value = school;
                    option.textContent = school;
                    if (school === currentIntegrated3Value) {
                        option.selected = true;
                    }
                    integrated3Select.appendChild(option);
                }
            });
        }

        // ==================== ê²½ë ¥ ê´€ë¦¬ ì‹œìŠ¤í…œ ====================

        // ê²½ë ¥ ì…ë ¥ ì˜ì—­ í‘œì‹œ
        function showCareerInput() {
            const inputArea = document.getElementById('careerInputArea');
            inputArea.classList.remove('hidden');
            // ì…ë ¥ ì˜ì—­ì„ ì—´ ë•Œë§ˆë‹¤ ì„ì‹œ ê²½ë ¥ ì´ˆê¸°í™”
            tempCareers = [];
            tempCareerCounter = 0;
            renderTempCareerList();
            // ì²« ë²ˆì§¸ ê²½ë ¥ í•­ëª© ìë™ ì¶”ê°€
            addTempCareer();
            // ì…ë ¥ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            setTimeout(() => {
                inputArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        // ê²½ë ¥ ì…ë ¥ ì·¨ì†Œ
        function cancelCareerInput() {
            const inputArea = document.getElementById('careerInputArea');
            inputArea.classList.add('hidden');
            tempCareers = [];
            tempCareerCounter = 0;
        }

        // ëª¨ë‹¬ ë‚´ ì„ì‹œ ê²½ë ¥ ì¶”ê°€
        function addTempCareer() {
            tempCareerCounter++;
            const tempCareer = {
                id: tempCareerCounter,
                school: '',
                period: '',
                startDate: null,
                endDate: null,
                months: 0,
                days: 0
            };
            tempCareers.push(tempCareer);
            renderTempCareerList();
        }

        // ì„ì‹œ ê²½ë ¥ ì‚­ì œ
        function removeTempCareer(id) {
            tempCareers = tempCareers.filter(c => c.id !== id);
            renderTempCareerList();
        }

        // ì„ì‹œ ê²½ë ¥ ëª©ë¡ ë Œë”ë§
        function renderTempCareerList() {
            const container = document.getElementById('tempCareerList');
            if (tempCareers.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">ê²½ë ¥ í•­ëª© ì¶”ê°€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²½ë ¥ì„ ì…ë ¥í•˜ì„¸ìš”.</p>';
                return;
            }

            container.innerHTML = tempCareers.map(career => `
                <div class="temp-career-item" id="temp-career-${career.id}">
                    <button class="btn btn-danger remove-temp-btn" onclick="removeTempCareer(${career.id})">ì‚­ì œ</button>
                    <div class="form-grid" style="gap: 15px;">
                        <div class="form-group">
                            <label>í•™êµëª… <span class="required">*</span></label>
                            <div class="searchable-select">
                                <input type="text" id="temp-school-${career.id}" placeholder="í•™êµëª… ì…ë ¥..." autocomplete="off" value="${career.school}" oninput="updateTempCareer(${career.id}, 'school', this.value)">
                                <div id="temp-school-${career.id}-dropdown" class="searchable-dropdown hidden"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ê·¼ë¬´ê¸°ê°„ <span class="required">*</span></label>
                            <input type="text" id="temp-period-${career.id}" placeholder="2021.03.01~2025.02.28" value="${career.period}" oninput="formatPeriod(this); updateTempCareer(${career.id}, 'period', this.value)">
                        </div>
                    </div>
                </div>
            `).join('');

            // ê²€ìƒ‰ ê°€ëŠ¥í•œ ë“œë¡­ë‹¤ìš´ ì„¤ì •
            const schoolsWithEdu = [...schools, 'ì–‘ì‚°êµìœ¡ì§€ì›ì²­'];
            tempCareers.forEach(career => {
                setupSearchableSelect(`temp-school-${career.id}`, schoolsWithEdu, () => {}, '-dropdown');
            });
        }

        // ì„ì‹œ ê²½ë ¥ ë°ì´í„° ì—…ë°ì´íŠ¸
        function updateTempCareer(id, field, value) {
            const career = tempCareers.find(c => c.id === id);
            if (!career) return;

            career[field] = value;

            // ê¸°ê°„ì´ ì—…ë°ì´íŠ¸ë˜ë©´ ë‚ ì§œ íŒŒì‹±
            if (field === 'period') {
                const periodPattern = /^\d{4}\.\d{2}\.\d{2}[~-]\d{4}\.\d{2}\.\d{2}$/;
                if (periodPattern.test(value)) {
                    const parts = value.split(/[~-]/);
                    career.startDate = new Date(parts[0].replace(/\./g, '-'));
                    career.endDate = new Date(parts[1].replace(/\./g, '-'));

                    // ê°œì›” ìˆ˜ì™€ ì¼ ìˆ˜ ê³„ì‚°
                    const periodData = calculatePeriodMonthsAndDays(career.startDate, career.endDate);
                    career.months = periodData.months;
                    career.days = periodData.days;
                } else {
                    career.startDate = null;
                    career.endDate = null;
                    career.months = 0;
                    career.days = 0;
                }
            }
        }

        // ë‘ ë‚ ì§œ ì‚¬ì´ì˜ ê°œì›” ìˆ˜ì™€ ì¼ ìˆ˜ ê³„ì‚° (ì—­ì— ì˜í•œ ê³„ì‚°: ì‹œì‘ì¼ í¬í•¨, ì¢…ë£Œì¼ í¬í•¨)
        function calculatePeriodMonthsAndDays(startDate, endDate) {
            if (!startDate || !endDate || isNaN(startDate) || isNaN(endDate) || endDate < startDate) {
                return { months: 0, days: 0 };
            }

            let years = endDate.getFullYear() - startDate.getFullYear();
            let months = endDate.getMonth() - startDate.getMonth();
            let days = endDate.getDate() - startDate.getDate();

            // ì—­ì— ì˜í•œ ê³„ì‚°: ì¢…ë£Œì¼ = ì‘ë‹¹ì¼ì˜ ì „ì¼
            // ì˜ˆ: 2021.03.01 ~ 2022.02.28 = 1ë…„ (2022.03.01ì˜ ì „ì¼)
            // ë”°ë¼ì„œ ì¢…ë£Œì¼ì— 1ì¼ì„ ë”í•˜ì—¬ ì‘ë‹¹ì¼ë¡œ ë§Œë“¤ì–´ ê³„ì‚°
            const adjustedEndDate = new Date(endDate);
            adjustedEndDate.setDate(adjustedEndDate.getDate() + 1);

            years = adjustedEndDate.getFullYear() - startDate.getFullYear();
            months = adjustedEndDate.getMonth() - startDate.getMonth();
            days = adjustedEndDate.getDate() - startDate.getDate();

            // ì¼ìˆ˜ ì¡°ì •
            if (days < 0) {
                months--;
                const prevMonth = new Date(adjustedEndDate.getFullYear(), adjustedEndDate.getMonth(), 0);
                days += prevMonth.getDate();
            }

            // ì›”ìˆ˜ ì¡°ì •
            if (months < 0) {
                years--;
                months += 12;
            }

            // ì¼ìˆ˜ê°€ 30ì¼ì„ ë„˜ìœ¼ë©´ 1ê°œì›”ë¡œ ë³€í™˜ (30ì¼ = 1ê°œì›” ê·œì¹™)
            if (days >= 30) {
                const additionalMonths = Math.floor(days / 30);
                months += additionalMonths;
                days = days % 30;
            }

            // ì›”ìˆ˜ê°€ 12ê°œì›”ì„ ë„˜ìœ¼ë©´ ë…„ë„ë¡œ ë³€í™˜
            if (months >= 12) {
                years += Math.floor(months / 12);
                months = months % 12;
            }

            return { months: years * 12 + months, days: days };
        }

        // ë‘ ë‚ ì§œ ì‚¬ì´ì˜ ê°œì›” ìˆ˜ ê³„ì‚° (í˜¸í™˜ì„± ìœ ì§€)
        function calculateMonthsBetween(startDate, endDate) {
            const result = calculatePeriodMonthsAndDays(startDate, endDate);
            return result.months;
        }

        // ë‘ ë‚ ì§œ ì‚¬ì´ì˜ ì¼ ìˆ˜ ê³„ì‚°
        function calculateDaysBetween(startDate, endDate) {
            const diffTime = endDate - startDate;
            return Math.floor(diffTime / (1000 * 60 * 60 * 24));
        }

        // ë‚ ì§œì—ì„œ ê°œì›” ìˆ˜ì™€ ì¼ ìˆ˜ ë¹¼ê¸° (ì—­ì— ì˜í•œ ê³„ì‚° ì ìš©)
        function subtractMonthsAndDaysFromDate(date, months, days) {
            const result = new Date(date);

            // ë¨¼ì € ì¼ ìˆ˜ë¥¼ ë¹¼ê¸°
            result.setDate(result.getDate() - days);

            // ê·¸ ë‹¤ìŒ ê°œì›” ìˆ˜ë¥¼ ë¹¼ê¸°
            const years = Math.floor(months / 12);
            const remainingMonths = months % 12;

            result.setFullYear(result.getFullYear() - years);
            result.setMonth(result.getMonth() - remainingMonths);

            // ì—­ì— ì˜í•œ ê³„ì‚°: ì‹œì‘ì¼ = (ì¢…ë£Œì¼ - ê¸°ê°„) + 1ì¼
            result.setDate(result.getDate() + 1);

            return result;
        }

        // ë‚ ì§œì—ì„œ ê°œì›” ìˆ˜ ë¹¼ê¸° (í˜¸í™˜ì„± ìœ ì§€)
        function subtractMonthsFromDate(date, months) {
            return subtractMonthsAndDaysFromDate(date, months, 0);
        }

        // ì˜ˆ: ì¢…ë£Œì¼ 2020.06.10, 6ê°œì›” ë¹¼ê¸°
        //     6ê°œì›” ì „: 2019.12.10
        //     ì‹œì‘ì¼: 2019.12.11
        //     ê²€ì¦: 2019.12.11 ~ 2020.06.10 = 6ê°œì›”

        // 48ê°œì›”ì„ ì—­ì— ì˜í•œ ê³„ì‚°ìœ¼ë¡œ ì‹œì‘ì¼ ì°¾ê¸° (ë¯¼ë²• ì œ160ì¡°)
        function calculate48MonthsStart(endDate) {
            const result = new Date(endDate);
            // 48ê°œì›” = 4ë…„ì„ ë‹¬ë ¥ ê¸°ì¤€ìœ¼ë¡œ ë¹¼ê¸°
            result.setFullYear(result.getFullYear() - 4);
            // ì—­ì— ì˜í•œ ê³„ì‚°: ê¸°ê°„ ë§Œë£Œì¼(ì¢…ë£Œì¼)ì´ ê¸°ì‚°ì¼ì˜ ì „ì¼ì´ë¯€ë¡œ
            // ì‹œì‘ì¼ = (ì¢…ë£Œì¼ - 4ë…„) + 1ì¼
            result.setDate(result.getDate() + 1);
            return result;
        }

        // ì˜ˆ: ì¢…ë£Œì¼ 2025.02.28
        //     4ë…„ ì „: 2021.02.28
        //     ì‹œì‘ì¼: 2021.03.01
        //     ê²€ì¦: 2021.03.01 ~ 2025.02.28 = ì •í™•íˆ 4ë…„ (48ê°œì›”)

        // ëª¨ë“  ê²½ë ¥ ì €ì¥ ë° 48ê°œì›” ì œí•œ ì ìš©
        function saveAllCareers() {
            // ì…ë ¥ ê²€ì¦
            const invalidCareers = tempCareers.filter(c => !c.school || !c.period || c.months === 0);
            if (invalidCareers.length > 0) {
                alert('ëª¨ë“  ê²½ë ¥ì˜ í•™êµëª…ê³¼ ê·¼ë¬´ê¸°ê°„ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ê¸°ì¡´ savedCareersë¥¼ ì›ë³¸ ë°ì´í„°ë¡œ ë³µì› (ì¡°ì • ì „ ë°ì´í„°)
            const originalSavedCareers = savedCareers.map(career => ({
                school: career.school,
                period: career.originalPeriod || career.period,
                startDate: career.originalStartDate || career.startDate,
                endDate: career.originalEndDate || career.endDate,
                months: career.originalMonths || career.months,
                days: career.originalDays || career.days
            }));

            // ê¸°ì¡´ ê²½ë ¥ê³¼ ìƒˆ ê²½ë ¥ì„ í•©ì¹¨
            const allCareers = [...originalSavedCareers, ...tempCareers];

            // ì „ì²´ ê²½ë ¥ì˜ ì´ ê°œì›” ìˆ˜ì™€ ì¼ ìˆ˜ ê³„ì‚°
            let totalMonths = allCareers.reduce((sum, c) => sum + c.months, 0);
            let totalDays = allCareers.reduce((sum, c) => sum + c.days, 0);

            // ì¼ ìˆ˜ë¥¼ ê°œì›”ë¡œ ë³€í™˜ (30ì¼ = 1ê°œì›”)
            const additionalMonths = Math.floor(totalDays / 30);
            totalMonths += additionalMonths;
            totalDays = totalDays % 30;

            // ì „ì²´ ê²½ë ¥ì— 48ê°œì›” ì œí•œ ì ìš©
            const adjustedCareers = adjustCareersTo48Months([...allCareers], totalMonths, totalDays);

            // ì €ì¥ëœ ê²½ë ¥ ëª©ë¡ ì „ì²´ ê°±ì‹ 
            savedCareers = adjustedCareers;

            // í…Œì´ë¸” ë Œë”ë§
            renderSavedCareers();

            // ì…ë ¥ ì˜ì—­ ë‹«ê¸°
            cancelCareerInput();

            // ì ìˆ˜ ì¬ê³„ì‚°
            calculateScore();
        }

        // 48ê°œì›” ì œí•œ ì ìš© ë¡œì§ (ìˆœì°¨ ëˆ„ì  ë°©ì‹)
        function adjustCareersTo48Months(careers, totalMonths, totalDays) {
            // ìµœì‹ ìˆœ ì •ë ¬ (ì¢…ë£Œì¼ ê¸°ì¤€)
            careers.sort((a, b) => b.endDate - a.endDate);

            const result = [];
            let remainingMonths = 48; // 48ê°œì›” = 4ë…„
            let remainingDays = 0;

            // ì´ ê°œì›” ìˆ˜ê°€ 48ê°œì›”ì„ ì´ˆê³¼í•˜ëŠ”ì§€ í™•ì¸
            const totalExceeds48 = totalMonths > 48 || (totalMonths === 48 && totalDays > 0);

            for (const career of careers) {
                if (remainingMonths <= 0 && remainingDays <= 0) {
                    // 48ê°œì›” ì´ˆê³¼, ë” ì´ìƒ ê²½ë ¥ í¬í•¨ ì•ˆ í•¨
                    break;
                }

                // ì´ ê²½ë ¥ì˜ ê°œì›” ìˆ˜ì™€ ì¼ ìˆ˜
                const careerMonths = career.months;
                const careerDays = career.days;

                // ì´ ê²½ë ¥ì´ ë‚¨ì€ ê³µê°„ì— ì™„ì „íˆ í¬í•¨ë˜ëŠ”ì§€ í™•ì¸
                const fitsCompletely = (careerMonths < remainingMonths) ||
                                       (careerMonths === remainingMonths && careerDays <= remainingDays);

                if (fitsCompletely) {
                    // ì „ì²´ ê²½ë ¥ì´ 48ê°œì›” ë²”ìœ„ ë‚´ì— í¬í•¨ë¨ (ì¡°ì • ë¶ˆí•„ìš”)
                    result.push({
                        ...career,
                        originalPeriod: career.period,
                        originalStartDate: career.startDate,
                        originalEndDate: career.endDate,
                        originalMonths: career.months,
                        originalDays: career.days,
                        adjustedPeriod: null,
                        adjustedStartDate: career.startDate,
                        adjustedEndDate: career.endDate,
                        isAdjusted: false
                    });

                    // ë‚¨ì€ ê³µê°„ ê°ì†Œ
                    remainingDays -= careerDays;
                    if (remainingDays < 0) {
                        remainingMonths--;
                        remainingDays += 30;
                    }
                    remainingMonths -= careerMonths;
                } else {
                    // ì¼ë¶€ë§Œ í¬í•¨ (ì¡°ì • í•„ìš”)
                    // ì¢…ë£Œì¼ì—ì„œ ë‚¨ì€ ê³µê°„ë§Œí¼ë§Œ í¬í•¨
                    const adjustedEndDate = career.endDate;
                    const adjustedStartDate = subtractMonthsAndDaysFromDate(
                        adjustedEndDate,
                        remainingMonths,
                        remainingDays
                    );

                    const adjustedPeriodStr = `${formatDateToString(adjustedStartDate)}~${formatDateToString(adjustedEndDate)}`;

                    result.push({
                        ...career,
                        originalPeriod: career.period,
                        originalStartDate: career.startDate,
                        originalEndDate: career.endDate,
                        originalMonths: career.months,
                        originalDays: career.days,
                        adjustedPeriod: adjustedPeriodStr,
                        adjustedStartDate: adjustedStartDate,
                        adjustedEndDate: adjustedEndDate,
                        isAdjusted: true
                    });

                    remainingMonths = 0;
                    remainingDays = 0;
                }
            }

            return result;
        }

        // Date ê°ì²´ë¥¼ yyyy.mm.dd í˜•ì‹ ë¬¸ìì—´ë¡œ ë³€í™˜
        function formatDateToString(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}.${month}.${day}`;
        }

        // ì¡°ì •ëœ ê·¼ë¬´ì—°ìˆ˜ ê³„ì‚° (ê³µí†µ í•¨ìˆ˜)
        function calculateAdjustedServiceYears() {
            if (savedCareers.length === 0) return [];

            // ê·¼ë¬´ì—°ìˆ˜ ê³„ì‚° (15ì¼ ì´ìƒ ì˜¬ë¦¼)
            const careerServiceYears = savedCareers.map(career => {
                const startDate = career.adjustedStartDate || career.startDate;
                const endDate = career.adjustedEndDate || career.endDate;

                let years = endDate.getFullYear() - startDate.getFullYear();
                let months = endDate.getMonth() - startDate.getMonth();
                let days = endDate.getDate() - startDate.getDate();

                if (days < 0) {
                    months--;
                    const prevMonth = new Date(endDate.getFullYear(), endDate.getMonth(), 0);
                    days += prevMonth.getDate();
                }

                if (months < 0) {
                    years--;
                    months += 12;
                }

                // 15ì¼ ì´ìƒì´ë©´ 1ê°œì›”ë¡œ ì˜¬ë¦¼
                if (days >= 15) {
                    months++;
                    if (months >= 12) {
                        years++;
                        months -= 12;
                    }
                }

                const totalMonths = years * 12 + months;
                return { years, months, totalMonths };
            });

            // ì „ì²´ ê·¼ë¬´ì—°ìˆ˜ í•©ê³„ ê³„ì‚° (ì´ ê°œì›” ìˆ˜)
            const totalMonthsSum = careerServiceYears.reduce((sum, sy) => sum + sy.totalMonths, 0);

            // 48ê°œì›”(4ë…„)ì„ ì´ˆê³¼í•˜ë©´ ê°€ì¥ ì˜¤ë˜ëœ ê²½ë ¥(ë§ˆì§€ë§‰ ê²½ë ¥)ì˜ ê·¼ë¬´ì—°ìˆ˜ ì¡°ì •
            let adjustedServiceYears = [...careerServiceYears];
            if (totalMonthsSum > 48) {
                const excessMonths = totalMonthsSum - 48;
                const oldestIndex = adjustedServiceYears.length - 1;

                // ê°€ì¥ ì˜¤ë˜ëœ ê²½ë ¥ì˜ ì´ ê°œì›” ìˆ˜ì—ì„œ ì´ˆê³¼ë¶„ ì°¨ê°
                let adjustedTotalMonths = adjustedServiceYears[oldestIndex].totalMonths - excessMonths;

                // ìŒìˆ˜ê°€ ë˜ì§€ ì•Šë„ë¡
                if (adjustedTotalMonths < 0) adjustedTotalMonths = 0;

                const adjustedYears = Math.floor(adjustedTotalMonths / 12);
                const adjustedMonths = adjustedTotalMonths % 12;

                adjustedServiceYears[oldestIndex] = {
                    years: adjustedYears,
                    months: adjustedMonths,
                    totalMonths: adjustedTotalMonths
                };
            }

            return adjustedServiceYears;
        }

        // ì €ì¥ëœ ê²½ë ¥ ëª©ë¡ ë Œë”ë§
        function renderSavedCareers() {
            const list = document.getElementById('careerList');

            if (savedCareers.length === 0) {
                list.innerHTML = '<tr><td colspan="6" style="padding: 20px; text-align: center; color: #999;">ê²½ë ¥ ì¶”ê°€ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê²½ë ¥ì„ ì…ë ¥í•˜ì„¸ìš”.</td></tr>';
                return;
            }

            const adjustedServiceYears = calculateAdjustedServiceYears();

            list.innerHTML = savedCareers.map((career, index) => {
                // ê·¼ë¬´ê¸°ê°„ í‘œì‹œ
                let periodDisplay = career.originalPeriod;
                if (career.isAdjusted && career.adjustedPeriod) {
                    periodDisplay = `${career.originalPeriod} â†’ <span style="color: #4A90E2; font-weight: 600;">${career.adjustedPeriod} (ì¡°ì •ëœ ê¸°ê°„)</span>`;
                }

                // ê¸‰ì§€ ë° ì ìˆ˜í‘œ ê²°ì •
                const startDate = career.adjustedStartDate || career.startDate;
                const grade = findGrade(career.school, startDate);
                const scoreTable = determineScoreTable(startDate);
                const monthlyScore = scoreTable[grade] ? scoreTable[grade][11] : 0;

                // ì¡°ì •ëœ ê·¼ë¬´ì—°ìˆ˜
                const serviceYear = adjustedServiceYears[index];
                const serviceYearDisplay = `${serviceYear.years}.${String(serviceYear.months).padStart(2, '0')}`;

                // ì ìˆ˜ ê³„ì‚° (ì¡°ì •ëœ ê·¼ë¬´ì—°ìˆ˜ ê¸°ë°˜)
                const score = calculateScoreForCareer(grade, serviceYear.years, serviceYear.months, scoreTable);

                return `
                    <tr id="saved-career-${index}">
                        <td>${career.school}</td>
                        <td>${periodDisplay}</td>
                        <td>${grade}(${monthlyScore.toFixed(1)})</td>
                        <td>${serviceYearDisplay}</td>
                        <td>${score.toFixed(3)}</td>
                        <td><button class="btn btn-danger delete-btn" onclick="removeSavedCareer(${index})">ì‚­ì œ</button></td>
                    </tr>
                `;
            }).join('');

            // í˜„ì„êµ ê·¼ë¬´ì—°ìˆ˜ ìë™ ê³„ì‚°
            calculateCurrentSchoolYears();
        }

        // ê°œì›” ìˆ˜ë¥¼ ë…„.ì›” í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        function calculateServiceYearsFromMonths(totalMonths) {
            const years = Math.floor(totalMonths / 12);
            const months = totalMonths % 12;
            return {years, months};
        }

        // í˜„ì„êµ ê·¼ë¬´ì—°ìˆ˜ ìë™ ê³„ì‚°
        function calculateCurrentSchoolYears() {
            const currentSchool = document.getElementById('currentSchool').value.trim();
            if (!currentSchool || savedCareers.length === 0) {
                return;
            }

            // í˜„ì„êµì™€ ì¼ì¹˜í•˜ëŠ” ê²½ë ¥ë“¤ í•„í„°ë§
            const matchingCareers = savedCareers.filter(career => {
                return career.school === currentSchool;
            });

            if (matchingCareers.length === 0) {
                return;
            }

            // ì „ì²´ ê·¼ë¬´ê¸°ê°„ í•©ì‚° (ì›ë³¸ ë°ì´í„° ì‚¬ìš©, 4ë…„ ì œí•œ ì—†ìŒ)
            let totalMonths = 0;
            let totalDays = 0;

            matchingCareers.forEach(career => {
                const startDate = career.originalStartDate || career.startDate;
                const endDate = career.originalEndDate || career.endDate;

                // ì—­ì— ì˜í•œ ê³„ì‚°ìœ¼ë¡œ ê°œì›” ìˆ˜ì™€ ì¼ ìˆ˜ ê³„ì‚°
                const periodData = calculatePeriodMonthsAndDays(startDate, endDate);
                totalMonths += periodData.months;
                totalDays += periodData.days;
            });

            // ì¼ ìˆ˜ë¥¼ ê°œì›”ë¡œ ë³€í™˜ (30ì¼ = 1ê°œì›” ê·œì¹™ ì ìš©)
            const additionalMonths = Math.floor(totalDays / 30);
            totalMonths += additionalMonths;
            // 30ì¼ ë¯¸ë§Œì˜ ì”ì—¬ì¼ìˆ˜ëŠ” ë²„ë¦¼

            // ë…„ê³¼ ì›”ë¡œ ë³€í™˜
            const years = Math.floor(totalMonths / 12);
            const months = totalMonths % 12;

            // y.mm í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
            const displayValue = `${years}.${String(months).padStart(2, '0')}`;
            document.getElementById('currentSchoolYears').value = displayValue;
        }

        // í•™êµ ê¸‰ì§€ ì°¾ê¸°
        function findGrade(schoolName, startDate) {
            const year = startDate.getFullYear();
            if (gradeData[schoolName] && gradeData[schoolName][year]) {
                return gradeData[schoolName][year];
            }
            return 'ê°€';  // ê¸°ë³¸ê°’
        }

        // ì ìˆ˜í‘œ ê²°ì • (2018.2.28 ê¸°ì¤€)
        function determineScoreTable(startDate) {
            const cutoffDate = new Date('2018-02-28');
            return startDate <= cutoffDate ? scoreTable2018Old : scoreTable2018New;
        }

        // ê²½ë ¥ ì ìˆ˜ ê³„ì‚°
        function calculateScoreForCareer(grade, years, months, scoreTable) {
            if (!scoreTable[grade]) return 0;

            const monthlyScoreFor12Months = scoreTable[grade][11];
            const yearScore = years * monthlyScoreFor12Months;
            const monthScore = months > 0 ? scoreTable[grade][months - 1] : 0;

            return yearScore + monthScore;
        }

        // ì €ì¥ëœ ê²½ë ¥ ì‚­ì œ
        function removeSavedCareer(index) {
            if (confirm('ì´ ê²½ë ¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›
                const originalCareers = savedCareers.map(career => ({
                    school: career.school,
                    period: career.originalPeriod || career.period,
                    startDate: career.originalStartDate || career.startDate,
                    endDate: career.originalEndDate || career.endDate,
                    months: career.originalMonths || career.months,
                    days: career.originalDays || career.days
                }));

                // í•´ë‹¹ ì¸ë±ìŠ¤ì˜ ê²½ë ¥ ì‚­ì œ
                originalCareers.splice(index, 1);

                // ë‚¨ì€ ê²½ë ¥ì´ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
                if (originalCareers.length === 0) {
                    savedCareers = [];
                    renderSavedCareers();
                    calculateScore();
                    return;
                }

                // ì „ì²´ ê²½ë ¥ì˜ ì´ ê°œì›” ìˆ˜ì™€ ì¼ ìˆ˜ ì¬ê³„ì‚°
                let totalMonths = originalCareers.reduce((sum, c) => sum + c.months, 0);
                let totalDays = originalCareers.reduce((sum, c) => sum + c.days, 0);

                // ì¼ ìˆ˜ë¥¼ ê°œì›”ë¡œ ë³€í™˜
                const additionalMonths = Math.floor(totalDays / 30);
                totalMonths += additionalMonths;
                totalDays = totalDays % 30;

                // ì „ì²´ ê²½ë ¥ì— 48ê°œì›” ì œí•œ ì¬ì ìš©
                savedCareers = adjustCareersTo48Months([...originalCareers], totalMonths, totalDays);

                renderSavedCareers();
                calculateScore();
            }
        }

        // 2018.2.28 ì‹¤ì ê¹Œì§€ ì ìˆ˜í‘œ (ì›”ë³„)
        const scoreTable2018Old = {
            'ê°€': [0.50, 1.00, 1.50, 2.00, 2.50, 3.00, 3.50, 4.00, 4.50, 5.00, 5.50, 6.00],
            'ë‚˜': [0.58, 1.17, 1.75, 2.33, 2.92, 3.50, 4.08, 4.67, 5.25, 5.83, 6.42, 7.00],
            'ë‹¤': [0.67, 1.33, 2.00, 2.67, 3.33, 4.00, 4.67, 5.33, 6.00, 6.67, 7.33, 8.00],
            'ë¼': [0.75, 1.50, 2.25, 3.00, 3.75, 4.50, 5.25, 6.00, 6.75, 7.50, 8.25, 9.00]
        };

        // 2018.3.1 ì‹¤ì ë¶€í„° ì ìˆ˜í‘œ (ì›”ë³„)
        const scoreTable2018New = {
            'ê°€': [0.63, 1.25, 1.88, 2.50, 3.13, 3.75, 4.38, 5.00, 5.63, 6.25, 6.88, 7.50],
            'ë‚˜': [0.67, 1.33, 2.00, 2.67, 3.33, 4.00, 4.67, 5.33, 6.00, 6.67, 7.33, 8.00],
            'ë‹¤': [0.71, 1.42, 2.13, 2.83, 3.54, 4.25, 4.96, 5.67, 6.38, 7.08, 7.79, 8.50],
            'ë¼': [0.75, 1.50, 2.25, 3.00, 3.75, 4.50, 5.25, 6.00, 6.75, 7.50, 8.25, 9.00]
        };

        // ì—­ì— ì˜í•œ ê·¼ë¬´ì—°ìˆ˜ ê³„ì‚° (15ì¼ ì´ìƒ ì˜¬ë¦¼)
        function calculateServiceYears(startDateStr, endDateStr) {
            const start = new Date(startDateStr.replace(/\./g, '-'));
            const end = new Date(endDateStr.replace(/\./g, '-'));

            if (isNaN(start) || isNaN(end) || end <= start) return null;

            // ì—°, ì›”, ì¼ ì°¨ì´ ê³„ì‚°
            let years = end.getFullYear() - start.getFullYear();
            let months = end.getMonth() - start.getMonth();
            let days = end.getDate() - start.getDate();

            // ì¼ìˆ˜ê°€ ìŒìˆ˜ë©´ ì´ì „ ë‹¬ì—ì„œ ë¹Œë ¤ì˜´
            if (days < 0) {
                months--;
                const prevMonth = new Date(end.getFullYear(), end.getMonth(), 0);
                days += prevMonth.getDate();
            }

            // ì›”ìˆ˜ê°€ ìŒìˆ˜ë©´ ì´ì „ ë…„ë„ì—ì„œ ë¹Œë ¤ì˜´
            if (months < 0) {
                years--;
                months += 12;
            }

            // 15ì¼ ì´ìƒì´ë©´ ì˜¬ë¦¼
            if (days >= 15) {
                months++;
                if (months >= 12) {
                    years++;
                    months -= 12;
                }
            }

            return { years, months };
        }

        // ê¸‰ì§€ ë° ì ìˆ˜ ìë™ ê³„ì‚°
        function calculateCareerGradeAndScore(id) {
            const schoolInput = document.getElementById(`career-school-${id}`);
            const periodInput = document.getElementById(`career-period-${id}`);
            const gradeInput = document.getElementById(`career-grade-${id}`);
            const yearsInput = document.getElementById(`career-years-${id}`);
            const scoreInput = document.getElementById(`career-score-${id}`);

            const school = schoolInput.value.trim();
            const period = periodInput.value.trim();

            // í•™êµëª… ë˜ëŠ” ê¸°ê°„ì´ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
            if (!school || !period) {
                gradeInput.value = '';
                yearsInput.value = '';
                scoreInput.value = '';
                calculateScore();
                return;
            }

            // ì™„ì „í•œ ê¸°ê°„ í˜•ì‹ì¸ì§€ í™•ì¸ (yyyy.mm.dd~yyyy.mm.dd)
            const fullPeriodPattern = /^\d{4}\.\d{2}\.\d{2}[~-]\d{4}\.\d{2}\.\d{2}$/;
            if (!fullPeriodPattern.test(period)) {
                // ì™„ì „í•˜ì§€ ì•Šìœ¼ë©´ ê³„ì‚°í•˜ì§€ ì•ŠìŒ
                gradeInput.value = '';
                yearsInput.value = '';
                scoreInput.value = '';
                calculateScore();
                return;
            }

            // ê·¼ë¬´ê¸°ê°„ íŒŒì‹± (-, ~ ëª¨ë‘ ì§€ì›)
            const periodParts = period.split(/[-~]/);
            if (periodParts.length !== 2) {
                gradeInput.value = '';
                yearsInput.value = '';
                scoreInput.value = '';
                calculateScore();
                return;
            }

            let [startStr, endStr] = periodParts.map(s => s.trim());

            // ê·¼ë¬´ì—°ìˆ˜ ê³„ì‚°
            let serviceYears = calculateServiceYears(startStr, endStr);
            if (!serviceYears) {
                yearsInput.value = '';
                scoreInput.value = '';
                calculateScore();
                return;
            }

            // 4ë…„ ì´ˆê³¼ ì‹œ ì¢…ë£Œì¼ë¡œë¶€í„° ì—­ìœ¼ë¡œ 4ë…„ ê³„ì‚°
            if (serviceYears.years > 4 || (serviceYears.years === 4 && serviceYears.months > 0)) {
                const endDate = new Date(endStr.replace(/\./g, '-'));

                // ì¢…ë£Œì¼ì—ì„œ 4ë…„ ì „ ë‚ ì§œ ê³„ì‚°
                let adjustedStartDate = new Date(endDate);
                adjustedStartDate.setFullYear(adjustedStartDate.getFullYear() - 4);
                adjustedStartDate.setDate(adjustedStartDate.getDate() + 1); // í•˜ë£¨ ì¶”ê°€ (ë‹¹ì¼ í¬í•¨ ê³„ì‚°)

                // ì¡°ì •ëœ ì‹œì‘ì¼ ë¬¸ìì—´ ìƒì„±
                const year = adjustedStartDate.getFullYear();
                const month = String(adjustedStartDate.getMonth() + 1).padStart(2, '0');
                const day = String(adjustedStartDate.getDate()).padStart(2, '0');
                const adjustedStartStr = `${year}.${month}.${day}`;

                // ê·¼ë¬´ê¸°ê°„ì„ ì¡°ì •ëœ ê¸°ê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                periodInput.value = `${adjustedStartStr}~${endStr}`;
                startStr = adjustedStartStr;

                // ì¬ê³„ì‚°
                serviceYears = calculateServiceYears(adjustedStartStr, endStr);

                // ì •í™•íˆ 4ë…„ 0ê°œì›”ì´ ë˜ë„ë¡ ì¡°ì •
                serviceYears = { years: 4, months: 0 };
            }

            yearsInput.value = `${serviceYears.years}.${String(serviceYears.months).padStart(2, '0')}`;

            // ê¸‰ì§€ ì°¾ê¸° (grade_data.jsonì—ì„œ)
            const startDate = new Date(startStr.replace(/\./g, '-'));
            const endDate = new Date(endStr.replace(/\./g, '-'));
            const startYear = startDate.getFullYear();
            const endYear = endDate.getFullYear();

            // í•™êµì˜ ê¸‰ì§€ ì°¾ê¸° (ì—°ë„ë³„ë¡œ ê¸‰ì§€ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)
            let grade = null;
            if (gradeData[school]) {
                // ê·¼ë¬´ ê¸°ê°„ ì¤‘ê°„ ì—°ë„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê¸‰ì§€ ì°¾ê¸°
                const midYear = Math.floor((startYear + endYear) / 2);
                for (let year = midYear; year >= startYear; year--) {
                    if (gradeData[school][year]) {
                        grade = gradeData[school][year];
                        break;
                    }
                }
                // ì°¾ì§€ ëª»í–ˆìœ¼ë©´ ê°€ì¥ ìµœê·¼ ì—°ë„ ì‚¬ìš©
                if (!grade) {
                    const years = Object.keys(gradeData[school]).map(y => parseInt(y)).sort((a, b) => b - a);
                    if (years.length > 0) {
                        grade = gradeData[school][years[0]];
                    }
                }
            }

            if (!grade) {
                gradeInput.value = 'ê¸‰ì§€ ì—†ìŒ';
                scoreInput.value = '';
                calculateScore();
                return;
            }

            // 2018.2.28 ê¸°ì¤€ìœ¼ë¡œ ì‹¤ì í‘œ ì„ íƒ
            const cutoffDate = new Date('2018-02-28');
            const useOldTable = endDate <= cutoffDate;
            const scoreTable = useOldTable ? scoreTable2018Old : scoreTable2018New;

            // ì ìˆ˜ ê³„ì‚° (ë…„ìˆ˜ * 12ê°œì›” ì ìˆ˜ + ë‚¨ì€ ì›”ìˆ˜ ì ìˆ˜)
            const years = serviceYears.years;
            const months = serviceYears.months;

            if (scoreTable[grade]) {
                const monthlyScoreFor12Months = scoreTable[grade][11]; // 12ê°œì›” ì ìˆ˜ (ì¸ë±ìŠ¤ 11)
                const yearScore = years * monthlyScoreFor12Months; // ë…„ìˆ˜ * 12ê°œì›” ì ìˆ˜
                const monthScore = months > 0 ? scoreTable[grade][months - 1] : 0; // ë‚¨ì€ ì›”ìˆ˜ ì ìˆ˜ (ì¸ë±ìŠ¤ 0ë¶€í„° ì‹œì‘)
                const totalScore = yearScore + monthScore;

                // ê¸‰ì§€(ì ìˆ˜)ì—ëŠ” 12ê°œì›” ê¸°ì¤€ ì ìˆ˜ë§Œ í‘œì‹œ
                gradeInput.value = `${grade}(${monthlyScoreFor12Months.toFixed(1)})`;
                // ì ìˆ˜ ì—´ì—ëŠ” ì‹¤ì œ ì´ ì ìˆ˜ í‘œì‹œ
                scoreInput.value = totalScore.toFixed(3);
            } else {
                gradeInput.value = grade;
                scoreInput.value = '';
            }

            calculateScore();
        }

        function calculateCareerYears(id) {
            // ì´ í•¨ìˆ˜ëŠ” ì´ì œ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ (calculateCareerGradeAndScoreë¡œ ëŒ€ì²´)
            calculateCareerGradeAndScore(id);
        }

        const bonusTable = {
          "í‘œì°½": [
            {
              "id": "í‘œì°½1",
              "name": "1. êµìœ¡ê° í‘œì°½ ì´ìƒ",
              "score": 1.0,
              "note": "4ë…„ê°„ 2íšŒ ì ìš© / <span style='color: blue;'>ëª¨ë²”ê³µë¬´ì› í‘œì°½ í¬í•¨</span>",
              "inputType": "date"
            },
            {
              "id": "í‘œì°½2",
              "name": "2. í•™ìƒì§€ë„ì‹¤ì  ì¸ì • íƒ€ ë¶€ì²˜ ì¥ê´€ í‘œì°½",
              "score": 1.0,
              "note": "4ë…„ê°„ 2íšŒ ì ìš©",
              "inputType": "date"
            },
            {
              "id": "í‘œì°½3",
              "name": "3. êµìœ¡ì¥ í‘œì°½",
              "score": 0.7,
              "note": "4ë…„ê°„ 2íšŒ ì ìš©",
              "inputType": "date"
            },
            {
              "id": "í‘œì°½4",
              "name": "4. ì§ì†ê¸°ê´€ì¥ í‘œì°½",
              "score": 0.5,
              "note": "4ë…„ê°„ 2íšŒ ì ìš©",
              "inputType": "date"
            }
          ],
          "ê·¼ë¬´ì‹¤ì ": [
            {
              "id": "ê·¼ë¬´1",
              "name": "1. ì—°êµ¬í•™êµ ê·¼ë¬´ì",
              "score": 0.25,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "ë™ì¼ í•™ë…„ë„ ì¤‘ë³µ ê²½ìš° íƒì¼ ì ìš©",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.25
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 0.5
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 0.75
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 1.0
                },
                {
                  "label": "2ë…„ 6ê°œì›”",
                  "months": 30,
                  "score": 1.25
                },
                {
                  "label": "3ë…„",
                  "months": 36,
                  "score": 1.5
                },
                {
                  "label": "3ë…„ 6ê°œì›”",
                  "months": 42,
                  "score": 1.75
                },
                {
                  "label": "4ë…„",
                  "months": 48,
                  "score": 2.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´1b",
              "name": "1. êµìœ¡ì‹¤ìŠµ í˜‘ë ¥í•™êµ ê·¼ë¬´ì",
              "score": 0.25,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "ë™ì¼ í•™ë…„ë„ ì¤‘ë³µ ê²½ìš° íƒì¼ ì ìš©",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.25
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 0.5
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 0.75
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 1.0
                },
                {
                  "label": "2ë…„ 6ê°œì›”",
                  "months": 30,
                  "score": 1.25
                },
                {
                  "label": "3ë…„",
                  "months": 36,
                  "score": 1.5
                },
                {
                  "label": "3ë…„ 6ê°œì›”",
                  "months": 42,
                  "score": 1.75
                },
                {
                  "label": "4ë…„",
                  "months": 48,
                  "score": 2.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´2",
              "name": "2. ë³µì‹í•™ê¸‰ ë‹´ë‹¹ì",
              "score": 0.5,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš©",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.5
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 1.0
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 1.5
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 2.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´3",
              "name": "3. ì›ì–´ë¯¼ ì˜ì–´ë³´ì¡°êµì‚¬ ì½”-í‹°ì²˜",
              "score": 0,
              "unit": "",
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš© / <span style='color: blue;'>2025.2.28 ì´ì „ ì‹¤ì : 6ê°œì›”ë§ˆë‹¤ 0.25,<br>2025.3.1 ì´í›„ ì‹¤ì : 1ê°œì›”ë§ˆë‹¤ 0.04, 1ë…„ì´ë©´ 0.5,<br>1ê°œì›” ë¯¸ë§Œì˜ ê²½ìš°, 15ì¼ ì´ìƒ ê·¼ë¬´í•  ì‹œ 1ê°œì›”ë¡œ ì¸ì •</span>",
              "inputType": "periodButtonDual",
              "periodOptionsBefore": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.25
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 0.5
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 0.75
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 1.0
                }
              ],
              "periodOptionsAfter": [
                {
                  "label": "1ê°œì›”",
                  "months": 1,
                  "score": 0.04
                },
                {
                  "label": "2ê°œì›”",
                  "months": 2,
                  "score": 0.08
                },
                {
                  "label": "3ê°œì›”",
                  "months": 3,
                  "score": 0.12
                },
                {
                  "label": "4ê°œì›”",
                  "months": 4,
                  "score": 0.16
                },
                {
                  "label": "5ê°œì›”",
                  "months": 5,
                  "score": 0.2
                },
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.24
                },
                {
                  "label": "7ê°œì›”",
                  "months": 7,
                  "score": 0.28
                },
                {
                  "label": "8ê°œì›”",
                  "months": 8,
                  "score": 0.32
                },
                {
                  "label": "9ê°œì›”",
                  "months": 9,
                  "score": 0.36
                },
                {
                  "label": "10ê°œì›”",
                  "months": 10,
                  "score": 0.4
                },
                {
                  "label": "11ê°œì›”",
                  "months": 11,
                  "score": 0.44
                },
                {
                  "label": "12ê°œì›”",
                  "months": 12,
                  "score": 0.5
                }
              ]
            },
            {
              "id": "ê·¼ë¬´4",
              "name": "4. ì§€ìì²´ ì§€ì› ì›ì–´ë¯¼ ì˜ì–´ë³´ì¡°êµì‚¬ ì½”-í‹°ì²˜",
              "score": 0.25,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš©",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.25
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 0.5
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 0.75
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 1.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´5",
              "name": "5. êµê³¼ì „ë‹´(ìˆœíšŒ) êµì‚¬",
              "score": 0.5,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš© / <span style='color: red;'>5í•­, 9í•­ì€ ë™ì¼í•™ë…„ë„ ì¤‘ë³µì˜ ê²½ìš° íƒì¼ ì ìš©</span> / <span style='color: blue;'>íŠ¹ìˆ˜êµì‚¬ì˜ ê²½ìš°, íŠ¹ìˆ˜í•™ê¸‰ ë° íŠ¹ìˆ˜í•™êµë§Œ í•´ë‹¹</span>",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.5
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 1.0
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 1.5
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 2.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´6",
              "name": "6. íŒŒê²¬ê·¼ë¬´ì",
              "score": 0.25,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš©",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.25
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 0.5
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 0.75
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 1.0
                },
                {
                  "label": "2ë…„ 6ê°œì›”",
                  "months": 30,
                  "score": 1.25
                },
                {
                  "label": "3ë…„",
                  "months": 36,
                  "score": 1.5
                },
                {
                  "label": "3ë…„ 6ê°œì›”",
                  "months": 42,
                  "score": 1.75
                },
                {
                  "label": "4ë…„",
                  "months": 48,
                  "score": 2.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´7",
              "name": "7. ë³‘ì„¤ìœ ì¹˜ì› ì—°êµ¬ì‹œë²”í•™êµ ê·¼ë¬´ì",
              "score": 0.3,
              "unit": "1ë…„ë§ˆë‹¤",
              "note": "ë™ì¼ í•™ë…„ë„ ì¤‘ë³µ ê²½ìš° íƒì¼ ì ìš© / <span style='color: blue;'>êµê°, êµë¬´, ì—°êµ¬ë¶€ì¥(ì£¼ë¬´)</span>",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 0.3
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 0.6
                },
                {
                  "label": "3ë…„",
                  "months": 36,
                  "score": 0.9
                },
                {
                  "label": "4ë…„",
                  "months": 48,
                  "score": 1.2
                }
              ]
            },
            {
              "id": "ê·¼ë¬´7b",
              "name": "7. íŠ¹ìˆ˜í•™ê¸‰ ì—°êµ¬ì‹œí—˜í•™êµ ê·¼ë¬´ì",
              "score": 0.3,
              "unit": "1ë…„ë§ˆë‹¤",
              "note": "ë™ì¼ í•™ë…„ë„ ì¤‘ë³µ ê²½ìš° íƒì¼ ì ìš© / <span style='color: blue;'>êµê°, êµë¬´, ì—°êµ¬ë¶€ì¥(ì£¼ë¬´)</span>",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 0.3
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 0.6
                },
                {
                  "label": "3ë…„",
                  "months": 36,
                  "score": 0.9
                },
                {
                  "label": "4ë…„",
                  "months": 48,
                  "score": 1.2
                }
              ]
            },
            {
              "id": "ê·¼ë¬´8",
              "name": "8. íŠ¹ìˆ˜êµìœ¡ëŒ€ìƒìì˜ ë‹´ì„",
              "score": 0.25,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš©",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.25
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 0.5
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 0.75
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 1.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´8b",
              "name": "8. ë³µì§€ì¹´ë“œ 1~3ê¸‰ ì†Œì§€ í•™ìƒì˜ ë‹´ì„",
              "score": 0.25,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš©",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.25
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 0.5
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 0.75
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 1.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´9",
              "name": "9. 1í•™ë…„ ë‹´ì„",
              "score": 0.25,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš© / <span style='color: blue;'>2021.3.1. ì´í›„ ì‹¤ì </span>",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.25
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 0.5
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 0.75
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 1.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´9b",
              "name": "9. 6í•™ë…„ ë‹´ì„",
              "score": 0.25,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš©",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.25
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 0.5
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 0.75
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 1.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´10",
              "name": "10. ë¶€ì¥êµì‚¬",
              "score": 0.5,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš© / <span style='color: blue;'>2019.3.1. ì´í›„ ì‹¤ì </span>",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.5
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 1.0
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 1.5
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 2.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´11",
              "name": "11. ì „êµ­ì†Œë…„ì²´ìœ¡ëŒ€íšŒ ë° ì „êµ­ë™ê³„ì²´ìœ¡ëŒ€íšŒ ì…ìƒ ìœ ê³µì",
              "score": 0,
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš© (ë™ì¼ í•™ë…„ë„ ì¤‘ë³µ ê²½ìš° íƒì¼) / <span style='color: blue;'>2024.3.1 ì „ë³´ë¶€í„° 4ë…„ê°„ 2íšŒ ì ìš©</span>",
              "inputType": "dateWithMedal",
              "medalOptions": [
                {
                  "label": "ê¸ˆë©”ë‹¬",
                  "score": 5.0
                },
                {
                  "label": "ì€ë©”ë‹¬",
                  "score": 2.5
                },
                {
                  "label": "ë™ë©”ë‹¬",
                  "score": 1.5
                }
              ]
            },
            {
              "id": "ê·¼ë¬´12",
              "name": "12. ì§ë¬´ìˆ˜í–‰ê³¼ ê´€ë ¨ë˜ëŠ” ê³µì ìœ¼ë¡œ ì „êµ­ ê·œëª¨ì˜ ëŒ€íšŒì—ì„œ êµ­ë¬´ì´ë¦¬ ì´ìƒì˜ ìƒì¥ ìˆ˜ìƒì ë˜ëŠ” êµ­ë¬´ì´ë¦¬ ì´ìƒì˜ ì§€ë„ììƒ ìˆ˜ìƒì",
              "score": 5.0,
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš© (ë™ì¼ í•™ë…„ë„ ì¤‘ë³µ ê²½ìš° íƒì¼) / <span style='color: blue;'>2024.3.1 ì „ë³´ë¶€í„° 4ë…„ê°„ 2íšŒ ì ìš©</span>",
              "inputType": "dateMultiple"
            },
            {
              "id": "ê·¼ë¬´13",
              "name": "13. 2ë…„ê°„ ì´ˆÂ·ì¤‘í•™êµ ì¢…í•©ì²´ìœ¡ëŒ€íšŒ ì…ìƒ ìœ ê³µì (ë„ ëŒ€íšŒ)",
              "score": 0,
              "note": "í•´ë‹¹ ì‹¤ì  ì¸ì •ì€ ìœ ê³µì 1ì¸ì— í•œí•¨ / <span style='color: blue;'>2024.3.1 ì „ë³´ë¶€í„° 4ë…„ê°„ 2íšŒ ì ìš©</span>",
              "inputType": "dateWithRank",
              "rankOptions": [
                {
                  "label": "1ìœ„",
                  "score": 0.5
                },
                {
                  "label": "2ìœ„",
                  "score": 0.3
                },
                {
                  "label": "3ìœ„",
                  "score": 0.1
                }
              ]
            },
            {
              "id": "ê·¼ë¬´14",
              "name": "14. ì²­ë ´ë„ í–¥ìƒì— ê¸°ì—¬í•œ ì",
              "score": 0.5,
              "note": "í˜„ì„êµ 1íšŒë§Œ ì¸ì • / <span style='color: blue;'>ì¡°ì‚¬ê¸°ê´€ì— ì‹ ê³ í•˜ì—¬ ê¸ˆí’ˆìˆ˜ìˆ˜ 10ë§Œì› ì´ìƒ, ê³µê¸ˆíš¡ë ¹Â·ìœ ìš© 100ë§Œì› ì´ìƒ ìœ„ë°˜ í–‰ìœ„ ë°œê²¬ì— ê¸°ì—¬í•œ ê²½ìš°</span>",
              "inputType": "date"
            },
            {
              "id": "ê·¼ë¬´15",
              "name": "15. êµê° ë¯¸ë°°ì¹˜ êµì˜ êµê° ì—…ë¬´ ëŒ€í–‰ì",
              "score": 0.25,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš© / <span style='color: blue;'>1ì¸ë§Œ ì¸ì •</span> / <span style='color: blue;'>2018.3.1. ì´í›„ ì‹¤ì </span>",
              "inputType": "periodButton",
              "periodOptions": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.25
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 0.5
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 0.75
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 1.0
                },
                {
                  "label": "2ë…„ 6ê°œì›”",
                  "months": 30,
                  "score": 1.25
                },
                {
                  "label": "3ë…„",
                  "months": 36,
                  "score": 1.5
                },
                {
                  "label": "3ë…„ 6ê°œì›”",
                  "months": 42,
                  "score": 1.75
                },
                {
                  "label": "4ë…„",
                  "months": 48,
                  "score": 2.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´16",
              "name": "16. ë™ì§€ì—­ ë†ì‚°ì–´ì´ŒìŠ¹ì§„ê°€ì‚°ì  ë¯¸ë¶€ì—¬ í•™êµ",
              "score": 0,
              "note": "",
              "inputType": "gradeWithPeriod",
              "gradeOptions": [
                {
                  "label": "'ê°€Â·ë‚˜' ê¸‰ì§€ ë™ì¼ í•™êµì—ì„œ ì—°ì†í•˜ì—¬ 3ë…„ ì´ìƒ ê·¼ë¬´í•œ ì",
                  "score": 0.75
                },
                {
                  "label": "'ë‹¤Â·ë¼' ê¸‰ì§€ ë™ì¼ í•™êµì—ì„œ ì—°ì†í•˜ì—¬ 3ë…„ ì´ìƒ ê·¼ë¬´í•œ ì",
                  "score": 0.25
                }
              ]
            },
            {
              "id": "ê·¼ë¬´17",
              "name": "17. êµìœ¡ì§€ì›ì²­ ê·¼ë¬´ ì „ë¬¸ìƒë‹´êµì‚¬",
              "score": 0,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "",
              "inputType": "periodButtonDual",
              "cutoffDate": "2025-03-01",
              "periodOptionsBefore": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.5
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 1.0
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 1.5
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 2.0
                },
                {
                  "label": "2ë…„ 6ê°œì›”",
                  "months": 30,
                  "score": 2.5
                },
                {
                  "label": "3ë…„",
                  "months": 36,
                  "score": 3.0
                },
                {
                  "label": "3ë…„ 6ê°œì›”",
                  "months": 42,
                  "score": 3.5
                },
                {
                  "label": "4ë…„",
                  "months": 48,
                  "score": 4.0
                }
              ],
              "periodOptionsAfter": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 1.0
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 2.0
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 3.0
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 4.0
                },
                {
                  "label": "2ë…„ 6ê°œì›”",
                  "months": 30,
                  "score": 5.0
                },
                {
                  "label": "3ë…„",
                  "months": 36,
                  "score": 6.0
                },
                {
                  "label": "3ë…„ 6ê°œì›”",
                  "months": 42,
                  "score": 7.0
                },
                {
                  "label": "4ë…„",
                  "months": 48,
                  "score": 8.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´18",
              "name": "18. ê²½ìƒë‚¨ë„êµìœ¡ì²­ íŠ¹ìˆ˜êµìœ¡ì› íŒŒê²¬ê·¼ë¬´",
              "score": 0,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "",
              "inputType": "periodButtonDual",
              "cutoffDate": "2023-03-01",
              "periodOptionsBefore": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 0.5
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 1.0
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 1.5
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 2.0
                },
                {
                  "label": "2ë…„ 6ê°œì›”",
                  "months": 30,
                  "score": 2.5
                },
                {
                  "label": "3ë…„",
                  "months": 36,
                  "score": 3.0
                },
                {
                  "label": "3ë…„ 6ê°œì›”",
                  "months": 42,
                  "score": 3.5
                },
                {
                  "label": "4ë…„",
                  "months": 48,
                  "score": 4.0
                }
              ],
              "periodOptionsAfter": [
                {
                  "label": "6ê°œì›”",
                  "months": 6,
                  "score": 1.0
                },
                {
                  "label": "1ë…„",
                  "months": 12,
                  "score": 2.0
                },
                {
                  "label": "1ë…„ 6ê°œì›”",
                  "months": 18,
                  "score": 3.0
                },
                {
                  "label": "2ë…„",
                  "months": 24,
                  "score": 4.0
                },
                {
                  "label": "2ë…„ 6ê°œì›”",
                  "months": 30,
                  "score": 5.0
                },
                {
                  "label": "3ë…„",
                  "months": 36,
                  "score": 6.0
                },
                {
                  "label": "3ë…„ 6ê°œì›”",
                  "months": 42,
                  "score": 7.0
                },
                {
                  "label": "4ë…„",
                  "months": 48,
                  "score": 8.0
                }
              ]
            },
            {
              "id": "ê·¼ë¬´19",
              "name": "19. 2ë…„ê°„ ëŒ€ê·œëª¨ í•™êµ ê·¼ë¬´ ì „ë¬¸ìƒë‹´êµì‚¬",
              "score": 0,
              "unit": "6ê°œì›”ë§ˆë‹¤",
              "note": "2025.3.1. ì´í›„ ì‹¤ì ë¶€í„°",
              "inputType": "periodWithClassSize",
              "classSizeOptions": [
                {
                  "label": "36í•™ê¸‰ ì´ìƒ 42í•™ê¸‰ ì´í•˜",
                  "periodOptions": [
                    {"label": "6ê°œì›”", "months": 6, "score": 0.25},
                    {"label": "1ë…„", "months": 12, "score": 0.5},
                    {"label": "1ë…„ 6ê°œì›”", "months": 18, "score": 0.75},
                    {"label": "2ë…„", "months": 24, "score": 1.0}
                  ]
                },
                {
                  "label": "43í•™ê¸‰ ì´ìƒ",
                  "periodOptions": [
                    {"label": "6ê°œì›”", "months": 6, "score": 0.3},
                    {"label": "1ë…„", "months": 12, "score": 0.6},
                    {"label": "1ë…„ 6ê°œì›”", "months": 18, "score": 0.9},
                    {"label": "2ë…„", "months": 24, "score": 1.2}
                  ]
                }
              ]
            },
            {
              "id": "ê·¼ë¬´20",
              "name": "20. ì „ë¬¸ìƒë‹´êµì‚¬ ê´€ë ¨ ìê²©ì¦",
              "score": 0.5,
              "unit": "í‰ì • ê¸°ê°„ì— ì·¨ë“í•œ ê²ƒ",
              "note": "2025.3.1 ì´í›„ ì‹¤ì ë¶€í„°. ì²­ì†Œë…„ ìƒë‹´ì‚¬(ì—¬ì„±ê°€ì¡±ë¶€), ì„ìƒì‹¬ë¦¬ì‚¬/ì§ì—…ìƒë‹´ì‚¬(í•œêµ­ì‚°ì—…ì¸ë ¥ê³µë‹¨), ì‚¬íšŒë³µì§€ì‚¬(ë³´ê±´ë³µì§€ë¶€)",
              "inputType": "date"
            }
          ],
          "ì—°êµ¬ì‹¤ì ": [
            {
              "id": "ì—°êµ¬1",
              "name": "1. ì „êµ­ ë‹¨ìœ„ ì…ìƒì",
              "score": 1.0,
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš© (ë™ì¼ í•™ë…„ë„ ì¤‘ë³µ ê²½ìš° íƒì¼) / <span style='color: blue;'>í•™ìƒì§€ë„ ì‹¤ì  í¬í•¨-ê²½ë‚¨êµìœ¡ì²­ ì¶”ì²œ ëŒ€íšŒì— í•œí•¨</span> / <span style='color: blue;'>2024.3.1 ì „ë³´ë¶€í„° 4ë…„ê°„ 2íšŒ ì ìš©</span>",
              "inputType": "dateMultiple"
            },
            {
              "id": "ì—°êµ¬2",
              "name": "2. ë„ ë‹¨ìœ„ ì…ìƒì",
              "score": 0.5,
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš© (ë™ì¼ í•™ë…„ë„ ì¤‘ë³µ ê²½ìš° íƒì¼) / <span style='color: blue;'>2024.3.1 ì „ë³´ë¶€í„° 4ë…„ê°„ 2íšŒ ì ìš©</span>",
              "inputType": "dateMultiple"
            },
            {
              "id": "ì—°êµ¬3",
              "name": "3. ê°œì¸ ì‘í’ˆ ë°œí‘œì",
              "score": 0.2,
              "note": "2024.3.1 ì „ë³´ë¶€í„° 4ë…„ê°„ 2íšŒ ì ìš© / <span style='color: blue;'>2017.3.1ï½2020.2.29 ì‹¤ì ì— í•œí•¨</span> / 2ì¸ ì´ë‚´ ì €ì„œ ë°œí‘œì í¬í•¨",
              "inputType": "dateMultiple"
            },
            {
              "id": "ì—°êµ¬4",
              "name": "4. í•™ìŠµì§€ë„ ì—°êµ¬ëŒ€íšŒ ë„ëŒ€íšŒ ì…ìƒì, ìˆ˜ì—…ì—°êµ¬êµì‚¬",
              "score": 0.75,
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš© / <span style='color: blue;'>2024.3.1 ì „ë³´ë¶€í„° 4ë…„ê°„ 2íšŒ ì ìš©</span>",
              "inputType": "dateMultiple"
            },
            {
              "id": "ì—°êµ¬5",
              "name": "5. ìˆ˜ì—…ëª…ì‚¬",
              "score": 1.0,
              "note": "4ë…„ê°„ ëˆ„ê°€ ì ìš© / <span style='color: blue;'>2018.3.1. ìˆ˜ì—…ëª…ì‚¬ ì¸ì¦ê¹Œì§€</span> / <span style='color: blue;'>ì·¨ë“ í›„ 10ë…„ê°„</span>",
              "inputType": "date"
            },
            {
              "id": "ì—°êµ¬6",
              "name": "6. í•œêµ­ì‚¬ëŠ¥ë ¥ê²€ì •ì‹œí—˜ 3ê¸‰ ì´ìƒ",
              "score": 0.3,
              "note": "<span style='color: blue;'>ì„ìš© ì „ ìê²©ì·¨ë“ í¬í•¨</span>",
              "inputType": "date"
            }
          ],
          "ìš°ìš°ì¡°ê±´": [
            {
              "id": "ìš°ìš°1",
              "name": "1. êµ­ê°€ìœ ê³µìì™€ ë™ ë¶€ì–‘ì(ë°°ìš°ìì™€ ì§ì ‘ ë¶€ì–‘í•˜ëŠ” ìë…€ì™€ ê·¸ ë°°ìš°ì), ìˆœì§í•œ êµìœ¡ê³µë¬´ì›ì˜ ë°°ìš°ì, ìë…€ì™€ ê·¸ ë°°ìš°ì",
              "score": 1.0,
              "note": "ìš°ìš°ì¡°ê±´ 1 ~ 3 íƒì¼ ì ìš© / <span style='color: blue;'>ë¶€ì–‘ê¸°ê°„ ì…ë ¥</span>",
              "inputType": "period"
            },
            {
              "id": "ìš°ìš°2",
              "name": "2. ë¶€ëª¨(ë°°ìš°ì ë¶€ëª¨ í¬í•¨)ë¥¼ ì¸ì‚¬ ë‹¹í•´ í•™ë…„ë„ ë§ì¼ ê¸°ì¤€ìœ¼ë¡œ 1ë…„ ì´ìƒ ì—°ì†í•˜ì—¬ ì§ì ‘ ë´‰ì–‘í•˜ê³  ìˆëŠ” ì",
              "score": 0.5,
              "note": "ìš°ìš°ì¡°ê±´ 1 ~ 3 íƒì¼ ì ìš© / <span style='color: blue;'>ë¶€ì–‘ê¸°ê°„ ì…ë ¥</span>",
              "inputType": "period"
            },
            {
              "id": "ìš°ìš°3",
              "name": "3. ì¥ì• ì¸ (1ë…„ ì´ìƒ ì¥ì•  ì¦ëª… ì†Œì§€ì ) ë³¸ì¸ ë° ë°°ìš°ì , ë³¸ì¸ ë° ë°°ìš°ìì˜ ì§ê³„ ì¡´ë¹„ì† ì¤‘ ì¥ì• ì¸ (ì¥ì•  ì¦ëª… ì†Œì§€ì )ì„ ì¸ì‚¬ ë‹¹í•´ í•™ë…„ë„ ë§ì¼ ê¸°ì¤€ìœ¼ë¡œ 1ë…„ ì´ìƒ ì—°ì†í•˜ì—¬ ì§ì ‘ ë¶€ì–‘í•˜ê³  ìˆëŠ” ì",
              "score": 1.0,
              "note": "ìš°ìš°ì¡°ê±´ 1 ~ 3 íƒì¼ ì ìš© / <span style='color: blue;'>ë¶€ì–‘ê¸°ê°„ ì…ë ¥</span>",
              "inputType": "period"
            },
            {
              "id": "ìš°ìš°4",
              "name": "4. 55ì„¸ ì´ìƒ êµì‚¬",
              "score": 1.0,
              "note": "<span style='color: blue;'>ê¸°ë³¸ ì •ë³´ì˜ ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤.</span>",
              "inputType": "date"
            },
            {
              "id": "ìš°ìš°5",
              "name": "5. ë§Œ 2ì„¸ ë¯¸ë§Œì˜ ìë…€ê°€ ìˆëŠ” êµì›",
              "score": 1.0,
              "note": "ìš°ìš°ì¡°ê±´ 5 ~ 7 íƒì¼ ì ìš© / <span style='color: blue;'>(ì¤€)ë²½ì§€ ì „ë³´ í¬ë§ì ì œì™¸</span>",
              "inputType": "none"
            },
            {
              "id": "ìš°ìš°6",
              "name": "6. ìë…€ê°€ 3ëª… ì´ìƒì¸ êµì‚¬",
              "score": 1.0,
              "note": "ìš°ìš°ì¡°ê±´ 5 ~ 7 íƒì¼ ì ìš©",
              "inputType": "none"
            },
            {
              "id": "ìš°ìš°7",
              "name": "7. ìë…€ê°€ 2ëª…ì¸ êµì‚¬",
              "score": 0.5,
              "note": "ìš°ìš°ì¡°ê±´ 5 ~ 7 íƒì¼ ì ìš© / <span style='color: blue;'>2021.3.1. ì „ë³´ë¶€í„° ì ìš©</span>",
              "inputType": "none"
            }
          ]
        };

        // ì ìˆ˜ í¬ë§·íŒ… (ë¶ˆí•„ìš”í•œ 0 ì œê±°)
        function formatScore(score) {
            const num = parseFloat(score);
            // ì†Œìˆ˜ì  ì´í•˜ê°€ 0ì´ë©´ ì •ìˆ˜ë¡œ, ì•„ë‹ˆë©´ ì†Œìˆ˜ì  í‘œì‹œ
            if (num % 1 === 0) {
                return num.toFixed(1); // 1.0, 2.0 í˜•ì‹
            } else {
                // ì†Œìˆ˜ì  ì´í•˜ ê°’ì´ ìˆìœ¼ë©´ ë¶ˆí•„ìš”í•œ 0 ì œê±°
                return num.toString();
            }
        }

        // ê·¼ë¬´ì‹¤ì  ê¸°ê°„ í–‰ ì¶”ê°€ í•¨ìˆ˜
        let periodRowCounter = 0;
        function addPeriodRow(bonusId) {
            periodRowCounter++;
            const periodsListContainer = document.getElementById(`bonus-periods-list-${bonusId}`);
            const itemSelect = document.getElementById(`bonus-item-${bonusId}`);
            const selectedOption = itemSelect.options[itemSelect.selectedIndex];

            if (!selectedOption || !selectedOption.value) {
                alert('ë¨¼ì € í‰ì • ëŒ€ìƒì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }

            const inputType = selectedOption.dataset.inputType;
            const originalName = selectedOption.dataset.originalName;
            const rowId = `period-row-${bonusId}-${periodRowCounter}`;

            // ê¸°ê°„ í–‰ ì»¨í…Œì´ë„ˆ ìƒì„±
            const rowDiv = document.createElement('div');
            rowDiv.id = rowId;
            rowDiv.className = 'period-row';
            rowDiv.style.cssText = 'display: flex; gap: 12px; align-items: flex-start; padding: 12px; border: 1px solid #ddd; border-radius: 4px; background: #f9f9f9;';

            if (inputType === 'periodButton') {
                // ì¼ë°˜ ë“œë¡­ë‹¤ìš´ (ê·¼ë¬´1, 2, 4~10)
                const periodOptions = selectedOption.dataset.periodOptions ?
                    JSON.parse(selectedOption.dataset.periodOptions) : [];

                const selectWrapper = document.createElement('div');
                selectWrapper.style.cssText = 'flex: 0 0 200px; display: flex; flex-direction: column; gap: 4px;';

                const selectLabel = document.createElement('label');
                selectLabel.textContent = 'ê¸°ê°„ ì„ íƒ:';
                selectLabel.style.cssText = 'font-size: 13px; font-weight: 500; min-height: 18.5px;';

                const select = document.createElement('select');
                select.className = 'period-select';
                select.dataset.bonusId = bonusId;
                select.dataset.rowId = rowId;
                select.style.cssText = 'width: 100%; padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;';

                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'ì„ íƒí•˜ì„¸ìš”';
                select.appendChild(defaultOption);

                periodOptions.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = JSON.stringify(option);
                    opt.textContent = option.label;
                    select.appendChild(opt);
                });

                select.onchange = function() {
                    recalculateMultiplePeriods(bonusId);
                };

                // ë†’ì´ ë§ì¶”ê¸° ìœ„í•œ ë¹ˆ ë„ì›€ë§ ì˜ì—­
                const selectHelp = document.createElement('div');
                selectHelp.className = 'help-text';
                selectHelp.innerHTML = '&nbsp;'; // ê³µë°± ìœ ì§€
                selectHelp.style.cssText = 'font-size: 12px; color: #666; margin-top: 2px; min-height: 18px;';

                selectWrapper.appendChild(selectLabel);
                selectWrapper.appendChild(select);
                selectWrapper.appendChild(selectHelp);
                rowDiv.appendChild(selectWrapper);

            } else if (inputType === 'periodButtonDual') {
                // ì´ì¤‘ ë“œë¡­ë‹¤ìš´ (ê·¼ë¬´3, 17, 18)
                const periodOptionsBefore = selectedOption.dataset.periodOptionsBefore ?
                    JSON.parse(selectedOption.dataset.periodOptionsBefore) : null;
                const periodOptionsAfter = selectedOption.dataset.periodOptionsAfter ?
                    JSON.parse(selectedOption.dataset.periodOptionsAfter) : null;

                // cutoffDate ì½ê¸° (ì˜ˆ: "2025-03-01" ë˜ëŠ” "2023-03-01")
                const cutoffDate = selectedOption.dataset.cutoffDate || '2025-03-01';
                const cutoffParts = cutoffDate.split('-');
                const cutoffYear = cutoffParts[0];
                const cutoffMonth = cutoffParts[1];
                const cutoffDay = cutoffParts[2];

                // ì´ì „ ë‚ ì§œ ê³„ì‚° (cutoffDate - 1ì¼)
                const beforeDate = new Date(cutoffDate);
                beforeDate.setDate(beforeDate.getDate() - 1);
                const beforeYear = beforeDate.getFullYear();
                const beforeMonth = String(beforeDate.getMonth() + 1).padStart(2, '0');
                const beforeDay = String(beforeDate.getDate()).padStart(2, '0');

                const dualWrapper = document.createElement('div');
                dualWrapper.style.cssText = 'flex: 0 0 280px; display: flex; flex-direction: column; gap: 8px;';

                // ì´ì „ ë“œë¡­ë‹¤ìš´
                if (periodOptionsBefore) {
                    const beforeDiv = document.createElement('div');
                    beforeDiv.style.display = 'flex';
                    beforeDiv.style.flexDirection = 'column';
                    beforeDiv.style.gap = '4px';

                    const beforeLabel = document.createElement('label');
                    beforeLabel.textContent = `${beforeYear}.${beforeMonth}.${beforeDay} ì´ì „:`;
                    beforeLabel.style.fontSize = '13px';
                    beforeLabel.style.fontWeight = '500';

                    const selectBefore = document.createElement('select');
                    selectBefore.className = 'period-select-before';
                    selectBefore.dataset.bonusId = bonusId;
                    selectBefore.dataset.rowId = rowId;
                    selectBefore.style.cssText = 'padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;';

                    const defaultOptionBefore = document.createElement('option');
                    defaultOptionBefore.value = '';
                    defaultOptionBefore.textContent = 'ì„ íƒí•˜ì„¸ìš”';
                    selectBefore.appendChild(defaultOptionBefore);

                    periodOptionsBefore.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = JSON.stringify(option);
                        opt.textContent = option.label;
                        selectBefore.appendChild(opt);
                    });

                    selectBefore.onchange = function() {
                        recalculateMultiplePeriods(bonusId);
                    };

                    beforeDiv.appendChild(beforeLabel);
                    beforeDiv.appendChild(selectBefore);
                    dualWrapper.appendChild(beforeDiv);
                }

                // ì´í›„ ë“œë¡­ë‹¤ìš´
                if (periodOptionsAfter) {
                    const afterDiv = document.createElement('div');
                    afterDiv.style.display = 'flex';
                    afterDiv.style.flexDirection = 'column';
                    afterDiv.style.gap = '4px';

                    const afterLabel = document.createElement('label');
                    afterLabel.textContent = `${cutoffYear}.${cutoffMonth}.${cutoffDay} ì´í›„:`;
                    afterLabel.style.fontSize = '13px';
                    afterLabel.style.fontWeight = '500';

                    const selectAfter = document.createElement('select');
                    selectAfter.className = 'period-select-after';
                    selectAfter.dataset.bonusId = bonusId;
                    selectAfter.dataset.rowId = rowId;
                    selectAfter.style.cssText = 'padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;';

                    const defaultOptionAfter = document.createElement('option');
                    defaultOptionAfter.value = '';
                    defaultOptionAfter.textContent = 'ì„ íƒí•˜ì„¸ìš”';
                    selectAfter.appendChild(defaultOptionAfter);

                    periodOptionsAfter.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = JSON.stringify(option);
                        opt.textContent = option.label;
                        selectAfter.appendChild(opt);
                    });

                    selectAfter.onchange = function() {
                        recalculateMultiplePeriods(bonusId);
                    };

                    afterDiv.appendChild(afterLabel);
                    afterDiv.appendChild(selectAfter);
                    dualWrapper.appendChild(afterDiv);
                }

                // ë†’ì´ ë§ì¶”ê¸° ìœ„í•œ ë¹ˆ ë„ì›€ë§ ì˜ì—­
                const dualHelp = document.createElement('div');
                dualHelp.className = 'help-text';
                dualHelp.innerHTML = '&nbsp;'; // ê³µë°± ìœ ì§€
                dualHelp.style.cssText = 'font-size: 12px; color: #666; margin-top: 2px; min-height: 18px;';
                dualWrapper.appendChild(dualHelp);

                rowDiv.appendChild(dualWrapper);
            } else if (inputType === 'dateWithMedal') {
                // ë©”ë‹¬ ì„ íƒ ë“œë¡­ë‹¤ìš´ (ê·¼ë¬´11)
                const medalOptions = selectedOption.dataset.medalOptions ?
                    JSON.parse(selectedOption.dataset.medalOptions) : [];

                const medalWrapper = document.createElement('div');
                medalWrapper.style.cssText = 'flex: 0 0 200px; display: flex; flex-direction: column; gap: 4px;';

                const medalLabel = document.createElement('label');
                medalLabel.textContent = 'ë©”ë‹¬ ì„ íƒ:';
                medalLabel.style.cssText = 'font-size: 13px; font-weight: 500; min-height: 18.5px;';

                const medalSelect = document.createElement('select');
                medalSelect.className = 'medal-select';
                medalSelect.dataset.bonusId = bonusId;
                medalSelect.dataset.rowId = rowId;
                medalSelect.style.cssText = 'width: 100%; padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;';

                const defaultMedalOption = document.createElement('option');
                defaultMedalOption.value = '';
                defaultMedalOption.textContent = 'ì„ íƒí•˜ì„¸ìš”';
                medalSelect.appendChild(defaultMedalOption);

                medalOptions.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = JSON.stringify(option);
                    opt.textContent = option.label;
                    medalSelect.appendChild(opt);
                });

                medalSelect.onchange = function() {
                    recalculateMultiplePeriods(bonusId);
                };

                const medalHelp = document.createElement('div');
                medalHelp.className = 'help-text';
                medalHelp.innerHTML = '&nbsp;';
                medalHelp.style.cssText = 'font-size: 12px; color: #666; margin-top: 2px; min-height: 18px;';

                medalWrapper.appendChild(medalLabel);
                medalWrapper.appendChild(medalSelect);
                medalWrapper.appendChild(medalHelp);
                rowDiv.appendChild(medalWrapper);
            } else if (inputType === 'dateWithRank') {
                // ìˆœìœ„ ì„ íƒ ë“œë¡­ë‹¤ìš´ (ê·¼ë¬´13)
                const rankOptions = selectedOption.dataset.rankOptions ?
                    JSON.parse(selectedOption.dataset.rankOptions) : [];

                const rankWrapper = document.createElement('div');
                rankWrapper.style.cssText = 'flex: 0 0 200px; display: flex; flex-direction: column; gap: 4px;';

                const rankLabel = document.createElement('label');
                rankLabel.textContent = 'ìˆœìœ„ ì„ íƒ:';
                rankLabel.style.cssText = 'font-size: 13px; font-weight: 500; min-height: 18.5px;';

                const rankSelect = document.createElement('select');
                rankSelect.className = 'rank-select';
                rankSelect.dataset.bonusId = bonusId;
                rankSelect.dataset.rowId = rowId;
                rankSelect.style.cssText = 'width: 100%; padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;';

                const defaultRankOption = document.createElement('option');
                defaultRankOption.value = '';
                defaultRankOption.textContent = 'ì„ íƒí•˜ì„¸ìš”';
                rankSelect.appendChild(defaultRankOption);

                rankOptions.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = JSON.stringify(option);
                    opt.textContent = option.label;
                    rankSelect.appendChild(opt);
                });

                rankSelect.onchange = function() {
                    recalculateMultiplePeriods(bonusId);
                };

                const rankHelp = document.createElement('div');
                rankHelp.className = 'help-text';
                rankHelp.innerHTML = '&nbsp;';
                rankHelp.style.cssText = 'font-size: 12px; color: #666; margin-top: 2px; min-height: 18px;';

                rankWrapper.appendChild(rankLabel);
                rankWrapper.appendChild(rankSelect);
                rankWrapper.appendChild(rankHelp);
                rowDiv.appendChild(rankWrapper);
            } else if (inputType === 'periodWithGrade') {
                // ê¸‰ì§€ ì„ íƒ ë“œë¡­ë‹¤ìš´ (ê·¼ë¬´16)
                const gradeOptions = selectedOption.dataset.gradeOptions ?
                    JSON.parse(selectedOption.dataset.gradeOptions) : [];

                const gradeWrapper = document.createElement('div');
                gradeWrapper.style.cssText = 'flex: 0 0 350px; display: flex; flex-direction: column; gap: 4px;';

                const gradeLabel = document.createElement('label');
                gradeLabel.textContent = 'ê¸‰ì§€ ì„ íƒ:';
                gradeLabel.style.cssText = 'font-size: 13px; font-weight: 500; min-height: 18.5px;';

                const gradeSelect = document.createElement('select');
                gradeSelect.className = 'grade-select';
                gradeSelect.dataset.bonusId = bonusId;
                gradeSelect.dataset.rowId = rowId;
                gradeSelect.style.cssText = 'width: 100%; padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;';

                const defaultGradeOption = document.createElement('option');
                defaultGradeOption.value = '';
                defaultGradeOption.textContent = 'ì„ íƒí•˜ì„¸ìš”';
                gradeSelect.appendChild(defaultGradeOption);

                gradeOptions.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = JSON.stringify(option);
                    opt.textContent = option.label;
                    gradeSelect.appendChild(opt);
                });

                gradeSelect.onchange = function() {
                    recalculateMultiplePeriods(bonusId);
                };

                const gradeHelp = document.createElement('div');
                gradeHelp.className = 'help-text';
                gradeHelp.innerHTML = '&nbsp;';
                gradeHelp.style.cssText = 'font-size: 12px; color: #666; margin-top: 2px; min-height: 18px;';

                gradeWrapper.appendChild(gradeLabel);
                gradeWrapper.appendChild(gradeSelect);
                gradeWrapper.appendChild(gradeHelp);
                rowDiv.appendChild(gradeWrapper);
            } else if (inputType === 'periodWithClassSize') {
                // í•™ê¸‰ ê·œëª¨ ì„ íƒ + ê¸°ê°„ ì„ íƒ ë“œë¡­ë‹¤ìš´ (ê·¼ë¬´19)
                const classSizeOptions = selectedOption.dataset.classSizeOptions ?
                    JSON.parse(selectedOption.dataset.classSizeOptions) : [];

                // í•™ê¸‰ ê·œëª¨ ì„ íƒ ë“œë¡­ë‹¤ìš´
                const classSizeWrapper = document.createElement('div');
                classSizeWrapper.style.cssText = 'flex: 0 0 250px; display: flex; flex-direction: column; gap: 4px;';

                const classSizeLabel = document.createElement('label');
                classSizeLabel.textContent = 'í•™ê¸‰ ê·œëª¨:';
                classSizeLabel.style.cssText = 'font-size: 13px; font-weight: 500; min-height: 18.5px;';

                const classSizeSelect = document.createElement('select');
                classSizeSelect.className = 'classsize-select';
                classSizeSelect.dataset.bonusId = bonusId;
                classSizeSelect.dataset.rowId = rowId;
                classSizeSelect.style.cssText = 'width: 100%; padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;';

                const defaultClassSizeOption = document.createElement('option');
                defaultClassSizeOption.value = '';
                defaultClassSizeOption.textContent = 'ì„ íƒí•˜ì„¸ìš”';
                classSizeSelect.appendChild(defaultClassSizeOption);

                classSizeOptions.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = JSON.stringify(option);
                    opt.textContent = option.label;
                    classSizeSelect.appendChild(opt);
                });

                const classSizeHelp = document.createElement('div');
                classSizeHelp.className = 'help-text';
                classSizeHelp.innerHTML = '&nbsp;';
                classSizeHelp.style.cssText = 'font-size: 12px; color: #666; margin-top: 2px; min-height: 18px;';

                classSizeWrapper.appendChild(classSizeLabel);
                classSizeWrapper.appendChild(classSizeSelect);
                classSizeWrapper.appendChild(classSizeHelp);
                rowDiv.appendChild(classSizeWrapper);

                // ê¸°ê°„ ì„ íƒ ë“œë¡­ë‹¤ìš´
                const periodSelectWrapper = document.createElement('div');
                periodSelectWrapper.style.cssText = 'flex: 0 0 180px; display: flex; flex-direction: column; gap: 4px;';

                const periodSelectLabel = document.createElement('label');
                periodSelectLabel.textContent = 'ê¸°ê°„:';
                periodSelectLabel.style.cssText = 'font-size: 13px; font-weight: 500; min-height: 18.5px;';

                const periodSelectDropdown = document.createElement('select');
                periodSelectDropdown.className = 'period-select';
                periodSelectDropdown.dataset.bonusId = bonusId;
                periodSelectDropdown.dataset.rowId = rowId;
                periodSelectDropdown.style.cssText = 'width: 100%; padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;';
                periodSelectDropdown.disabled = true; // í•™ê¸‰ ê·œëª¨ ì„ íƒ ì „ê¹Œì§€ ë¹„í™œì„±í™”

                const defaultPeriodOption = document.createElement('option');
                defaultPeriodOption.value = '';
                defaultPeriodOption.textContent = 'ì„ íƒí•˜ì„¸ìš”';
                periodSelectDropdown.appendChild(defaultPeriodOption);

                periodSelectDropdown.onchange = function() {
                    recalculateMultiplePeriods(bonusId);
                };

                const periodSelectHelp = document.createElement('div');
                periodSelectHelp.className = 'help-text';
                periodSelectHelp.innerHTML = '&nbsp;';
                periodSelectHelp.style.cssText = 'font-size: 12px; color: #666; margin-top: 2px; min-height: 18px;';

                periodSelectWrapper.appendChild(periodSelectLabel);
                periodSelectWrapper.appendChild(periodSelectDropdown);
                periodSelectWrapper.appendChild(periodSelectHelp);
                rowDiv.appendChild(periodSelectWrapper);

                // í•™ê¸‰ ê·œëª¨ ì„ íƒ ì‹œ ê¸°ê°„ ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ë³€ê²½
                classSizeSelect.onchange = function() {
                    periodSelectDropdown.innerHTML = '';
                    const emptyOption = document.createElement('option');
                    emptyOption.value = '';
                    emptyOption.textContent = 'ì„ íƒí•˜ì„¸ìš”';
                    periodSelectDropdown.appendChild(emptyOption);

                    if (this.value) {
                        const selectedClassSize = JSON.parse(this.value);
                        const periodOptions = selectedClassSize.periodOptions || [];

                        periodOptions.forEach(option => {
                            const opt = document.createElement('option');
                            opt.value = JSON.stringify(option);
                            opt.textContent = option.label;
                            periodSelectDropdown.appendChild(opt);
                        });

                        periodSelectDropdown.disabled = false;
                    } else {
                        periodSelectDropdown.disabled = true;
                    }

                    recalculateMultiplePeriods(bonusId);
                };
            }

            // ê¸°ê°„/ë‚ ì§œ ì…ë ¥ í•„ë“œ
            const inputWrapper = document.createElement('div');
            inputWrapper.style.cssText = 'flex: 1; min-width: 250px; display: flex; flex-direction: column; gap: 4px;';

            const inputLabel = document.createElement('label');
            if (inputType === 'dateWithMedal' || inputType === 'dateWithRank' || inputType === 'dateMultiple') {
                inputLabel.textContent = 'ë‚ ì§œ:';
            } else {
                inputLabel.textContent = 'ê·¼ë¬´ ê¸°ê°„:';
            }
            inputLabel.style.cssText = 'font-size: 13px; font-weight: 500; min-height: 18.5px;';

            const periodInput = document.createElement('input');
            periodInput.type = 'text';
            periodInput.className = 'period-input';
            if (inputType === 'dateWithMedal' || inputType === 'dateWithRank' || inputType === 'dateMultiple') {
                periodInput.placeholder = '20210301';
            } else {
                periodInput.placeholder = '2021030120250228';
            }
            periodInput.style.cssText = 'padding: 6px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;';
            periodInput.oninput = function() {
                if (inputType === 'dateWithMedal' || inputType === 'dateWithRank' || inputType === 'dateMultiple') {
                    formatDate(this);
                    // ë‚ ì§œê°€ ì™„ì„±ë˜ë©´ (8ìë¦¬) ì ìˆ˜ ì¬ê³„ì‚°
                    const digits = this.value.replace(/[^0-9]/g, '');
                    if (digits.length === 8) {
                        recalculateMultiplePeriods(bonusId);
                    }
                } else {
                    formatPeriod(this);
                    // ê¸°ê°„ì´ ì™„ì„±ë˜ë©´ (16ìë¦¬) ì ìˆ˜ ì¬ê³„ì‚° (periodButton, periodButtonDual)
                    const digits = this.value.replace(/[^0-9]/g, '');
                    if (digits.length === 16) {
                        recalculateMultiplePeriods(bonusId);
                    }
                }
            };

            const periodHelp = document.createElement('div');
            periodHelp.className = 'help-text';
            if (inputType === 'dateWithMedal' || inputType === 'dateWithRank' || inputType === 'dateMultiple') {
                periodHelp.textContent = 'ì˜ˆ: 20210301 â†’ 2021.03.01 (ìë™ ë³€í™˜)';
            } else {
                periodHelp.textContent = 'ì˜ˆ: 2021030120250228 â†’ 2021.03.01~2025.02.28 (ìë™ ë³€í™˜)';
            }
            periodHelp.style.cssText = 'font-size: 12px; color: #666; margin-top: 2px; min-height: 18px;';

            inputWrapper.appendChild(inputLabel);
            inputWrapper.appendChild(periodInput);
            inputWrapper.appendChild(periodHelp);
            rowDiv.appendChild(inputWrapper);

            // ì‚­ì œ ë²„íŠ¼
            const deleteBtnWrapper = document.createElement('div');
            deleteBtnWrapper.style.cssText = 'flex: 0 0 auto; display: flex; flex-direction: column; gap: 4px;';

            // ë¹ˆ ë ˆì´ë¸” (ë†’ì´ ë§ì¶”ê¸°)
            const deleteLabel = document.createElement('label');
            deleteLabel.innerHTML = '&nbsp;';
            deleteLabel.style.cssText = 'font-size: 13px; min-height: 18.5px;';

            const deleteBtn = document.createElement('button');
            deleteBtn.type = 'button';
            deleteBtn.textContent = 'ì‚­ì œ';
            deleteBtn.className = 'btn btn-danger';
            deleteBtn.style.cssText = 'padding: 6px 12px;';
            deleteBtn.onclick = function() {
                rowDiv.remove();
                recalculateMultiplePeriods(bonusId);
            };

            // ë¹ˆ ë„ì›€ë§ (ë†’ì´ ë§ì¶”ê¸°)
            const deleteHelp = document.createElement('div');
            deleteHelp.className = 'help-text';
            deleteHelp.innerHTML = '&nbsp;';
            deleteHelp.style.cssText = 'font-size: 12px; color: #666; margin-top: 2px; min-height: 18px;';

            deleteBtnWrapper.appendChild(deleteLabel);
            deleteBtnWrapper.appendChild(deleteBtn);
            deleteBtnWrapper.appendChild(deleteHelp);
            rowDiv.appendChild(deleteBtnWrapper);

            periodsListContainer.appendChild(rowDiv);
        }

        // ì—¬ëŸ¬ ê¸°ê°„ì˜ ì ìˆ˜ ë° ì´ë¦„ ì¬ê³„ì‚°
        function recalculateMultiplePeriods(bonusId) {
            const itemSelect = document.getElementById(`bonus-item-${bonusId}`);
            const scoreInput = document.getElementById(`bonus-score-${bonusId}`);
            const periodsListContainer = document.getElementById(`bonus-periods-list-${bonusId}`);
            const selectedOption = itemSelect.options[itemSelect.selectedIndex];

            if (!selectedOption || !selectedOption.value) return;

            const originalName = selectedOption.dataset.originalName;
            const inputType = selectedOption.dataset.inputType;
            let totalScore = 0;
            let totalMonths = 0;

            // ëª¨ë“  ê¸°ê°„ í–‰ì„ ìˆœíšŒí•˜ë©° ì ìˆ˜ì™€ ê°œì›” ìˆ˜ í•©ì‚°
            const periodRows = periodsListContainer.querySelectorAll('.period-row');

            periodRows.forEach(row => {
                if (inputType === 'periodButton') {
                    const select = row.querySelector('.period-select');
                    const periodInput = row.querySelector('.period-input');
                    // ë“œë¡­ë°•ìŠ¤ ì„ íƒí•˜ê³  ë‚ ì§œë„ ì…ë ¥ë˜ì–´ì•¼ ì ìˆ˜ ê³„ì‚°
                    if (select && select.value && periodInput && periodInput.value.trim()) {
                        const option = JSON.parse(select.value);
                        totalScore += option.score;
                        totalMonths += option.months;
                    }
                } else if (inputType === 'periodButtonDual') {
                    const selectBefore = row.querySelector('.period-select-before');
                    const selectAfter = row.querySelector('.period-select-after');
                    const periodInput = row.querySelector('.period-input');

                    // ë“œë¡­ë°•ìŠ¤ ì„ íƒí•˜ê³  ê¸°ê°„ë„ ì…ë ¥ë˜ì–´ì•¼ ì ìˆ˜ ê³„ì‚°
                    if (periodInput && periodInput.value.trim()) {
                        if (selectBefore && selectBefore.value) {
                            const option = JSON.parse(selectBefore.value);
                            totalScore += option.score;
                            totalMonths += option.months;
                        }
                        if (selectAfter && selectAfter.value) {
                            const option = JSON.parse(selectAfter.value);
                            totalScore += option.score;
                            totalMonths += option.months;
                        }
                    }
                } else if (inputType === 'dateWithMedal') {
                    const medalSelect = row.querySelector('.medal-select');
                    const periodInput = row.querySelector('.period-input');
                    // ë©”ë‹¬ ì„ íƒí•˜ê³  ë‚ ì§œë„ ì…ë ¥ë˜ì–´ì•¼ ì ìˆ˜ ê³„ì‚°
                    if (medalSelect && medalSelect.value && periodInput && periodInput.value.trim()) {
                        const option = JSON.parse(medalSelect.value);
                        totalScore += option.score;
                    }
                } else if (inputType === 'dateWithRank') {
                    const rankSelect = row.querySelector('.rank-select');
                    const periodInput = row.querySelector('.period-input');
                    // ìˆœìœ„ ì„ íƒí•˜ê³  ë‚ ì§œë„ ì…ë ¥ë˜ì–´ì•¼ ì ìˆ˜ ê³„ì‚°
                    if (rankSelect && rankSelect.value && periodInput && periodInput.value.trim()) {
                        const option = JSON.parse(rankSelect.value);
                        totalScore += option.score;
                    }
                } else if (inputType === 'dateMultiple') {
                    // ë‚ ì§œë§Œ ìˆëŠ” ê²½ìš° (ê·¼ë¬´12) - ë‚ ì§œê°€ ì…ë ¥ë˜ë©´ ê¸°ë³¸ ì ìˆ˜ ì¶”ê°€
                    const periodInput = row.querySelector('.period-input');
                    if (periodInput && periodInput.value.trim()) {
                        const baseScore = parseFloat(selectedOption.dataset.score);
                        totalScore += baseScore;
                    }
                } else if (inputType === 'periodWithGrade') {
                    // ê¸‰ì§€ ì„ íƒ + ê¸°ê°„ ì…ë ¥ (ê·¼ë¬´16)
                    const gradeSelect = row.querySelector('.grade-select');
                    const periodInput = row.querySelector('.period-input');
                    // ê¸‰ì§€ ì„ íƒí•˜ê³  ê¸°ê°„ë„ ì…ë ¥ë˜ì–´ì•¼ ì ìˆ˜ ê³„ì‚°
                    if (gradeSelect && gradeSelect.value && periodInput && periodInput.value.trim()) {
                        const option = JSON.parse(gradeSelect.value);
                        totalScore += option.score;
                    }
                } else if (inputType === 'periodWithClassSize') {
                    // í•™ê¸‰ ê·œëª¨ ì„ íƒ + ê¸°ê°„ ì„ íƒ + ê¸°ê°„ ì…ë ¥ (ê·¼ë¬´19)
                    const classSizeSelect = row.querySelector('.classsize-select');
                    const periodSelect = row.querySelector('.period-select');
                    const periodInput = row.querySelector('.period-input');
                    // í•™ê¸‰ ê·œëª¨, ê¸°ê°„ ì„ íƒ, ê¸°ê°„ ì…ë ¥ ëª¨ë‘ ìˆì–´ì•¼ ì ìˆ˜ ê³„ì‚°
                    if (classSizeSelect && classSizeSelect.value &&
                        periodSelect && periodSelect.value &&
                        periodInput && periodInput.value.trim()) {
                        const option = JSON.parse(periodSelect.value);
                        totalScore += option.score;
                        totalMonths += option.months;
                    }
                }
            });

            // ì ìˆ˜ ë° ì´ë¦„ ì—…ë°ì´íŠ¸
            if (inputType === 'dateWithMedal' || inputType === 'dateWithRank' || inputType === 'dateMultiple' || inputType === 'periodWithGrade') {
                // ë‚ ì§œ íƒ€ì…ì€ ê°œì›” ìˆ˜ í‘œì‹œ ì—†ì´ ì ìˆ˜ë§Œ
                if (totalScore > 0) {
                    scoreInput.value = formatScore(totalScore);
                } else {
                    scoreInput.value = '';
                }
                selectedOption.textContent = originalName;
            } else if (totalMonths > 0) {
                scoreInput.value = formatScore(totalScore);
                // ê°œì›”ì„ ë…„/ê°œì›”ë¡œ ë³€í™˜
                const years = Math.floor(totalMonths / 12);
                const months = totalMonths % 12;
                let periodText = '';
                if (years > 0 && months > 0) {
                    periodText = `${years}ë…„ ${months}ê°œì›”`;
                } else if (years > 0) {
                    periodText = `${years}ë…„`;
                } else {
                    periodText = `${months}ê°œì›”`;
                }
                selectedOption.textContent = originalName + ' ' + periodText;
            } else {
                scoreInput.value = '';
                selectedOption.textContent = originalName;
            }

            // ì „ì²´ ì ìˆ˜ ì¬ê³„ì‚°
            calculateScore();
        }

        // ë‚ ì§œ ìë™ í¬ë§·íŒ… (yyyy.mm.dd)
        function formatDate(input) {
            // ì´ì „ í¬ë§·ëœ ë¬¸ìì—´ ì „ì²´ ì €ì¥
            const oldFormatted = input.dataset.prevValue || '';

            // í˜„ì¬ ì»¤ì„œ ìœ„ì¹˜ ì €ì¥
            const cursorPos = input.selectionStart;

            // í˜„ì¬ ì…ë ¥ê°’ ì €ì¥ (í¬ë§·íŒ… ì „)
            const currentRaw = input.value;

            // ìˆ«ìë§Œ ì¶”ì¶œ
            let value = input.value.replace(/[^0-9]/g, '');

            if (value.length === 0) {
                input.value = '';
                input.dataset.prevValue = '';
                return;
            }

            let formatted = '';
            if (value.length >= 8) {
                value = value.substring(0, 8);
                formatted = value.substring(0, 4) + '.' + value.substring(4, 6) + '.' + value.substring(6, 8);
            } else if (value.length >= 6) {
                formatted = value.substring(0, 4) + '.' + value.substring(4, 6) + '.' + value.substring(6);
            } else if (value.length >= 4) {
                formatted = value.substring(0, 4) + '.' + value.substring(4);
            } else {
                formatted = value;
            }

            input.value = formatted;
            input.dataset.prevValue = formatted;

            // ì»¤ì„œ ìœ„ì¹˜ ê³„ì‚° ë° ë³µì›
            let newPos;

            // ì›ë³¸ ë¬¸ìì—´ ê¸¸ì´ë¡œ ë°±ìŠ¤í˜ì´ìŠ¤ ê°ì§€ (í¬ë§·íŒ… ì „ ë¹„êµ)
            if (currentRaw.length < oldFormatted.length) {
                // ë°±ìŠ¤í˜ì´ìŠ¤: ì»¤ì„œ ìœ„ì¹˜ ìœ ì§€ (ë‹¨, ë²”ìœ„ ë‚´ë¡œ ì œí•œ)
                newPos = Math.min(cursorPos, formatted.length);
            } else {
                // ì…ë ¥: ì»¤ì„œë¥¼ ë§¨ ë’¤ë¡œ
                newPos = formatted.length;
            }

            input.setSelectionRange(newPos, newPos);
        }

        // ìƒë…„ì›”ì¼ ë³€ê²½ ì‹œ ìš°ìš°4 ìë™ ì—…ë°ì´íŠ¸
        function updateWoo4Birthdate() {
            const birthdate = document.getElementById('birthdate').value;
            // ìƒë…„ì›”ì¼ì´ ì™„ì„±ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¦¬í„´
            const digits = birthdate.replace(/[^0-9]/g, '');
            if (digits.length !== 8) return;

            // ëª¨ë“  ê°€ì‚°ì  í•­ëª© í™•ì¸
            const bonusItems = document.querySelectorAll('[id^="bonus-item-"]');
            bonusItems.forEach(itemSelect => {
                const selectedOption = itemSelect.options[itemSelect.selectedIndex];
                if (selectedOption && selectedOption.value === 'ìš°ìš°4') {
                    // ìš°ìš°4ê°€ ì„ íƒëœ ê²½ìš°
                    const id = itemSelect.id.replace('bonus-item-', '');
                    const periodInput = document.getElementById(`bonus-period-${id}`);
                    if (periodInput) {
                        periodInput.value = birthdate;
                        // ì ìˆ˜ ì¬ê³„ì‚°
                        calculateBonusScore(id);
                    }
                }
            });
        }

        // ê¸°ê°„ ìë™ í¬ë§·íŒ… (yyyy.mm.dd~yyyy.mm.dd)
        function formatPeriod(input) {
            // ì´ì „ í¬ë§·ëœ ë¬¸ìì—´ ì „ì²´ ì €ì¥
            const oldFormatted = input.dataset.prevValue || '';

            // í˜„ì¬ ì»¤ì„œ ìœ„ì¹˜ ì €ì¥
            const cursorPos = input.selectionStart;

            // í˜„ì¬ ì…ë ¥ê°’ ì €ì¥ (í¬ë§·íŒ… ì „)
            const currentRaw = input.value;

            // ìˆ«ìë§Œ ì¶”ì¶œ
            let value = input.value.replace(/[^0-9]/g, '');

            if (value.length === 0) {
                input.value = '';
                input.dataset.prevValue = '';
                return;
            }

            let formatted = '';
            const separator = input.dataset.separator || '~'; // ê¸°ë³¸ê°’ì€ ~

            if (value.length >= 16) {
                value = value.substring(0, 16);
                formatted = value.substring(0, 4) + '.' + value.substring(4, 6) + '.' + value.substring(6, 8) +
                             separator + value.substring(8, 12) + '.' + value.substring(12, 14) + '.' + value.substring(14, 16);
            } else if (value.length >= 8) {
                const part1 = value.substring(0, 4) + '.' + value.substring(4, 6) + '.' + value.substring(6, 8);
                const part2 = value.substring(8);
                if (part2.length >= 6) {
                    formatted = part1 + separator + part2.substring(0, 4) + '.' + part2.substring(4, 6) + '.' + part2.substring(6);
                } else if (part2.length >= 4) {
                    formatted = part1 + separator + part2.substring(0, 4) + '.' + part2.substring(4);
                } else if (part2.length > 0) {
                    formatted = part1 + separator + part2;
                } else {
                    formatted = part1;
                }
            } else if (value.length >= 6) {
                formatted = value.substring(0, 4) + '.' + value.substring(4, 6) + '.' + value.substring(6);
            } else if (value.length >= 4) {
                formatted = value.substring(0, 4) + '.' + value.substring(4);
            } else {
                formatted = value;
            }

            input.value = formatted;
            input.dataset.prevValue = formatted;

            // ì»¤ì„œ ìœ„ì¹˜ ê³„ì‚° ë° ë³µì›
            let newPos;

            // ì›ë³¸ ë¬¸ìì—´ ê¸¸ì´ë¡œ ë°±ìŠ¤í˜ì´ìŠ¤ ê°ì§€ (í¬ë§·íŒ… ì „ ë¹„êµ)
            if (currentRaw.length < oldFormatted.length) {
                // ë°±ìŠ¤í˜ì´ìŠ¤: ì»¤ì„œ ìœ„ì¹˜ ìœ ì§€ (ë‹¨, ë²”ìœ„ ë‚´ë¡œ ì œí•œ)
                newPos = Math.min(cursorPos, formatted.length);
            } else {
                // ì…ë ¥: ì»¤ì„œë¥¼ ë§¨ ë’¤ë¡œ
                newPos = formatted.length;
            }

            input.setSelectionRange(newPos, newPos);
        }

        // ê¸°ê°„ ê³„ì‚° (ê°œì›” ìˆ˜)
        function calculatePeriodMonths(periodStr) {
            if (!periodStr || !periodStr.includes('~')) return 0;

            const [start, end] = periodStr.split('~');
            const startDate = new Date(start.replace(/\./g, '-'));
            const endDate = new Date(end.replace(/\./g, '-'));

            if (isNaN(startDate) || isNaN(endDate) || endDate < startDate) return 0;

            const months = (endDate.getFullYear() - startDate.getFullYear()) * 12 +
                          (endDate.getMonth() - startDate.getMonth()) +
                          (endDate.getDate() >= startDate.getDate() ? 1 : 0);

            return Math.max(0, months);
        }

        function addBonus() {
            console.log('addBonus í•¨ìˆ˜ í˜¸ì¶œë¨', bonusCounter);
            try {
                bonusCounter++;
                const list = document.getElementById('bonusList');
                if (!list) {
                    alert('bonusList ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    console.error('bonusList ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                const item = document.createElement('div');
                item.className = 'item-box';
                item.id = `bonus-${bonusCounter}`;
                item.innerHTML = `
                <div class="item-header">
                    <span class="item-number">ê°€ì‚°ì  ${bonusCounter}</span>
                    <button class="btn btn-danger" onclick="removeItem('bonus-${bonusCounter}')">ì‚­ì œ</button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ì¢…ë³„ <span class="required">*</span></label>
                        <select id="bonus-type-${bonusCounter}" onchange="updateBonusItems(${bonusCounter})">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="í‘œì°½">í‘œì°½</option>
                            <option value="ê·¼ë¬´ì‹¤ì ">ê·¼ë¬´ì‹¤ì </option>
                            <option value="ì—°êµ¬ì‹¤ì ">ì—°êµ¬ì‹¤ì </option>
                            <option value="ìš°ìš°ì¡°ê±´">ìš°ìš°ì¡°ê±´</option>
                        </select>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>í‰ì • ëŒ€ìƒ <span class="required">*</span></label>
                        <select id="bonus-item-${bonusCounter}" onchange="updateBonusScore(${bonusCounter})" style="width: 100%;">
                            <option value="">ë¨¼ì € ì¢…ë³„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                        <div id="bonus-note-${bonusCounter}" class="help-text" style="margin-top: 8px; padding: 8px; background: #fff9e6; border-radius: 4px; display: none;"></div>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1; display: none;" id="bonus-periods-container-${bonusCounter}">
                        <label>ê·¼ë¬´ ê¸°ê°„ <span class="required">*</span></label>
                        <div id="bonus-periods-list-${bonusCounter}" style="display: flex; flex-direction: column; gap: 12px; margin-top: 8px;"></div>
                        <button type="button" class="btn btn-secondary" onclick="addPeriodRow(${bonusCounter})" style="margin-top: 8px; width: fit-content;">ê¸°ê°„ ì¶”ê°€</button>
                    </div>
                    <div class="form-group" id="bonus-period-group-${bonusCounter}">
                        <label id="bonus-period-label-${bonusCounter}">ê¸°ê°„/ì—°ì›”ì¼</label>
                        <input type="text" id="bonus-period-${bonusCounter}" placeholder="ë‚ ì§œ ì…ë ¥" oninput="handlePeriodInput(${bonusCounter})" onblur="calculateBonusScore(${bonusCounter})">
                        <div class="help-text" id="bonus-period-help-${bonusCounter}">í‰ì •ëŒ€ìƒì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</div>
                    </div>
                    <div class="form-group">
                        <label>ì ìˆ˜</label>
                        <input type="number" id="bonus-score-${bonusCounter}" step="0.001" placeholder="0.000" readonly style="background: #f0f0f0;">
                        <div class="help-text">ìë™ ê³„ì‚°ë¨</div>
                    </div>
                </div>
            `;
                list.appendChild(item);
                console.log('ê°€ì‚°ì  í•­ëª© ì¶”ê°€ ì™„ë£Œ:', bonusCounter);
            } catch (error) {
                console.error('addBonus ì˜¤ë¥˜:', error);
                alert('ê°€ì‚°ì  ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }
        }

        function updateBonusItems(id) {
            const typeSelect = document.getElementById(`bonus-type-${id}`);
            const itemSelect = document.getElementById(`bonus-item-${id}`);
            const scoreInput = document.getElementById(`bonus-score-${id}`);
            const noteDiv = document.getElementById(`bonus-note-${id}`);
            const periodGroup = document.getElementById(`bonus-period-group-${id}`);
            const periodInput = document.getElementById(`bonus-period-${id}`);

            const selectedType = typeSelect.value;

            // ì´ˆê¸°í™”
            itemSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            scoreInput.value = '';
            noteDiv.style.display = 'none';
            noteDiv.textContent = '';
            periodInput.value = '';
            periodGroup.style.display = 'flex'; // ì¼ë‹¨ í‘œì‹œ

            // ì´ì „ì— ìƒì„±ëœ ê¸‰ì§€ ì„ íƒ ì»¨í…Œì´ë„ˆ ì œê±° (gradeOnlyìš©)
            const oldGradeContainer = document.getElementById(`bonus-grade-container-${id}`);
            if (oldGradeContainer) {
                oldGradeContainer.remove();
            }

            if (selectedType && bonusTable[selectedType]) {
                bonusTable[selectedType].forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = item.name;
                    option.dataset.score = item.score;
                    option.dataset.note = item.note || '';
                    option.dataset.unit = item.unit || '';
                    option.dataset.inputType = item.inputType || 'period';
                    // periodOptionsê°€ ìˆìœ¼ë©´ ì €ì¥
                    if (item.periodOptions) {
                        option.dataset.periodOptions = JSON.stringify(item.periodOptions);
                    }
                    // periodOptionsBeforeì™€ periodOptionsAfterê°€ ìˆìœ¼ë©´ ì €ì¥ (ê·¼ë¬´3, 17, 18ìš©)
                    if (item.periodOptionsBefore) {
                        option.dataset.periodOptionsBefore = JSON.stringify(item.periodOptionsBefore);
                    }
                    if (item.periodOptionsAfter) {
                        option.dataset.periodOptionsAfter = JSON.stringify(item.periodOptionsAfter);
                    }
                    // cutoffDateê°€ ìˆìœ¼ë©´ ì €ì¥ (ê·¼ë¬´3, 17, 18ìš©)
                    if (item.cutoffDate) {
                        option.dataset.cutoffDate = item.cutoffDate;
                    }
                    // medalOptionsê°€ ìˆìœ¼ë©´ ì €ì¥ (ê·¼ë¬´11ìš©)
                    if (item.medalOptions) {
                        option.dataset.medalOptions = JSON.stringify(item.medalOptions);
                    }
                    // rankOptionsê°€ ìˆìœ¼ë©´ ì €ì¥ (ê·¼ë¬´13ìš©)
                    if (item.rankOptions) {
                        option.dataset.rankOptions = JSON.stringify(item.rankOptions);
                    }
                    // gradeOptionsê°€ ìˆìœ¼ë©´ ì €ì¥ (ê·¼ë¬´16ìš©)
                    if (item.gradeOptions) {
                        option.dataset.gradeOptions = JSON.stringify(item.gradeOptions);
                    }
                    // classSizeOptionsê°€ ìˆìœ¼ë©´ ì €ì¥ (ê·¼ë¬´19ìš©)
                    if (item.classSizeOptions) {
                        option.dataset.classSizeOptions = JSON.stringify(item.classSizeOptions);
                    }
                    // ì›ë˜ í•­ëª© ì´ë¦„ ì €ì¥ (ë²„íŠ¼ ì„ íƒ ì‹œ ì´ë¦„ì— ê¸°ê°„ ì¶”ê°€í•˜ê¸° ìœ„í•¨)
                    option.dataset.originalName = item.name;
                    itemSelect.appendChild(option);
                });
            }
        }

        function updateBonusScore(id) {
            const itemSelect = document.getElementById(`bonus-item-${id}`);
            const scoreInput = document.getElementById(`bonus-score-${id}`);
            const noteDiv = document.getElementById(`bonus-note-${id}`);
            const periodLabel = document.getElementById(`bonus-period-label-${id}`);
            const periodInput = document.getElementById(`bonus-period-${id}`);
            const periodHelp = document.getElementById(`bonus-period-help-${id}`);
            const periodGroup = document.getElementById(`bonus-period-group-${id}`);
            const periodsContainer = document.getElementById(`bonus-periods-container-${id}`);
            const periodsListContainer = document.getElementById(`bonus-periods-list-${id}`);

            const selectedOption = itemSelect.options[itemSelect.selectedIndex];

            scoreInput.value = '';

            // ì—¬ëŸ¬ ê¸°ê°„ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
            if (periodsContainer) {
                periodsContainer.style.display = 'none';
            }
            if (periodsListContainer) {
                periodsListContainer.innerHTML = '';
            }

            // ì´ì „ì— ìƒì„±ëœ ê¸‰ì§€ ì„ íƒ ì»¨í…Œì´ë„ˆ ì œê±° (gradeOnlyìš©)
            const oldGradeContainer = document.getElementById(`bonus-grade-container-${id}`);
            if (oldGradeContainer) {
                oldGradeContainer.remove();
            }

            if (selectedOption && selectedOption.value) {
                const itemId = selectedOption.value;

                // ìš°ìš°ì¡°ê±´ ì¤‘ë³µ ì²´í¬
                if (itemId.startsWith('ìš°ìš°')) {
                    const group1_3 = ['ìš°ìš°1', 'ìš°ìš°2', 'ìš°ìš°3'];
                    const group5_7 = ['ìš°ìš°5', 'ìš°ìš°6', 'ìš°ìš°7'];

                    let conflictGroup = null;
                    if (group1_3.includes(itemId)) {
                        conflictGroup = group1_3;
                    } else if (group5_7.includes(itemId)) {
                        conflictGroup = group5_7;
                    }

                    if (conflictGroup) {
                        // ë‹¤ë¥¸ ê°€ì‚°ì  í•­ëª©ë“¤ ì²´í¬
                        const allBonusItems = document.querySelectorAll('[id^="bonus-item-"]');
                        for (const otherItemSelect of allBonusItems) {
                            // í˜„ì¬ í•­ëª©ì€ ì œì™¸
                            if (otherItemSelect.id === `bonus-item-${id}`) continue;

                            const otherSelectedOption = otherItemSelect.options[otherItemSelect.selectedIndex];
                            if (otherSelectedOption && otherSelectedOption.value) {
                                const otherItemId = otherSelectedOption.value;

                                // ê°™ì€ ê·¸ë£¹ì—ì„œ ì´ë¯¸ ì„ íƒëœ í•­ëª©ì´ ìˆìœ¼ë©´ ê²½ê³ 
                                if (conflictGroup.includes(otherItemId) && otherItemId !== itemId) {
                                    alert(`ìš°ìš°ì¡°ê±´ì€ ì¤‘ë³µ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì´ë¯¸ "${otherSelectedOption.textContent}"ì´(ê°€) ì„ íƒë˜ì–´ ìˆìŠµë‹ˆë‹¤.`);
                                    itemSelect.selectedIndex = 0;
                                    scoreInput.value = '';
                                    periodGroup.style.display = 'none';
                                    calculateScore();
                                    return;
                                }
                            }
                        }
                    }
                }

                const score = selectedOption.dataset.score;
                const note = selectedOption.dataset.note;
                const unit = selectedOption.dataset.unit;
                const inputType = selectedOption.dataset.inputType;

                // ì…ë ¥ íƒ€ì…ì— ë”°ë¼ ë ˆì´ë¸” ë° placeholder ë³€ê²½
                if (inputType === 'date') {
                    periodGroup.style.display = 'flex';
                    periodLabel.textContent = 'ì—°ì›”ì¼ *';
                    periodInput.placeholder = '20230813 (ìˆ«ìë§Œ ì…ë ¥)';
                    periodHelp.textContent = 'ì˜ˆ: 20230813 â†’ 2023.08.13 (ìë™ ë³€í™˜)';

                    // ìš°ìš°4ì¸ ê²½ìš° ìƒë…„ì›”ì¼ ìë™ ì…ë ¥
                    if (itemId === 'ìš°ìš°4') {
                        const birthdate = document.getElementById('birthdate').value;
                        if (birthdate) {
                            periodInput.value = birthdate;
                            // ì ìˆ˜ ìë™ ê³„ì‚°
                            calculateBonusScore(id);
                        } else {
                            periodInput.value = '';
                            alert('ê¸°ë³¸ì •ë³´ì˜ ìƒë…„ì›”ì¼ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        }
                    } else {
                        periodInput.value = '';
                    }
                } else if (inputType === 'period') {
                    periodGroup.style.display = 'flex';
                    periodLabel.textContent = 'ê¸°ê°„ *';
                    periodInput.placeholder = '2021030120250228 (ìˆ«ìë§Œ ì…ë ¥)';
                    periodHelp.textContent = 'ì˜ˆ: 2021030120250228 â†’ 2021.03.01~2025.02.28 (ìë™ ë³€í™˜)';
                    periodInput.value = '';
                } else if (inputType === 'periodButton' || inputType === 'periodButtonDual') {
                    // ê·¼ë¬´ì‹¤ì  - ì—¬ëŸ¬ ê¸°ê°„ ì„ íƒ ê°€ëŠ¥
                    periodGroup.style.display = 'none'; // ê¸°ì¡´ ë‹¨ì¼ ì…ë ¥ í•„ë“œ ìˆ¨ê¹€

                    // ì—¬ëŸ¬ ê¸°ê°„ ì»¨í…Œì´ë„ˆ í‘œì‹œ
                    if (periodsContainer) {
                        periodsContainer.style.display = 'block';
                        // ì²« ë²ˆì§¸ ê¸°ê°„ í–‰ ìë™ ì¶”ê°€
                        addPeriodRow(id);
                    }
                } else if (inputType === 'dateWithMedal' || inputType === 'dateWithRank') {
                    // ê·¼ë¬´ì‹¤ì  11, 13 - ë‚ ì§œ + ë©”ë‹¬/ìˆœìœ„ ì„ íƒ (ì—¬ëŸ¬ ê°œ ì¶”ê°€ ê°€ëŠ¥)
                    periodGroup.style.display = 'none'; // ê¸°ì¡´ ë‹¨ì¼ ì…ë ¥ í•„ë“œ ìˆ¨ê¹€

                    // ì—¬ëŸ¬ ê¸°ê°„ ì»¨í…Œì´ë„ˆ í‘œì‹œ
                    if (periodsContainer) {
                        periodsContainer.style.display = 'block';
                        // ì²« ë²ˆì§¸ í–‰ ìë™ ì¶”ê°€
                        addPeriodRow(id);
                    }
                } else if (inputType === 'periodWithClassSize') {
                    // ê·¼ë¬´ì‹¤ì  19 - í•™ê¸‰ ê·œëª¨ ì„ íƒ + ê¸°ê°„ ì„ íƒ + ê¸°ê°„ ì…ë ¥ (ì—¬ëŸ¬ ê°œ ì¶”ê°€ ê°€ëŠ¥)
                    periodGroup.style.display = 'none'; // ê¸°ì¡´ ë‹¨ì¼ ì…ë ¥ í•„ë“œ ìˆ¨ê¹€

                    // ì—¬ëŸ¬ ê¸°ê°„ ì»¨í…Œì´ë„ˆ í‘œì‹œ
                    if (periodsContainer) {
                        periodsContainer.style.display = 'block';
                        // ì²« ë²ˆì§¸ í–‰ ìë™ ì¶”ê°€
                        addPeriodRow(id);
                    }
                } else if (inputType === 'dateMultiple') {
                    // ê·¼ë¬´ì‹¤ì  12 - ë‚ ì§œë§Œ ì…ë ¥ (ì—¬ëŸ¬ ê°œ ì¶”ê°€ ê°€ëŠ¥)
                    periodGroup.style.display = 'none'; // ê¸°ì¡´ ë‹¨ì¼ ì…ë ¥ í•„ë“œ ìˆ¨ê¹€

                    // ì—¬ëŸ¬ ê¸°ê°„ ì»¨í…Œì´ë„ˆ í‘œì‹œ
                    if (periodsContainer) {
                        periodsContainer.style.display = 'block';
                        // ì²« ë²ˆì§¸ í–‰ ìë™ ì¶”ê°€
                        addPeriodRow(id);
                    }
                } else if (inputType === 'gradeWithPeriod') {
                    // ê·¼ë¬´ì‹¤ì  16 - ê¸‰ì§€ ì„ íƒ + ë‹¨ì¼ ê¸°ê°„ ì…ë ¥
                    // ê¸‰ì§€ ì„ íƒ ë“œë¡­ë‹¤ìš´ ìƒì„±
                    const gradeOptions = selectedOption.dataset.gradeOptions ?
                        JSON.parse(selectedOption.dataset.gradeOptions) : [];

                    if (gradeOptions.length > 0) {
                        const gradeContainer = document.createElement('div');
                        gradeContainer.className = 'form-group';
                        gradeContainer.style.gridColumn = '1 / -1';
                        gradeContainer.id = `bonus-grade-container-${id}`;

                        const gradeLabel = document.createElement('label');
                        gradeLabel.innerHTML = 'ê¸‰ì§€ ì„ íƒ <span class="required">*</span>';

                        const gradeSelect = document.createElement('select');
                        gradeSelect.id = `bonus-grade-select-${id}`;
                        gradeSelect.style.width = '100%';

                        const emptyOption = document.createElement('option');
                        emptyOption.value = '';
                        emptyOption.textContent = 'ê¸‰ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”';
                        gradeSelect.appendChild(emptyOption);

                        gradeOptions.forEach(opt => {
                            const option = document.createElement('option');
                            option.value = JSON.stringify(opt);
                            option.textContent = `${opt.label} (${opt.score}ì )`;
                            gradeSelect.appendChild(option);
                        });

                        gradeSelect.onchange = function() {
                            calculateBonusScore(id);
                        };

                        gradeContainer.appendChild(gradeLabel);
                        gradeContainer.appendChild(gradeSelect);

                        // noteDiv ì•ì— ì‚½ì…
                        const parentGrid = periodGroup.parentElement;
                        const noteGroup = noteDiv.parentElement;
                        parentGrid.insertBefore(gradeContainer, noteGroup.nextSibling);
                    }

                    // ê¸°ê°„ ì…ë ¥ í•„ë“œ í‘œì‹œ
                    periodGroup.style.display = 'flex';
                    periodLabel.textContent = 'ê¸°ê°„ *';
                    periodInput.placeholder = '2021030120250228 (ìˆ«ìë§Œ ì…ë ¥)';
                    periodHelp.textContent = 'ì˜ˆ: 2021030120250228 â†’ 2021.03.01~2025.02.28 (ìë™ ë³€í™˜)';
                    periodInput.value = '';
                } else if (inputType === 'periodWithGrade') {
                    // ê·¼ë¬´ì‹¤ì  - ê¸‰ì§€ ì„ íƒ + ê¸°ê°„ ì…ë ¥ (ì—¬ëŸ¬ ê°œ ì¶”ê°€ ê°€ëŠ¥)
                    periodGroup.style.display = 'none'; // ê¸°ì¡´ ë‹¨ì¼ ì…ë ¥ í•„ë“œ ìˆ¨ê¹€

                    // ì—¬ëŸ¬ ê¸°ê°„ ì»¨í…Œì´ë„ˆ í‘œì‹œ
                    if (periodsContainer) {
                        periodsContainer.style.display = 'block';
                        // ì²« ë²ˆì§¸ í–‰ ìë™ ì¶”ê°€
                        addPeriodRow(id);
                    }
                } else if (inputType === 'none') {
                    // ìš°ìš°ì¡°ê±´ 5, 6, 7, 8ì€ ì…ë ¥ í•„ë“œ ìˆ¨ê¸°ê³  ë°”ë¡œ ì ìˆ˜ í‘œì‹œ
                    periodGroup.style.display = 'none';
                    scoreInput.value = formatScore(score);
                    calculateScore();
                }

                let noteText = '';
                if (unit) noteText += `[${unit}] `;
                if (note) noteText += note;

                if (noteText) {
                    noteDiv.innerHTML = 'ğŸ“Œ ' + noteText;
                    noteDiv.style.display = 'block';
                } else {
                    noteDiv.style.display = 'none';
                }
            }
        }

        function handlePeriodInput(id) {
            const itemSelect = document.getElementById(`bonus-item-${id}`);
            const periodInput = document.getElementById(`bonus-period-${id}`);
            const selectedOption = itemSelect.options[itemSelect.selectedIndex];

            if (!selectedOption || !selectedOption.value) return;

            const inputType = selectedOption.dataset.inputType;
            const itemId = selectedOption.value;

            // í¬ë§·íŒ… ì ìš©
            if (inputType === 'date') {
                formatDate(periodInput);
                // ë‚ ì§œ í˜•ì‹ì´ ì™„ì„±ë˜ë©´(8ìë¦¬) ì ìˆ˜ ê³„ì‚°
                const digits = periodInput.value.replace(/[^0-9]/g, '');
                if (digits.length === 8) {
                    calculateBonusScore(id);
                }
            } else if (inputType === 'period' || inputType === 'gradeWithPeriod') {
                formatPeriod(periodInput);
                // ê¸°ê°„ í˜•ì‹ì´ ì™„ì„±ë˜ë©´(16ìë¦¬) ì ìˆ˜ ê³„ì‚°
                const digits = periodInput.value.replace(/[^0-9]/g, '');
                if (digits.length === 16) {
                    calculateBonusScore(id);
                }
            }
        }

        function calculateBonusScore(id) {
            const itemSelect = document.getElementById(`bonus-item-${id}`);
            const periodInput = document.getElementById(`bonus-period-${id}`);
            const scoreInput = document.getElementById(`bonus-score-${id}`);
            const selectedOption = itemSelect.options[itemSelect.selectedIndex];

            if (!selectedOption || !selectedOption.value) return;

            const baseScore = parseFloat(selectedOption.dataset.score);
            const unit = selectedOption.dataset.unit;
            const inputType = selectedOption.dataset.inputType;
            const periodValue = periodInput.value.trim();

            // inputTypeì´ noneì´ë©´ ì´ë¯¸ ì ìˆ˜ê°€ ì„¤ì •ë¨
            if (inputType === 'none') return;

            // gradeWithPeriod: ê¸‰ì§€ ì„ íƒ + ê¸°ê°„ ì…ë ¥
            if (inputType === 'gradeWithPeriod') {
                const gradeSelect = document.getElementById(`bonus-grade-select-${id}`);
                if (!gradeSelect || !gradeSelect.value || !periodValue) {
                    scoreInput.value = '';
                    calculateScore();
                    return;
                }

                // ê¸°ê°„ í˜•ì‹ ê²€ì¦
                if (!/^\d{4}\.\d{2}\.\d{2}~\d{4}\.\d{2}\.\d{2}$/.test(periodValue)) {
                    scoreInput.value = '';
                    calculateScore();
                    return;
                }

                const selectedGrade = JSON.parse(gradeSelect.value);
                scoreInput.value = formatScore(selectedGrade.score);
                calculateScore();
                return;
            }

            // ê¸°ê°„/ì—°ì›”ì¼ì´ ì…ë ¥ë˜ì§€ ì•Šìœ¼ë©´ ì ìˆ˜ 0
            if (!periodValue) {
                scoreInput.value = '';
                calculateScore();
                return;
            }

            // date íƒ€ì…ì€ ê¸°ë³¸ ì ìˆ˜ ê·¸ëŒ€ë¡œ
            if (inputType === 'date') {
                // ë‚ ì§œ í˜•ì‹ ê²€ì¦ (yyyy.mm.dd)
                if (/^\d{4}\.\d{2}\.\d{2}$/.test(periodValue)) {
                    scoreInput.value = formatScore(baseScore);
                } else {
                    scoreInput.value = '';
                }
                calculateScore();
                return;
            }

            // period íƒ€ì…ì€ ê¸°ê°„ ê³„ì‚°
            if (inputType === 'period' && unit) {
                // ìš°ìš°2, ìš°ìš°3ëŠ” "yyyy.mm.dd~í˜„ì¬" í˜•ì‹ ê²€ì¦ í›„ ì ìˆ˜ í‘œì‹œ
                const itemId = itemSelect.value;
                if (itemId === 'ìš°ìš°2' || itemId === 'ìš°ìš°3') {
                    // ê¸°ê°„ í˜•ì‹ ê²€ì¦ (yyyy.mm.dd~í˜„ì¬)
                    if (!/^\d{4}\.\d{2}\.\d{2}~í˜„ì¬$/.test(periodValue)) {
                        scoreInput.value = '';
                        calculateScore();
                        return;
                    }
                    scoreInput.value = formatScore(baseScore);
                    calculateScore();
                    return;
                }

                // ê¸°ê°„ í˜•ì‹ ê²€ì¦ (yyyy.mm.dd~yyyy.mm.dd)
                if (!/^\d{4}\.\d{2}\.\d{2}~\d{4}\.\d{2}\.\d{2}$/.test(periodValue)) {
                    scoreInput.value = '';
                    calculateScore();
                    return;
                }

                const months = calculatePeriodMonths(periodValue);
                let finalScore = 0;

                if (unit.includes('6ê°œì›”ë§ˆë‹¤')) {
                    const periods = Math.floor(months / 6);
                    finalScore = baseScore * periods;

                    // "2ë…„ê°„" ì œí•œ í™•ì¸
                    const itemName = selectedOption.textContent;
                    if (itemName.includes('2ë…„ê°„')) {
                        const maxPeriods = 4; // 2ë…„ = 24ê°œì›” = 4 Ã— 6ê°œì›”
                        finalScore = Math.min(finalScore, baseScore * maxPeriods);
                    }
                } else if (unit.includes('1ê°œì›”ë§ˆë‹¤')) {
                    finalScore = baseScore * months;

                    // "2ë…„ê°„" ì œí•œ
                    const itemName = selectedOption.textContent;
                    if (itemName.includes('2ë…„ê°„')) {
                        const maxMonths = 24;
                        finalScore = Math.min(finalScore, baseScore * maxMonths);
                    }
                } else if (unit.includes('1ë…„ë§ˆë‹¤')) {
                    const years = Math.floor(months / 12);
                    finalScore = baseScore * years;

                    // "2ë…„ê°„" ì œí•œ
                    const itemName = selectedOption.textContent;
                    if (itemName.includes('2ë…„ê°„')) {
                        finalScore = Math.min(finalScore, baseScore * 2);
                    }
                } else {
                    // ë‹¨ìœ„ê°€ ëª…ì‹œë˜ì§€ ì•Šì€ ê²½ìš° ê¸°ë³¸ ì ìˆ˜
                    finalScore = baseScore;
                }

                scoreInput.value = formatScore(finalScore);
            } else {
                // ë‹¨ìœ„ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ì ìˆ˜
                scoreInput.value = formatScore(baseScore);
            }

            calculateScore();
        }

        function removeItem(id) {
            document.getElementById(id).remove();
            calculateScore();
        }

        function calculateScore() {
            let careerTotal = 0;
            let bonusTotal = 0;
            let practiceTotal = 0;

            // ê²½ë ¥ì  ê³„ì‚° (ì¡°ì •ëœ ê·¼ë¬´ì—°ìˆ˜ ê¸°ë°˜)
            const adjustedServiceYears = calculateAdjustedServiceYears();
            savedCareers.forEach((career, index) => {
                const startDate = career.adjustedStartDate || career.startDate;
                const grade = findGrade(career.school, startDate);
                const scoreTable = determineScoreTable(startDate);
                const serviceYear = adjustedServiceYears[index];
                if (serviceYear) {
                    const score = calculateScoreForCareer(grade, serviceYear.years, serviceYear.months, scoreTable);
                    careerTotal += score;
                }
            });

            // ê°€ì‚°ì  ê³„ì‚°
            document.querySelectorAll('[id^="bonus-score-"]').forEach(input => {
                const score = parseFloat(input.value) || 0;
                bonusTotal += score;
            });

            // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ ê°€ì‚°ì 
            ['practiceClassScore', 'practiceResearchScore', 'practiceFutureScore', 'practiceImprovementScore'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    practiceTotal += parseFloat(input.value) || 0;
                }
            });

            const total = careerTotal + bonusTotal;
            const practiceAdjusted = careerTotal + practiceTotal;

            document.getElementById('careerScore').textContent = careerTotal.toFixed(3) + 'ì ';
            document.getElementById('bonusScore').textContent = bonusTotal.toFixed(3) + 'ì ';
            document.getElementById('practiceScore').textContent = practiceTotal.toFixed(3) + 'ì ';
            document.getElementById('totalScore').textContent = total.toFixed(3) + 'ì ';
            document.getElementById('practiceAdjustedScore').textContent = practiceAdjusted.toFixed(3) + 'ì ';
        }

        // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ - ìˆ˜ì—… ì‹¤ì  ì¶”ê°€
        function addPracticeClass() {
            if (practiceClassCounter >= 3) {
                alert('ìˆ˜ì—… ì‹¤ì ì€ ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            const id = ++practiceClassCounter;
            const container = document.getElementById('practiceClassList');

            const div = document.createElement('div');
            div.id = `practiceClass-${id}`;
            div.style.cssText = 'border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 4px; background: #f9f9f9;';
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <strong>ìˆ˜ì—… ì‹¤ì  ${id}</strong>
                    <button class="btn btn-remove" onclick="removePracticeClass(${id})" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">ì‚­ì œ</button>
                </div>
                <input type="text" id="practiceClassContent-${id}" placeholder="ë‚´ìš© ì…ë ¥" style="width: 100%; margin-bottom: 10px; padding: 8px; box-sizing: border-box;">
                <input type="text" id="practiceClassDate-${id}" placeholder="ë‚ ì§œ (ì˜ˆ: 20130509)" oninput="formatDate(this); calculatePracticeScore();" style="width: 100%; padding: 8px; box-sizing: border-box;">
            `;

            container.appendChild(div);

            // 3ê°œê°€ ë˜ë©´ ì¶”ê°€ ë²„íŠ¼ ë¹„í™œì„±í™”
            if (practiceClassCounter >= 3) {
                document.getElementById('addPracticeClassBtn').disabled = true;
                document.getElementById('addPracticeClassBtn').style.opacity = '0.5';
                document.getElementById('addPracticeClassBtn').style.cursor = 'not-allowed';
            }

            calculatePracticeScore();
        }

        // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ - ìˆ˜ì—… ì‹¤ì  ì œê±°
        function removePracticeClass(id) {
            const element = document.getElementById(`practiceClass-${id}`);
            if (element) {
                element.remove();
                practiceClassCounter--;

                // 3ê°œ ë¯¸ë§Œì´ë©´ ì¶”ê°€ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                if (practiceClassCounter < 3) {
                    document.getElementById('addPracticeClassBtn').disabled = false;
                    document.getElementById('addPracticeClassBtn').style.opacity = '1';
                    document.getElementById('addPracticeClassBtn').style.cursor = 'pointer';
                }

                calculatePracticeScore();
            }
        }

        // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ ê°€ì‚°ì  ì ìˆ˜ ê³„ì‚°
        function calculatePracticeScore() {
            // 1~3. ìˆ˜ì—… ì‹¤ì  ì ìˆ˜ ê³„ì‚°
            let classCount = 0;
            for (let i = 1; i <= 3; i++) {
                const contentInput = document.getElementById(`practiceClassContent-${i}`);
                const dateInput = document.getElementById(`practiceClassDate-${i}`);
                if (contentInput && dateInput) {
                    const content = contentInput.value.trim();
                    const date = dateInput.value.trim();
                    const digits = date.replace(/[^0-9]/g, '');
                    if (content && digits.length === 8) {
                        classCount++;
                    }
                }
            }
            const classScore = classCount * 2.0;
            document.getElementById('practiceClassScore').value = classScore.toFixed(3);

            // 4. ì—°êµ¬ ì‹¤ì  ì ìˆ˜ ê³„ì‚°
            const researchContent = document.getElementById('practiceResearchContent').value.trim();
            const researchDate = document.getElementById('practiceResearchDate').value.trim();
            const researchDigits = researchDate.replace(/[^0-9]/g, '');
            const researchScore = (researchContent && researchDigits.length === 8) ? 2.0 : 0;
            document.getElementById('practiceResearchScore').value = researchScore.toFixed(3);

            // 5. ë¯¸ë˜êµìœ¡ ì‹¤ì  ì ìˆ˜ ê³„ì‚°
            const futureContent = document.getElementById('practiceFutureContent').value.trim();
            const futurePeriod = document.getElementById('practiceFuturePeriod').value.trim();
            const futureDigits = futurePeriod.replace(/[^0-9]/g, '');
            const futureScore = (futureContent && futureDigits.length === 16) ? 2.0 : 0;
            document.getElementById('practiceFutureScore').value = futureScore.toFixed(3);

            // 6. êµìœ¡ë ¥ ì œê³  ì‹¤ì  ì ìˆ˜ ê³„ì‚°
            const improvementContent = document.getElementById('practiceImprovementContent').value.trim();
            const improvementPeriod = document.getElementById('practiceImprovementPeriod').value.trim();
            const improvementDigits = improvementPeriod.replace(/[^0-9]/g, '');
            const improvementScore = (improvementContent && improvementDigits.length === 16) ? 2.0 : 0;
            document.getElementById('practiceImprovementScore').value = improvementScore.toFixed(3);

            // ì „ì²´ ì ìˆ˜ ì¬ê³„ì‚° (calculateScore í•¨ìˆ˜ í˜¸ì¶œ - ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í•¨ìˆ˜)
            // calculateScore(); ëŒ€ì‹  ì§ì ‘ ì—…ë°ì´íŠ¸
            updateTotalScore();
        }

        // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ - ìˆ˜ì—… ì‹¤ì  ë°ì´í„° ìˆ˜ì§‘
        function getPracticeClassData() {
            const items = [];
            for (let i = 1; i <= 3; i++) {
                const contentInput = document.getElementById(`practiceClassContent-${i}`);
                const dateInput = document.getElementById(`practiceClassDate-${i}`);
                if (contentInput && dateInput) {
                    const content = contentInput.value.trim();
                    const date = dateInput.value.trim();
                    const digits = date.replace(/[^0-9]/g, '');
                    if (content && digits.length === 8) {
                        items.push({ content, date });
                    }
                }
            }

            // ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ìµœì‹ ì´ ìœ„ë¡œ)
            items.sort((a, b) => {
                const dateA = a.date.replace(/\./g, '');
                const dateB = b.date.replace(/\./g, '');
                return dateB.localeCompare(dateA);
            });

            // ë‚´ìš©ê³¼ ë‚ ì§œë¥¼ ì¤„ë°”ê¿ˆìœ¼ë¡œ í•©ì¹˜ê¸°
            const contents = items.map(item => item.content).join('\n');
            const dates = items.map(item => item.date).join('\n');

            return { contents, dates };
        }

        // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ - ì—°êµ¬ ì‹¤ì  ë°ì´í„° ìˆ˜ì§‘
        function getPracticeResearchData() {
            const content = document.getElementById('practiceResearchContent').value.trim();
            const date = document.getElementById('practiceResearchDate').value.trim();
            const digits = date.replace(/[^0-9]/g, '');

            if (content && digits.length === 8) {
                return { content, date };
            }
            return { content: '', date: '' };
        }

        // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ - ë¯¸ë˜êµìœ¡ ì‹¤ì  ë°ì´í„° ìˆ˜ì§‘
        function getPracticeFutureData() {
            const content = document.getElementById('practiceFutureContent').value.trim();
            const period = document.getElementById('practiceFuturePeriod').value.trim();
            const digits = period.replace(/[^0-9]/g, '');

            if (content && digits.length === 16) {
                return { content, period };
            }
            return { content: '', period: '' };
        }

        // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ - êµìœ¡ë ¥ ì œê³  ì‹¤ì  ë°ì´í„° ìˆ˜ì§‘
        function getPracticeImprovementData() {
            const content = document.getElementById('practiceImprovementContent').value.trim();
            const period = document.getElementById('practiceImprovementPeriod').value.trim();
            const digits = period.replace(/[^0-9]/g, '');

            if (content && digits.length === 16) {
                return { content, period };
            }
            return { content: '', period: '' };
        }

        // ì „ì²´ ì ìˆ˜ ì—…ë°ì´íŠ¸
        function updateTotalScore() {
            let careerTotal = 0;
            let bonusTotal = 0;
            let practiceTotal = 0;

            // ê²½ë ¥ ì ìˆ˜
            document.querySelectorAll('[id^="career-score-"]').forEach(input => {
                careerTotal += parseFloat(input.textContent) || 0;
            });

            // ê°€ì‚°ì 
            document.querySelectorAll('[id^="bonus-score-"]').forEach(input => {
                const score = parseFloat(input.value) || 0;
                bonusTotal += score;
            });

            // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ ê°€ì‚°ì 
            ['practiceClassScore', 'practiceResearchScore', 'practiceFutureScore', 'practiceImprovementScore'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    practiceTotal += parseFloat(input.value) || 0;
                }
            });

            const total = careerTotal + bonusTotal;
            const practiceAdjusted = careerTotal + practiceTotal;

            document.getElementById('careerScore').textContent = careerTotal.toFixed(3) + 'ì ';
            document.getElementById('bonusScore').textContent = bonusTotal.toFixed(3) + 'ì ';
            document.getElementById('practiceScore').textContent = practiceTotal.toFixed(3) + 'ì ';
            document.getElementById('totalScore').textContent = total.toFixed(3) + 'ì ';
            document.getElementById('practiceAdjustedScore').textContent = practiceAdjusted.toFixed(3) + 'ì ';
        }

        function validateRequired() {
            const required = {
                'name': 'ì„±ëª…', 'gender': 'ì„±ë³„', 'birthdate': 'ìƒë…„ì›”ì¼',
                'currentSchool': 'í˜„ì„êµ', 'currentSchoolYears': 'í˜„ì„êµê·¼ë¬´ì—°ìˆ˜',
                'residence': 'ìƒí™œê·¼ê±°ì§€', 'qualification': 'ì†Œì§€ìê²©',
                'promotionCandidate': 'ìŠ¹ì§„í›„ë³´ì', 'transferType': 'ì „ë³´êµ¬ë¶„',
                'firstChoice': '1í¬ë§'
            };

            for (const [id, label] of Object.entries(required)) {
                const value = document.getElementById(id).value;
                if (!value) {
                    alert(`âš ï¸ ${label}ì€(ëŠ”) í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤!`);
                    document.getElementById(id).focus();
                    return false;
                }
            }
            return true;
        }

        function collectData() {
            // savedCareers ë°°ì—´ì—ì„œ ê²½ë ¥ ë°ì´í„° ìˆ˜ì§‘
            const adjustedServiceYears = calculateAdjustedServiceYears();
            const careers = savedCareers.map((career, index) => {
                const startDate = career.adjustedStartDate || career.startDate;
                const grade = findGrade(career.school, startDate);
                const scoreTable = determineScoreTable(startDate);
                const monthlyScore = scoreTable[grade] ? scoreTable[grade][11] : 0;
                const serviceYear = adjustedServiceYears[index];
                const serviceYearDisplay = `${serviceYear.years}.${String(serviceYear.months).padStart(2, '0')}`;
                const score = calculateScoreForCareer(grade, serviceYear.years, serviceYear.months, scoreTable);

                // ê·¼ë¬´ê¸°ê°„: ì¡°ì •ëœ ê²½ìš° ì¡°ì •ëœ ê¸°ê°„ë§Œ í‘œì‹œ
                let periodDisplay;
                if (career.isAdjusted && career.adjustedPeriod) {
                    periodDisplay = career.adjustedPeriod;
                } else {
                    periodDisplay = career.originalPeriod || career.period;
                }

                return {
                    school: career.school,
                    period: periodDisplay,
                    grade: `${grade}(${monthlyScore.toFixed(1)})`,
                    years: serviceYearDisplay,
                    score: score.toFixed(3)
                };
            });

            const bonuses = [];
            document.querySelectorAll('[id^="bonus-"][id*="-type-"]').forEach(input => {
                const id = input.id.split('-')[2];
                const itemSelect = document.getElementById(`bonus-item-${id}`);
                const selectedOption = itemSelect.options[itemSelect.selectedIndex];

                // ì—¬ëŸ¬ ê¸°ê°„ì„ ìˆ˜ì§‘ (ê·¼ë¬´ì‹¤ì  1~10ë²ˆì˜ ê²½ìš°)
                let periodValue = '';
                const periodsListContainer = document.getElementById(`bonus-periods-list-${id}`);
                if (periodsListContainer && periodsListContainer.children.length > 0) {
                    // ì—¬ëŸ¬ ê¸°ê°„ì´ ìˆëŠ” ê²½ìš°
                    const periodInputs = periodsListContainer.querySelectorAll('.period-input');
                    const periods = [];
                    periodInputs.forEach(input => {
                        if (input.value.trim()) {
                            periods.push(input.value.trim());
                        }
                    });

                    // ë‚ ì§œ ìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹  ë‚ ì§œê°€ ìœ„ë¡œ)
                    periods.sort((a, b) => {
                        // ê¸°ê°„ í˜•ì‹: yyyy.mm.dd~yyyy.mm.dd ë˜ëŠ” ë‚ ì§œ í˜•ì‹: yyyy.mm.dd
                        // ì¢…ë£Œ ë‚ ì§œ(ë˜ëŠ” ë‹¨ì¼ ë‚ ì§œ)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
                        const getEndDate = (period) => {
                            // ê¸°ê°„ í˜•ì‹ (yyyy.mm.dd~yyyy.mm.dd)
                            let match = period.match(/~(\d{4})\.(\d{2})\.(\d{2})/);
                            if (match) {
                                return new Date(match[1], parseInt(match[2]) - 1, match[3]);
                            }
                            // ë‚ ì§œ í˜•ì‹ (yyyy.mm.dd)
                            match = period.match(/^(\d{4})\.(\d{2})\.(\d{2})$/);
                            if (match) {
                                return new Date(match[1], parseInt(match[2]) - 1, match[3]);
                            }
                            return new Date(0); // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê°€ì¥ ì˜¤ë˜ëœ ë‚ ì§œ
                        };

                        const dateA = getEndDate(a);
                        const dateB = getEndDate(b);
                        return dateB - dateA; // ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ì´ ìœ„)
                    });

                    periodValue = periods.join('\n'); // ì¤„ë°”ê¿ˆìœ¼ë¡œ ì—°ê²°
                } else {
                    // ë‹¨ì¼ ê¸°ê°„ì¸ ê²½ìš°
                    const periodInput = document.getElementById(`bonus-period-${id}`);
                    periodValue = periodInput ? periodInput.value : '';
                }

                bonuses.push({
                    type: document.getElementById(`bonus-type-${id}`).value,
                    itemId: itemSelect.value,
                    itemName: selectedOption ? selectedOption.textContent : '',
                    period: periodValue,
                    score: document.getElementById(`bonus-score-${id}`).value,
                    note: selectedOption ? selectedOption.dataset.note : '',
                    unit: selectedOption ? selectedOption.dataset.unit : ''
                });
            });

            // ê°€ì‚°ì  ì •ë ¬: ì¢…ë³„ ìˆœì„œ(í‘œì°½, ê·¼ë¬´ì‹¤ì , ì—°êµ¬ì‹¤ì , ìš°ìš°ì¡°ê±´) + ê° ì¢…ë³„ ë‚´ ìˆ«ì ìˆœì„œ
            bonuses.sort((a, b) => {
                // ì¢…ë³„ ìš°ì„ ìˆœìœ„
                const typeOrder = { 'í‘œì°½': 1, 'ê·¼ë¬´ì‹¤ì ': 2, 'ì—°êµ¬ì‹¤ì ': 3, 'ìš°ìš°ì¡°ê±´': 4 };
                const typeA = typeOrder[a.type] || 999;
                const typeB = typeOrder[b.type] || 999;

                if (typeA !== typeB) {
                    return typeA - typeB; // ì¢…ë³„ ìˆœì„œë¡œ ì •ë ¬
                }

                // ê°™ì€ ì¢…ë³„ ë‚´ì—ì„œëŠ” itemIdì˜ ìˆ«ìë¡œ ì •ë ¬
                // itemId í˜•ì‹: "í‘œì°½1", "ê·¼ë¬´2", "ì—°êµ¬3", "ìš°ìš°1" ë“±
                const getNumber = (itemId) => {
                    const match = itemId.match(/\d+/);
                    return match ? parseInt(match[0]) : 999;
                };

                return getNumber(a.itemId) - getNumber(b.itemId);
            });

            return {
                name: document.getElementById('name').value,
                gender: document.getElementById('gender').value,
                birthdate: document.getElementById('birthdate').value,
                currentSchool: document.getElementById('currentSchool').value,
                currentSchoolYears: document.getElementById('currentSchoolYears').value,
                residence: document.getElementById('residence').value,
                qualification: document.getElementById('qualification').value,
                otherCity: document.getElementById('otherCity').value,
                otherProvince: document.getElementById('otherProvince').value,
                promotionCandidate: document.getElementById('promotionCandidate').value,
                remarks: document.getElementById('remarks').value,
                transferType: document.getElementById('transferType').value,
                firstChoice: document.getElementById('firstChoice').value,
                secondChoice: document.getElementById('secondChoice').value,
                thirdChoice: document.getElementById('thirdChoice').value,
                integrated1: document.getElementById('integrated1').value,
                integrated2: document.getElementById('integrated2').value,
                integrated3: document.getElementById('integrated3').value,
                careers: careers,
                bonuses: bonuses,
                // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ ê°€ì‚°ì  - 1~3. ìˆ˜ì—… ì‹¤ì 
                practiceClass: getPracticeClassData(),
                practiceClassScore: document.getElementById('practiceClassScore').value,
                // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ ê°€ì‚°ì  - 4. ì—°êµ¬ ì‹¤ì 
                practiceResearch: getPracticeResearchData(),
                practiceResearchScore: document.getElementById('practiceResearchScore').value,
                // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ ê°€ì‚°ì  - 5. ë¯¸ë˜êµìœ¡ ì‹¤ì 
                practiceFuture: getPracticeFutureData(),
                practiceFutureScore: document.getElementById('practiceFutureScore').value,
                // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ ê°€ì‚°ì  - 6. êµìœ¡ë ¥ ì œê³  ì‹¤ì 
                practiceImprovement: getPracticeImprovementData(),
                practiceImprovementScore: document.getElementById('practiceImprovementScore').value,
                overStaffHope: document.getElementById('overStaffHope').value,
                transferPriorityReason: document.getElementById('transferPriorityReason').value,
                transferDeferReason: document.getElementById('transferDeferReason').value,
                spouseName: document.getElementById('spouseName').value,
                spouseSchool: document.getElementById('spouseSchool').value,
                relative1Name: document.getElementById('relative1Name').value,
                relative1School: document.getElementById('relative1School').value,
                relative2Name: document.getElementById('relative2Name').value,
                relative2School: document.getElementById('relative2School').value,
                careerScore: document.getElementById('careerScore').textContent,
                bonusScore: document.getElementById('bonusScore').textContent,
                practiceScore: document.getElementById('practiceScore').textContent,
                totalScore: document.getElementById('totalScore').textContent,
                practiceAdjustedScore: document.getElementById('practiceAdjustedScore').textContent
            };
        }

        function saveData() {
            const data = collectData();
            localStorage.setItem('transferApplication', JSON.stringify(data));
            alert('âœ… ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('transferApplication');
            if (saved) {
                // TODO: ë°ì´í„° ë¡œë“œ ë¡œì§
            }
        }

        function loadData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = JSON.parse(event.target.result);
                    // TODO: ë°ì´í„° ë¡œë“œ ë¡œì§
                    alert('âœ… ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function downloadJSON() {
            if (!validateRequired()) return;
            const data = collectData();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ì „ë³´ì‹ ì²­ì„œ_${data.name}_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert('âœ… JSON íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        async function downloadExcel() {
            if (!validateRequired()) return;
            const data = collectData();

            try {
                // ì›ë³¸ í…œí”Œë¦¿ íŒŒì¼ ë¡œë“œ
                const templatePath = 'template.xlsx';
                const response = await fetch(templatePath);

                if (!response.ok) {
                    throw new Error('í…œí”Œë¦¿ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }

                const arrayBuffer = await response.arrayBuffer();

                // ExcelJSë¡œ workbook ë¡œë“œ
                const workbook = new ExcelJS.Workbook();
                await workbook.xlsx.load(arrayBuffer);

                const worksheet = workbook.getWorksheet(1); // ì²« ë²ˆì§¸ ì‹œíŠ¸

                // í—¬í¼ í•¨ìˆ˜: ìŠ¤íƒ€ì¼ì„ ìœ ì§€í•˜ë©´ì„œ ê°’ë§Œ ì„¤ì •
                function setCellValue(cellAddress, value) {
                    const cell = worksheet.getCell(cellAddress);
                    const originalStyle = Object.assign({}, cell.style);
                    cell.value = value;
                    cell.style = originalStyle;
                }

                // ê¸°ë³¸ ì •ë³´ ì…ë ¥
                setCellValue('D5', data.transferType);
                setCellValue('H5', data.firstChoice);
                setCellValue('M5', data.secondChoice);
                setCellValue('Q5', data.thirdChoice);
                setCellValue('D6', data.integrated1);
                setCellValue('H6', data.integrated2);
                setCellValue('M6', data.integrated3);
                setCellValue('D7', data.currentSchool);
                setCellValue('H7', data.name);
                setCellValue('M7', data.gender);
                setCellValue('Q7', data.residence);
                setCellValue('D8', data.qualification);
                setCellValue('H8', data.otherCity);
                setCellValue('M8', data.otherProvince);
                setCellValue('Q8', data.promotionCandidate);
                setCellValue('H10', data.currentSchoolYears);
                setCellValue('N10', data.birthdate);
                setCellValue('P10', data.remarks);

                // ê²½ë ¥ ì‚¬í•­ ì…ë ¥ (Row 12ë¶€í„° ì‹œì‘)
                data.careers.forEach((career, index) => {
                    const row = 12 + index;
                    setCellValue(`E${row}`, career.school);
                    setCellValue(`H${row}`, career.period);
                    setCellValue(`M${row}`, career.grade);
                    setCellValue(`O${row}`, career.years);
                    setCellValue(`P${row}`, parseFloat(career.score));
                });

                // ê°€ì‚°ì  ì…ë ¥ (Row 18ë¶€í„° ì‹œì‘)
                data.bonuses.forEach((bonus, index) => {
                    const row = 18 + index;
                    setCellValue(`C${row}`, bonus.type);
                    setCellValue(`E${row}`, bonus.itemName);
                    setCellValue(`K${row}`, bonus.period);
                    setCellValue(`O${row}`, parseFloat(bonus.score));
                });

                // êµìœ¡ì‹¤ìŠµí˜‘ë ¥í•™êµ ê°€ì‚°ì  ì…ë ¥ (Row 33-36)
                // 1~3. ìˆ˜ì—… ì‹¤ì  (Row 33)
                if (data.practiceClass && (data.practiceClass.contents || data.practiceClass.dates)) {
                    setCellValue('E33', data.practiceClass.contents);
                    setCellValue('K33', data.practiceClass.dates);
                }
                if (data.practiceClassScore) {
                    setCellValue('O33', parseFloat(data.practiceClassScore));
                }

                // 4. ì—°êµ¬ ì‹¤ì  (Row 34)
                if (data.practiceResearch && (data.practiceResearch.content || data.practiceResearch.date)) {
                    setCellValue('E34', data.practiceResearch.content);
                    setCellValue('K34', data.practiceResearch.date);
                }
                if (data.practiceResearchScore) {
                    setCellValue('O34', parseFloat(data.practiceResearchScore));
                }

                // 5. ë¯¸ë˜êµìœ¡ ì‹¤ì  (Row 35)
                if (data.practiceFuture && (data.practiceFuture.content || data.practiceFuture.period)) {
                    setCellValue('E35', data.practiceFuture.content);
                    setCellValue('K35', data.practiceFuture.period);
                }
                if (data.practiceFutureScore) {
                    setCellValue('O35', parseFloat(data.practiceFutureScore));
                }

                // 6. êµìœ¡ë ¥ ì œê³  ì‹¤ì  (Row 36)
                if (data.practiceImprovement && (data.practiceImprovement.content || data.practiceImprovement.period)) {
                    setCellValue('E36', data.practiceImprovement.content);
                    setCellValue('K36', data.practiceImprovement.period);
                }
                if (data.practiceImprovementScore) {
                    setCellValue('O36', parseFloat(data.practiceImprovementScore));
                }

                // ì¶”ê°€ ì…ë ¥ í•­ëª© (Row 48-57)
                // Row 48: ìŠ¹ì§„ í¬ë§ ì§€ì—­ (ì›¹ í˜ì´ì§€ì— í•´ë‹¹ í•„ë“œ ì—†ìŒ)

                // Row 49: ê³¼ì› ì „ë³´ ë‚´ì‹ ì í¬ë§
                if (data.overStaffHope) {
                    setCellValue('F49', data.overStaffHope);
                }

                // Row 50: ì „ë³´ìš°ì„  ì‚¬ìœ 
                if (data.transferPriorityReason) {
                    setCellValue('F50', data.transferPriorityReason);
                }

                // Row 51: ì „ë³´ìœ ì˜ˆ ì‚¬ìœ 
                if (data.transferDeferReason) {
                    setCellValue('F51', data.transferDeferReason);
                }

                // Row 52: ë¶€ë¶€ êµì§ì› ì„±ëª…
                if (data.spouseName) {
                    setCellValue('F52', data.spouseName);
                }

                // Row 53: ë¶€ë¶€ êµì§ì› ì†Œì†
                if (data.spouseSchool) {
                    setCellValue('F53', data.spouseSchool);
                }

                // Row 54: ì§ê³„ì¡´ë¹„ì† êµì§ì›1 ì„±ëª…
                if (data.relative1Name) {
                    setCellValue('F54', data.relative1Name);
                }

                // Row 55: ì§ê³„ì¡´ë¹„ì† êµì§ì›1 ì†Œì†
                if (data.relative1School) {
                    setCellValue('F55', data.relative1School);
                }

                // Row 56: ì§ê³„ì¡´ë¹„ì† êµì§ì›2 ì„±ëª…
                if (data.relative2Name) {
                    setCellValue('F56', data.relative2Name);
                }

                // Row 57: ì§ê³„ì¡´ë¹„ì† êµì§ì›2 ì†Œì†
                if (data.relative2School) {
                    setCellValue('F57', data.relative2School);
                }

                // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                const buffer = await workbook.xlsx.writeBuffer();
                const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ì „ë³´ì‹ ì²­ì„œ_${data.name}_${new Date().toISOString().split('T')[0]}.xlsx`;
                a.click();
                window.URL.revokeObjectURL(url);

                alert('âœ… ì—‘ì…€ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('âŒ ì—‘ì…€ íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í…œí”Œë¦¿ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
            }
        }
    </script>
</body>
</html>